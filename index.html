<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marciibel Hotels Budapest</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import{getAuth,signInWithEmailAndPassword,createUserWithEmailAndPassword,signOut,onAuthStateChanged,updatePassword,EmailAuthProvider,reauthenticateWithCredential}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import{getFirestore,collection,addDoc,getDocs,getDoc,setDoc,query,where,doc,updateDoc,deleteDoc,serverTimestamp}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
const cfg={apiKey:"AIzaSyDKTjKz5rZ0CAp6Senl95yIMetbdf_UJJ0",authDomain:"marciibel-hotels.firebaseapp.com",projectId:"marciibel-hotels",storageBucket:"marciibel-hotels.firebasestorage.app",messagingSenderId:"74569747642",appId:"1:74569747642:web:587b5cf2443509b8460683"};
const app=initializeApp(cfg);
const auth=getAuth(app);
const db=getFirestore(app);
window._fb={auth,db,collection,addDoc,getDocs,getDoc,setDoc,query,where,doc,updateDoc,deleteDoc,serverTimestamp,signInWithEmailAndPassword,createUserWithEmailAndPassword,signOut,onAuthStateChanged,updatePassword,EmailAuthProvider,reauthenticateWithCredential};
window.dispatchEvent(new Event('fbReady'));
</script>
<style>
:root{--bg:#07070c;--s1:#0f0f18;--s2:#161622;--s3:#1e1e2e;--br:#252538;--bl:#333348;--gold:#c9a84c;--gold2:#e2c87a;--gd:rgba(201,168,76,.18);--gg:rgba(201,168,76,.07);--tx:#ede8de;--td:#7c7468;--tm:#42404e;--red:#a83232;--green:#2a7a4f;--blue:#1e4d7a;--r:2px;--nh:72px;}
*{margin:0;padding:0;box-sizing:border-box;}html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--tx);font-family:'Jost',sans-serif;font-weight:300;min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--bl);border-radius:2px;}
@keyframes fu{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
@keyframes mi{from{opacity:0;transform:scale(.96)translateY(8px);}to{opacity:1;transform:scale(1)translateY(0);}}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;height:var(--nh);display:flex;align-items:center;justify-content:space-between;padding:0 3rem;background:rgba(7,7,12,.97);backdrop-filter:blur(24px);border-bottom:1px solid var(--br);}
nav.sc{border-bottom-color:var(--gd);}
.logo{display:flex;align-items:center;gap:.9rem;cursor:pointer;}
.logo-emblem{width:40px;height:40px;border:1px solid var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0;}
.logo-emblem::after{content:'';position:absolute;inset:4px;border-radius:50%;border:1px solid var(--gd);}
.logo-emblem span{font-size:1rem;color:var(--gold);z-index:1;}
.logo-text .logo-main{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:600;color:var(--gold);letter-spacing:.15em;text-transform:uppercase;line-height:1;}
.logo-text .logo-sub{font-size:.5rem;letter-spacing:.45em;text-transform:uppercase;color:var(--td);margin-top:2px;}
.nd{display:flex;align-items:center;gap:.1rem;}
.nl{padding:.42rem .85rem;font-size:.67rem;font-weight:500;letter-spacing:.13em;text-transform:uppercase;color:var(--td);cursor:pointer;background:none;border:none;font-family:'Jost',sans-serif;transition:color .2s;border-radius:1px;}
.nl:hover{color:var(--gold);}.nl.on{color:var(--gold);background:var(--gg);}
.nl.gb{color:var(--gold);border:1px solid var(--gd);}
.npill{display:flex;align-items:center;gap:.5rem;background:var(--s2);border:1px solid var(--bl);border-radius:999px;padding:.25rem .75rem .25rem .3rem;font-size:.7rem;color:var(--td);}
.nav-av{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070c;font-size:.7rem;font-weight:700;display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;}
.hbg{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:6px;background:none;border:none;}
.hbg span{display:block;width:22px;height:1px;background:var(--td);transition:all .3s;}
.hbg.op span:nth-child(1){transform:translateY(6px)rotate(45deg);background:var(--gold);}
.hbg.op span:nth-child(2){opacity:0;}
.hbg.op span:nth-child(3){transform:translateY(-6px)rotate(-45deg);background:var(--gold);}
.drw{display:none;position:fixed;top:var(--nh);right:0;bottom:0;width:280px;z-index:190;background:var(--s1);border-left:1px solid var(--br);padding:1.5rem;flex-direction:column;gap:.2rem;transform:translateX(100%);transition:transform .35s cubic-bezier(.4,0,.2,1);}
.drw.op{transform:translateX(0);}
.dov{display:none;position:fixed;inset:0;z-index:180;background:rgba(0,0,0,.72);}
.dov.op{display:block;}
.dl{padding:.75rem 1rem;font-size:.72rem;font-weight:500;letter-spacing:.13em;text-transform:uppercase;color:var(--td);cursor:pointer;background:none;border:none;border-bottom:1px solid var(--br);text-align:left;transition:color .2s;width:100%;font-family:'Jost',sans-serif;}
.dl:hover,.dl.on{color:var(--gold);}

/* PAGES */
.page{display:none;min-height:100vh;padding-top:var(--nh);}
.page.on{display:block;}
.pflex{display:none;min-height:100vh;padding-top:var(--nh);}
.pflex.on{display:flex;flex-direction:column;}
.con{max-width:1160px;margin:0 auto;padding:2.5rem 2rem;}
.ph{padding:3rem 2rem 2rem;max-width:1160px;margin:0 auto;border-bottom:1px solid var(--br);margin-bottom:2.5rem;}
.pe{font-size:.57rem;letter-spacing:.5em;text-transform:uppercase;color:var(--gold);margin-bottom:.6rem;display:flex;align-items:center;gap:.75rem;}
.pe::after{content:'';width:28px;height:1px;background:var(--gd);}
.pt{font-family:'Cormorant Garamond',serif;font-size:clamp(2rem,4vw,3rem);font-weight:600;line-height:1.05;letter-spacing:.02em;}
.pt em{font-style:italic;color:var(--gold);}
.ps{color:var(--td);font-size:.8rem;margin-top:.4rem;}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:.4rem;padding:.65rem 1.8rem;font-family:'Jost',sans-serif;font-size:.68rem;font-weight:500;letter-spacing:.2em;text-transform:uppercase;cursor:pointer;border:none;transition:all .2s;border-radius:var(--r);}
.bg{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070c;font-weight:600;}
.bg:hover{filter:brightness(1.12);transform:translateY(-1px);box-shadow:0 8px 28px rgba(201,168,76,.3);}
.bo{background:transparent;color:var(--gold);border:1px solid var(--gd);}
.bo:hover{background:var(--gg);border-color:var(--gold);}
.bgh{background:transparent;color:var(--td);border:1px solid var(--bl);}
.bgh:hover{border-color:var(--td);color:var(--tx);}
.bd{background:var(--red);color:#fff;}.bd:hover{filter:brightness(1.15);}
.bs{background:var(--green);color:#fff;}.bs:hover{filter:brightness(1.15);}
.bsm{padding:.38rem .85rem;font-size:.64rem;}
.blk{width:100%;justify-content:center;}
.blg{padding:.85rem 2.6rem;font-size:.74rem;}

/* CARD */
.card{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);}

/* TYPE CARDS */
.tgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:1.5rem;}
.tc{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);overflow:hidden;transition:transform .3s,border-color .3s,box-shadow .3s;cursor:pointer;}
.tc:hover{transform:translateY(-5px);border-color:var(--gd);box-shadow:0 20px 50px rgba(0,0,0,.6);}
.tc-img{height:220px;position:relative;background:linear-gradient(160deg,var(--s2),#12101e);overflow:hidden;display:flex;align-items:center;justify-content:center;}
.tc-slides{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
.tc-slide{position:absolute;font-size:5.5rem;transition:opacity .5s,transform .5s;display:flex;align-items:center;justify-content:center;inset:0;}
.tc-slide.hid{opacity:0;transform:scale(1.08);}
.gdots{position:absolute;bottom:.8rem;left:50%;transform:translateX(-50%);display:flex;gap:.35rem;z-index:2;}
.gdot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.25);cursor:pointer;transition:all .2s;}
.gdot.on{background:var(--gold);transform:scale(1.4);}
.tc-badges{position:absolute;top:.75rem;left:.75rem;display:flex;gap:.35rem;z-index:2;}
.tc-rcnt{position:absolute;top:.75rem;right:.75rem;background:rgba(0,0,0,.75);border:1px solid var(--bl);border-radius:1px;padding:.18rem .6rem;font-size:.62rem;color:var(--td);z-index:2;}
.rb{padding:.18rem .55rem;font-size:.58rem;letter-spacing:.13em;text-transform:uppercase;border-radius:1px;font-weight:600;}
.rb-a{background:rgba(42,122,79,.2);color:#4ec97f;border:1px solid rgba(42,122,79,.3);}
.rb-f{background:rgba(201,168,76,.2);color:var(--gold);border:1px solid var(--gd);}
.rb-n{background:rgba(168,50,50,.2);color:#e06060;border:1px solid rgba(168,50,50,.3);}
.tc-body{padding:1.5rem;}
.tc-name{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:600;margin-bottom:.3rem;letter-spacing:.02em;}
.tc-desc{color:var(--td);font-size:.78rem;line-height:1.65;margin-bottom:.9rem;}
.ams{display:flex;flex-wrap:wrap;gap:.35rem;margin-bottom:1.1rem;}
.am{background:var(--s2);border:1px solid var(--bl);color:var(--td);padding:.2rem .55rem;font-size:.63rem;border-radius:1px;}
.tc-foot{display:flex;align-items:center;justify-content:space-between;padding-top:.9rem;border-top:1px solid var(--br);}
.tc-price{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-weight:600;color:var(--gold);}
.tc-price small{font-family:'Jost',sans-serif;font-size:.62rem;color:var(--td);font-weight:300;}

/* TOOLBAR */
.toolbar{display:flex;gap:.85rem;align-items:center;flex-wrap:wrap;margin-bottom:2rem;}
.sb{position:relative;flex:1;min-width:180px;}
.sb input{background:var(--s1);border:1px solid var(--bl);color:var(--tx);padding:.65rem 1rem .65rem 2.4rem;font-family:'Jost',sans-serif;font-size:.82rem;border-radius:var(--r);width:100%;outline:none;transition:border-color .2s;}
.sb input:focus{border-color:var(--gold);}
.sb::before{content:'‚åï';position:absolute;left:.8rem;top:50%;transform:translateY(-50%);color:var(--tm);font-size:1.1rem;}
.fsel{background:var(--s1);border:1px solid var(--bl);color:var(--td);padding:.65rem 1rem;font-family:'Jost',sans-serif;font-size:.77rem;border-radius:var(--r);outline:none;cursor:pointer;}
.fsel:focus{border-color:var(--gold);}
.fsel option{background:var(--s2);}

/* STARS & REVIEWS */
.stars{display:flex;gap:2px;}
.star{color:var(--tm);font-size:.9rem;cursor:pointer;transition:color .15s;user-select:none;}
.star.on,.star.hv{color:var(--gold);}
.rvgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:1.2rem;}
.rvc{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:1.4rem;transition:border-color .2s;}
.rvc:hover{border-color:var(--gd);}
.rvh{display:flex;align-items:center;gap:.7rem;margin-bottom:.75rem;}
.rvav{width:36px;height:36px;border-radius:50%;background:var(--s3);border:1px solid var(--bl);display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;font-size:1rem;color:var(--gold);}
.rvtxt{font-size:.78rem;color:var(--td);line-height:1.65;font-style:italic;}

/* WIZARD */
.wsteps{display:flex;align-items:center;margin-bottom:2.5rem;}
.wseg{display:flex;align-items:center;gap:.6rem;}
.wline{flex:1;height:1px;background:var(--br);margin:0 .6rem;transition:background .4s;}
.wline.dn{background:var(--gd);}
.wsn{width:30px;height:30px;border-radius:50%;border:1.5px solid var(--bl);display:flex;align-items:center;justify-content:center;font-size:.68rem;font-weight:600;color:var(--tm);transition:all .3s;flex-shrink:0;}
.wseg.ac .wsn{border-color:var(--gold);color:var(--gold);background:var(--gg);}
.wseg.dn .wsn{border-color:var(--gold);background:var(--gold);color:#07070c;}
.wsl{font-size:.64rem;letter-spacing:.1em;text-transform:uppercase;color:var(--tm);white-space:nowrap;transition:color .3s;}
.wseg.ac .wsl{color:var(--gold);}.wseg.dn .wsl{color:var(--td);}
.wp{display:none;animation:fu .28s ease;}
.wp.ac{display:block;}

/* FORMS */
.fr{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
@media(max-width:580px){.fr{grid-template-columns:1fr;}}
.fg{display:flex;flex-direction:column;gap:.38rem;}
label{font-size:.65rem;letter-spacing:.18em;text-transform:uppercase;color:var(--td);font-weight:500;}
input,select,textarea{background:var(--s2);border:1px solid var(--bl);color:var(--tx);padding:.72rem 1rem;font-family:'Jost',sans-serif;font-size:.84rem;border-radius:var(--r);width:100%;outline:none;transition:border-color .2s,box-shadow .2s;}
input:focus,select:focus,textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,.08);}
input::placeholder{color:var(--tm);}
textarea{resize:vertical;min-height:80px;}
select option{background:var(--s2);}

/* SUMMARY */
.sumbox{background:var(--s2);border:1px solid var(--bl);border-radius:var(--r);padding:1.5rem;position:sticky;top:calc(var(--nh)+1rem);}
.sum-t{font-family:'Cormorant Garamond',serif;font-size:1.1rem;border-bottom:1px solid var(--br);padding-bottom:.7rem;margin-bottom:.9rem;}
.sr{display:flex;justify-content:space-between;font-size:.78rem;padding:.3rem 0;color:var(--td);}
.sr.tot{border-top:1px solid var(--br);margin-top:.4rem;padding-top:.8rem;font-size:.95rem;color:var(--tx);}
.sr.tot span:last-child{color:var(--gold);font-family:'Cormorant Garamond',serif;font-size:1.15rem;}
.sum-note{font-size:.67rem;color:var(--tm);margin-top:.7rem;padding-top:.7rem;border-top:1px solid var(--br);line-height:1.65;}

/* CALENDAR */
.calw{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:1.75rem;}
.calh{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;}
.cal-ml{font-family:'Cormorant Garamond',serif;font-size:1.2rem;letter-spacing:.05em;}
.calbtn{width:34px;height:34px;border:1px solid var(--bl);background:transparent;color:var(--td);cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;border-radius:var(--r);transition:all .2s;}
.calbtn:hover{border-color:var(--gold);color:var(--gold);}
.calg{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cdn{text-align:center;font-size:.57rem;letter-spacing:.18em;text-transform:uppercase;color:var(--tm);padding:.4rem 0;}
.cd{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:.74rem;border-radius:1px;cursor:pointer;transition:all .15s;font-weight:300;}
.cd:hover:not(.em):not(.pa){background:var(--gg);color:var(--gold);}
.cd.em,.cd.pa{cursor:default;color:var(--tm);opacity:.35;}
.cd.td2{background:var(--gg);color:var(--gold);font-weight:600;}
.cd.hb{background:rgba(201,168,76,.14);color:var(--gold);}
.cd.fb{background:rgba(168,50,50,.14);color:#e06060;}
.cal-leg{display:flex;gap:1.2rem;margin-top:1.2rem;flex-wrap:wrap;}
.li{display:flex;align-items:center;gap:.38rem;font-size:.64rem;color:var(--tm);}
.ld{width:8px;height:8px;border-radius:1px;}

/* TABLES */
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th{background:var(--s2);padding:.7rem 1rem;text-align:left;font-size:.58rem;font-weight:600;letter-spacing:.2em;text-transform:uppercase;color:var(--tm);border-bottom:1px solid var(--br);white-space:nowrap;}
td{padding:.85rem 1rem;border-bottom:1px solid var(--br);font-size:.8rem;vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,.012);}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:.2rem .6rem;border-radius:1px;font-size:.62rem;font-weight:600;letter-spacing:.06em;}
.b-p{background:rgba(138,94,32,.15);color:#e0a040;border:1px solid rgba(138,94,32,.3);}
.b-c{background:rgba(42,122,79,.12);color:#4ec97f;border:1px solid rgba(42,122,79,.25);}
.b-x{background:rgba(168,50,50,.12);color:#e06060;border:1px solid rgba(168,50,50,.25);}
.b-g{background:var(--gg);color:var(--gold);border:1px solid var(--gd);}
.b-ok{background:rgba(42,122,79,.18);color:#4ec97f;border:1px solid rgba(42,122,79,.3);}

/* STATS */
.sg{display:grid;grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:1rem;margin-bottom:2rem;}
.sc{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:1.4rem;transition:border-color .2s;}
.sc:hover{border-color:var(--gd);}
.sl{font-size:.57rem;letter-spacing:.22em;text-transform:uppercase;color:var(--tm);margin-bottom:.45rem;}
.sv{font-family:'Cormorant Garamond',serif;font-size:2rem;font-weight:600;color:var(--gold);}
.chw{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:1.6rem;margin-bottom:2rem;}
.cht{font-size:.63rem;letter-spacing:.22em;text-transform:uppercase;color:var(--tm);margin-bottom:1.2rem;}

/* MODAL */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);backdrop-filter:blur(8px);z-index:300;align-items:center;justify-content:center;padding:1rem;}
.mo.op{display:flex;}
.mod{background:var(--s1);border:1px solid var(--bl);border-radius:var(--r);padding:2.5rem;width:100%;max-width:520px;position:relative;animation:mi .22s ease;max-height:92vh;overflow-y:auto;}
.mc{position:absolute;top:1.2rem;right:1.2rem;background:var(--s2);border:1px solid var(--bl);color:var(--td);width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:.75rem;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.mc:hover{border-color:var(--gold);color:var(--gold);}
.mt{font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:600;margin-bottom:.25rem;letter-spacing:.03em;}
.msub{font-size:.76rem;color:var(--td);margin-bottom:1.6rem;}

/* TABS */
.tabs{display:flex;border-bottom:1px solid var(--br);margin-bottom:1.6rem;overflow-x:auto;}
.tb{padding:.6rem 1.3rem;font-size:.65rem;font-weight:500;letter-spacing:.13em;text-transform:uppercase;cursor:pointer;background:none;border:none;color:var(--tm);border-bottom:2px solid transparent;margin-bottom:-1px;font-family:'Jost',sans-serif;transition:all .2s;white-space:nowrap;}
.tb.on{color:var(--gold);border-bottom-color:var(--gold);}
.tb:hover:not(.on){color:var(--td);}

/* AUTH */
.authw{min-height:calc(100vh - var(--nh));display:flex;align-items:center;justify-content:center;padding:3rem 1rem;background:radial-gradient(ellipse 60% 60% at 50% 50%,rgba(201,168,76,.05) 0%,transparent 70%);}
.authc{background:var(--s1);border:1px solid var(--bl);border-radius:var(--r);padding:2.8rem;width:100%;max-width:430px;}

/* MISC */
.ib{background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);padding:.85rem 1.1rem;font-size:.76rem;color:var(--td);line-height:1.65;}
#toasts{position:fixed;bottom:1.8rem;right:1.8rem;z-index:400;display:flex;flex-direction:column;gap:.45rem;}
.toast{display:flex;align-items:center;gap:.7rem;padding:.85rem 1.2rem;border-radius:var(--r);font-size:.78rem;background:var(--s1);border:1px solid var(--bl);box-shadow:0 8px 24px rgba(0,0,0,.7);animation:fu .28s ease;max-width:330px;}
.toast.ok{border-left:3px solid #4ec97f;}.toast.er{border-left:3px solid #e06060;}.toast.in{border-left:3px solid var(--gold);}
.pgrid{display:grid;grid-template-columns:250px 1fr;gap:1.5rem;align-items:start;}
.pcard{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:2rem;text-align:center;}
.pav{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070c;font-size:1.7rem;font-weight:700;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;font-family:'Cormorant Garamond',serif;}
.pname{font-family:'Cormorant Garamond',serif;font-size:1.15rem;margin-bottom:.2rem;}
.pstats{display:flex;gap:1rem;justify-content:center;margin-top:1.2rem;padding-top:1.2rem;border-top:1px solid var(--br);}
.psv{font-family:'Cormorant Garamond',serif;font-size:1.5rem;color:var(--gold);}
.psl{font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:var(--tm);}
.bdr{display:flex;justify-content:space-between;padding:.48rem 0;border-bottom:1px solid var(--br);font-size:.8rem;}
.bdr:last-child{border-bottom:none;}
.bdl{color:var(--tm);font-size:.63rem;letter-spacing:.12em;text-transform:uppercase;}
@media(max-width:900px){.hbg{display:flex;}.nd{display:none;}.drw{display:flex;}}
@media(max-width:720px){.pgrid{grid-template-columns:1fr;}.con{padding:1.8rem 1rem;}.ph{padding:2rem 1rem 1.5rem;}.mod{padding:1.6rem;}nav{padding:0 1.2rem;}.authc{padding:2rem 1.4rem;}}
</style>
</head>
<body>
<!-- NAV -->
<nav id="mnav">
  <div class="logo" onclick="go('home')">
    <div class="logo-emblem"><span>‚ú¶</span></div>
    <div class="logo-text">
      <div class="logo-main">Marciibel</div>
      <div class="logo-sub">Hotels ¬∑ Budapest</div>
    </div>
  </div>
  <div class="nd" id="navd">
    <button class="nl" onclick="go('home')">F≈ëoldal</button>
    <button class="nl" onclick="go('types')">Szobat√≠pusok</button>
    <button class="nl" onclick="go('calendar')">Napt√°r</button>
    <button class="nl" onclick="go('reviews')">V√©lem√©nyek</button>
    <button class="nl" id="n-my" style="display:none" onclick="go('mybookings')">Foglal√°saim</button>
    <button class="nl" id="n-prof" style="display:none" onclick="go('profile')">Profil</button>
    <button class="nl gb" id="n-adm" style="display:none" onclick="go('admin')">‚öô Admin</button>
    <div class="npill" id="n-pill" style="display:none">
      <div class="nav-av" id="n-av">?</div>
      <span id="n-em" style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"></span>
      <button class="nl" style="padding:.28rem .5rem;" onclick="logout()">Ki</button>
    </div>
    <button class="nl" id="n-auth" onclick="go('auth')">Bejelentkez√©s</button>
  </div>
  <button class="hbg" id="hbg" onclick="toggleDrw()"><span></span><span></span><span></span></button>
</nav>
<div class="dov" id="dov" onclick="toggleDrw()"></div>
<div class="drw" id="drw">
  <button class="dl" onclick="go('home');toggleDrw()">F≈ëoldal</button>
  <button class="dl" onclick="go('types');toggleDrw()">Szobat√≠pusok</button>
  <button class="dl" onclick="go('calendar');toggleDrw()">Napt√°r</button>
  <button class="dl" onclick="go('reviews');toggleDrw()">V√©lem√©nyek</button>
  <button class="dl" id="d-my" style="display:none" onclick="go('mybookings');toggleDrw()">Foglal√°saim</button>
  <button class="dl" id="d-prof" style="display:none" onclick="go('profile');toggleDrw()">Profil</button>
  <button class="dl" id="d-adm" style="display:none" onclick="go('admin');toggleDrw()">Admin</button>
  <div style="margin-top:auto;border-top:1px solid var(--br);padding-top:1rem;">
    <div id="d-info" style="display:none;font-size:.7rem;color:var(--td);padding:.5rem 1rem;"></div>
    <button class="dl" id="d-auth" onclick="go('auth');toggleDrw()">Bejelentkez√©s</button>
    <button class="dl" id="d-out" style="display:none;color:var(--red);" onclick="logout();toggleDrw()">Kil√©p√©s</button>
  </div>
</div>

<!-- HOME -->
<div id="page-home" class="pflex on">
  <div style="flex:1;display:flex;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;min-height:calc(100vh - var(--nh));">
    <div style="position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 50% 30%,rgba(201,168,76,.08) 0%,transparent 65%);"></div>
    <div style="position:absolute;inset:0;background-image:linear-gradient(rgba(201,168,76,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,.025) 1px,transparent 1px);background-size:70px 70px;"></div>
    <div style="position:absolute;top:2.5rem;left:2.5rem;width:48px;height:48px;border-top:1px solid var(--gd);border-left:1px solid var(--gd);"></div>
    <div style="position:absolute;top:2.5rem;right:2.5rem;width:48px;height:48px;border-top:1px solid var(--gd);border-right:1px solid var(--gd);"></div>
    <div style="position:absolute;bottom:2.5rem;left:2.5rem;width:48px;height:48px;border-bottom:1px solid var(--gd);border-left:1px solid var(--gd);"></div>
    <div style="position:absolute;bottom:2.5rem;right:2.5rem;width:48px;height:48px;border-bottom:1px solid var(--gd);border-right:1px solid var(--gd);"></div>
    <div style="position:relative;max-width:720px;padding:2.5rem;">
      <div style="font-size:.52rem;letter-spacing:.6em;text-transform:uppercase;color:var(--gold);margin-bottom:2rem;animation:fu .8s ease both;display:flex;align-items:center;justify-content:center;gap:1.2rem;">
        <span style="width:36px;height:1px;background:linear-gradient(90deg,transparent,var(--gd));"></span>Est. Budapest, Hungary<span style="width:36px;height:1px;background:linear-gradient(90deg,var(--gd),transparent);"></span>
      </div>
      <div style="font-family:'Cormorant Garamond',serif;font-style:italic;color:var(--gold);font-size:.85rem;letter-spacing:.06em;margin-bottom:.4rem;animation:fu .8s .05s ease both;">The Art of</div>
      <h1 style="font-family:'Cormorant Garamond',serif;font-size:clamp(3rem,8vw,6.5rem);font-weight:600;line-height:1.0;letter-spacing:.05em;margin-bottom:.3rem;animation:fu .8s .1s ease both;">Marciibel</h1>
      <div style="font-family:'Cormorant Garamond',serif;font-size:clamp(1rem,2.5vw,2rem);color:var(--td);letter-spacing:.3em;text-transform:uppercase;margin-bottom:2.2rem;animation:fu .8s .15s ease both;">Hotels ¬∑ Budapest</div>
      <p style="color:var(--td);font-size:.84rem;line-height:1.9;max-width:460px;margin:0 auto 3rem;animation:fu .8s .2s ease both;">Foglaljon szob√°t egyszer≈±en √©s gyorsan.<br>Pr√©mium szobat√≠pusok Budapest sz√≠v√©ben ‚Äì fizet√©s √©rkez√©skor.</p>
      <div style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;animation:fu .8s .25s ease both;">
        <button class="btn bg blg" onclick="go('types')">Szobat√≠pusok</button>
        <button class="btn bo blg" onclick="go('calendar')">Napt√°r n√©zet</button>
      </div>
      <div style="display:flex;gap:3rem;justify-content:center;margin-top:5rem;padding-top:2.5rem;border-top:1px solid var(--br);animation:fu .8s .3s ease both;flex-wrap:wrap;gap:2rem;">
        <div><div style="font-family:'Cormorant Garamond',serif;font-size:2.2rem;color:var(--gold);">IV</div><div style="font-size:.52rem;letter-spacing:.3em;text-transform:uppercase;color:var(--tm);margin-top:.2rem;">Szobat√≠pus</div></div>
        <div style="width:1px;background:var(--br);"></div>
        <div><div style="font-family:'Cormorant Garamond',serif;font-size:2.2rem;color:var(--gold);">‚òÖ 4.9</div><div style="font-size:.52rem;letter-spacing:.3em;text-transform:uppercase;color:var(--tm);margin-top:.2rem;">√ârt√©kel√©s</div></div>
        <div style="width:1px;background:var(--br);"></div>
        <div><div style="font-family:'Cormorant Garamond',serif;font-size:2.2rem;color:var(--gold);">24/7</div><div style="font-size:.52rem;letter-spacing:.3em;text-transform:uppercase;color:var(--tm);margin-top:.2rem;">Recepci√≥</div></div>
      </div>
    </div>
  </div>
</div>

<!-- TYPES -->
<div id="page-types" class="page">
  <div class="ph"><div class="pe">Szobat√≠pusok & Suites</div><h2 class="pt">V√°lasszon <em>szobat√≠pust</em></h2><p class="ps">T√≠pust foglal ‚Äì az admin konkr√©t szob√°t rendel hozz√°</p></div>
  <div class="con" style="padding-top:0;">
    <div class="toolbar">
      <div class="sb"><input type="text" id="ts-q" placeholder="Keres√©s..." oninput="filterTypes()"></div>
      <select class="fsel" id="ts-sort" onchange="filterTypes()"><option value="">Rendez√©s</option><option value="pa">√År ‚Üë</option><option value="pd">√År ‚Üì</option><option value="cap">Kapacit√°s</option></select>
    </div>
    <div class="tgrid" id="types-grid"><div style="text-align:center;padding:4rem;color:var(--tm);">Bet√∂lt√©s...</div></div>
  </div>
</div>

<!-- CALENDAR -->
<div id="page-calendar" class="page">
  <div class="ph"><div class="pe">Foglalts√°g</div><h2 class="pt">Napt√°r <em>n√©zet</em></h2><p class="ps">Kattintson egy napra a r√©szletek√©rt</p></div>
  <div class="con" style="padding-top:0;display:grid;grid-template-columns:1fr 320px;gap:1.5rem;align-items:start;">
    <div class="calw">
      <div class="calh"><button class="calbtn" id="cal-p">‚Äπ</button><div class="cal-ml" id="cal-lbl"></div><button class="calbtn" id="cal-n">‚Ä∫</button></div>
      <div class="calg" id="cal-grid"></div>
      <div class="cal-leg">
        <div class="li"><div class="ld" style="background:rgba(201,168,76,.2);border:1px solid var(--gd);"></div>R√©szben foglalt</div>
        <div class="li"><div class="ld" style="background:rgba(168,50,50,.18);border:1px solid rgba(168,50,50,.3);"></div>Tele</div>
        <div class="li"><div class="ld" style="background:var(--gg);border:1px solid var(--gd);"></div>Ma</div>
      </div>
    </div>
    <div class="card" style="padding:1.6rem;" id="cal-det"><p style="color:var(--tm);font-size:.8rem;font-style:italic;">Kattintson egy napra...</p></div>
  </div>
</div>

<!-- REVIEWS -->
<div id="page-reviews" class="page">
  <div class="ph"><div class="pe">Vend√©geink mondt√°k</div><h2 class="pt">V√©le<em>m√©nyek</em></h2><p class="ps">Ossza meg tapasztalat√°t m√°s vend√©gekkel</p></div>
  <div class="con" style="padding-top:0;">
    <div style="display:grid;grid-template-columns:1fr 280px;gap:1.5rem;margin-bottom:2.5rem;align-items:start;">
      <div class="card" style="padding:1.8rem;" id="rv-wrap">
        <div class="pe" style="margin-bottom:1rem;">V√©lem√©ny √≠r√°sa</div>
        <div id="rv-inner">
          <div class="fg" style="margin-bottom:1rem;"><label>Szobat√≠pus</label><select id="rv-type"></select></div>
          <div class="fg" style="margin-bottom:1rem;"><label>√ârt√©kel√©s</label>
            <div class="stars" id="rv-stars"><span class="star" data-v="1">‚òÖ</span><span class="star" data-v="2">‚òÖ</span><span class="star" data-v="3">‚òÖ</span><span class="star" data-v="4">‚òÖ</span><span class="star" data-v="5">‚òÖ</span></div>
          </div>
          <div class="fg" style="margin-bottom:1.2rem;"><label>V√©lem√©ny *</label><textarea id="rv-txt" placeholder="√çrja meg tapasztalat√°t..."></textarea></div>
          <button class="btn bg blk" onclick="submitReview()">V√©lem√©ny k√ºld√©se</button>
        </div>
      </div>
      <div class="card" style="padding:1.6rem;text-align:center;">
        <div style="font-family:'Cormorant Garamond',serif;font-size:3.5rem;color:var(--gold);" id="avg-r">‚Äì</div>
        <div class="stars" style="justify-content:center;margin:.5rem 0;" id="avg-stars"></div>
        <div style="font-size:.7rem;color:var(--tm);letter-spacing:.08em;" id="rv-cnt">0 v√©lem√©ny</div>
      </div>
    </div>
    <div class="rvgrid" id="rv-grid"></div>
  </div>
</div>

<!-- BOOKING -->
<div id="page-booking" class="page">
  <div class="ph"><div class="pe">Online foglal√°s</div><h2 class="pt">Szoba<em>foglal√°s</em></h2><p class="ps">T√≠pust foglal ‚Äì szobasz√°mot az admin rendeli hozz√° automatikusan</p></div>
  <div class="con" style="padding-top:0;">
    <div class="ib" style="margin-bottom:1.5rem;">üí° Fizet√©s √©rkez√©skor, helysz√≠nen. Online el≈ëleg nem sz√ºks√©ges. A szobasz√°mot a rendszer automatikusan rendeli hozz√°, az admin sz√ºks√©g eset√©n fel√ºl√≠rhatja.</div>
    <div class="wsteps">
      <div class="wseg ac" id="ws1"><div class="wsn">1</div><div class="wsl">T√≠pus & D√°tum</div></div>
      <div class="wline" id="wl1"></div>
      <div class="wseg" id="ws2"><div class="wsn">2</div><div class="wsl">Adatok</div></div>
      <div class="wline" id="wl2"></div>
      <div class="wseg" id="ws3"><div class="wsn">3</div><div class="wsl">√ñsszes√≠t≈ë</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 300px;gap:1.5rem;align-items:start;">
      <div>
        <div class="wp ac" id="step-1">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:.62rem;letter-spacing:.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Szobat√≠pus √©s id≈ëpont</div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="fg"><label>Szobat√≠pus *</label><select id="b-type" onchange="updateSum()"></select></div>
              <div id="avail-info" style="display:none;" class="ib"></div>
              <div class="fr"><div class="fg"><label>√ârkez√©s *</label><input type="date" id="b-ci" onchange="checkAvail();updateSum()"></div><div class="fg"><label>T√°voz√°s *</label><input type="date" id="b-co" onchange="checkAvail();updateSum()"></div></div>
              <div class="fr"><div class="fg"><label>Feln≈ëttek</label><select id="b-ad" onchange="updateSum()"><option>1</option><option selected>2</option><option>3</option><option>4</option></select></div><div class="fg"><label>Gyerekek</label><select id="b-ch" onchange="updateSum()"><option selected>0</option><option>1</option><option>2</option><option>3</option></select></div></div>
            </div><br>
            <button class="btn bg" onclick="wNext(1)">Tov√°bb ‚Üí</button>
          </div>
        </div>
        <div class="wp" id="step-2">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:.62rem;letter-spacing:.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Szem√©lyes adatok</div>
            <div id="adm-banner" style="display:none;background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);padding:1rem;margin-bottom:1.2rem;font-size:.78rem;color:var(--td);">
              <strong style="color:var(--gold);">Admin foglal√°s</strong><br>
              <div class="fg" style="margin-top:.8rem;"><label>Forr√°s</label><select id="b-src"><option value="phone">Telefonh√≠v√°s</option><option value="walkin">Szem√©lyes</option><option value="email_src">Email</option><option value="other">Egy√©b</option></select></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="fr"><div class="fg"><label>Keresztn√©v *</label><input type="text" id="b-fn" placeholder="P√©ter"></div><div class="fg"><label>Vezet√©kn√©v *</label><input type="text" id="b-ln" placeholder="Nagy"></div></div>
              <div class="fg"><label>Email *</label><input type="email" id="b-em" placeholder="pelda@email.hu"></div>
              <div class="fg"><label>Telefon</label><input type="tel" id="b-ph" placeholder="+36 30 123 4567"></div>
              <div class="fg"><label>Megjegyz√©s</label><textarea id="b-nt" placeholder="K√ºl√∂nleges k√©r√©sek..."></textarea></div>
            </div><br>
            <div style="display:flex;gap:.75rem;"><button class="btn bgh" onclick="wPrev(2)">‚Üê Vissza</button><button class="btn bg" onclick="wNext(2)">Tov√°bb ‚Üí</button></div>
          </div>
        </div>
        <div class="wp" id="step-3">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:.62rem;letter-spacing:.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Foglal√°s meger≈ës√≠t√©se</div>
            <div id="s3-c" style="margin-bottom:1.5rem;"></div>
            <div style="display:flex;gap:.75rem;flex-wrap:wrap;"><button class="btn bgh" onclick="wPrev(3)">‚Üê Vissza</button><button class="btn bg blg" onclick="submitBooking()">‚úì Foglal√°s v√©gleges√≠t√©se</button></div>
          </div>
        </div>
      </div>
      <div class="sumbox"><div class="sum-t">√ñsszes√≠t≈ë</div><div id="sum-c"><p style="color:var(--tm);font-size:.78rem;font-style:italic;">V√°lasszon t√≠pust √©s d√°tumot</p></div></div>
    </div>
  </div>
</div>

<!-- MY BOOKINGS -->
<div id="page-mybookings" class="page">
  <div class="ph"><div class="pe">Saj√°t foglal√°sok</div><h2 class="pt">Foglal√°<em>saim</em></h2></div>
  <div class="con" style="padding-top:0;">
    <div class="card"><div class="tw"><table>
      <thead><tr><th>T√≠pus</th><th>Szoba #</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>St√°tusz</th><th>√ñsszeg</th><th></th></tr></thead>
      <tbody id="my-tb"><tr><td colspan="8" style="text-align:center;padding:3rem;color:var(--tm);">Bet√∂lt√©s...</td></tr></tbody>
    </table></div></div>
  </div>
</div>

<!-- PROFILE -->
<div id="page-profile" class="page">
  <div class="ph"><div class="pe">Fi√≥k</div><h2 class="pt">Profil <em>oldal</em></h2></div>
  <div class="con" style="padding-top:0;">
    <div class="pgrid">
      <div>
        <div class="pcard" style="margin-bottom:1rem;">
          <div class="pav" id="p-av">?</div>
          <div class="pname" id="p-name">‚Äì</div>
          <div style="font-size:.72rem;color:var(--td);" id="p-email">‚Äì</div>
          <div class="pstats"><div><div class="psv" id="p-bc">0</div><div class="psl">Foglal√°s</div></div><div><div class="psv" id="p-rc">0</div><div class="psl">V√©lem√©ny</div></div></div>
        </div>
        <div class="card" style="padding:1.4rem;">
          <div class="pe" style="margin-bottom:1rem;">Jelsz√≥ m√≥dos√≠t√°sa</div>
          <div class="fg" style="margin-bottom:.85rem;"><label>Jelenlegi jelsz√≥</label><input type="password" id="p-cp" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="fg" style="margin-bottom:.85rem;"><label>√öj jelsz√≥</label><input type="password" id="p-np" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="fg" style="margin-bottom:1rem;"><label>√öjra</label><input type="password" id="p-np2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <button class="btn bo" onclick="changePw()">M√≥dos√≠t√°s</button>
        </div>
      </div>
      <div>
        <div class="pe" style="margin-bottom:1rem;">Foglal√°saim</div>
        <div class="card"><div class="tw"><table>
          <thead><tr><th>T√≠pus</th><th>Szoba #</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>St√°tusz</th><th>√ñsszeg</th></tr></thead>
          <tbody id="p-tb"></tbody>
        </table></div></div>
      </div>
    </div>
  </div>
</div>

<!-- AUTH -->
<div id="page-auth" class="page">
  <div class="authw">
    <div class="authc">
      <div style="text-align:center;margin-bottom:2rem;">
        <div style="font-size:1.6rem;color:var(--gold);margin-bottom:.6rem;">‚ú¶</div>
        <div style="font-family:'Cormorant Garamond',serif;font-size:1.2rem;color:var(--gold);letter-spacing:.1em;">Marciibel Hotels</div>
        <div style="font-size:.5rem;letter-spacing:.4em;text-transform:uppercase;color:var(--td);margin-top:.3rem;">Budapest</div>
      </div>
      <div class="tabs">
        <button class="tb on" onclick="authTab('li')">Bejelentkez√©s</button>
        <button class="tb" onclick="authTab('reg')">Regisztr√°ci√≥</button>
      </div>
      <div id="auth-li">
        <div class="fg" style="margin-bottom:.9rem;"><label>Email</label><input type="email" id="l-em" placeholder="email@example.com"></div>
        <div class="fg" style="margin-bottom:1.4rem;"><label>Jelsz√≥</label><input type="password" id="l-pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <button class="btn bg blk" onclick="doLogin()">Bejelentkez√©s</button>
      </div>
      <div id="auth-reg" style="display:none;">
        <div class="fr" style="margin-bottom:.9rem;"><div class="fg"><label>Keresztn√©v</label><input type="text" id="r-fn"></div><div class="fg"><label>Vezet√©kn√©v</label><input type="text" id="r-ln"></div></div>
        <div class="fg" style="margin-bottom:.9rem;"><label>Email</label><input type="email" id="r-em"></div>
        <div class="fg" style="margin-bottom:1.4rem;"><label>Jelsz√≥</label><input type="password" id="r-pw"></div>
        <button class="btn bg blk" onclick="doReg()">Regisztr√°ci√≥</button>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN -->
<div id="page-admin" class="page">
  <div class="ph"><div class="pe">Vez√©rl≈ëpult</div><h2 class="pt">Admin <em>fel√ºlet</em></h2></div>
  <div class="con" style="padding-top:0;">
    <div class="sg">
      <div class="sc"><div class="sl">√ñsszes foglal√°s</div><div class="sv" id="st-tot">‚Äì</div></div>
      <div class="sc"><div class="sl">F√ºgg≈ëben</div><div class="sv" id="st-pen">‚Äì</div></div>
      <div class="sc"><div class="sl">Visszaigazolt</div><div class="sv" id="st-con">‚Äì</div></div>
      <div class="sc"><div class="sl">Check-in ma</div><div class="sv" id="st-ci">‚Äì</div></div>
      <div class="sc"><div class="sl">Bev√©tel</div><div class="sv" id="st-rev">‚Äì</div></div>
    </div>
    <div class="chw"><div class="cht">Foglal√°sok ‚Äì elm√∫lt 7 nap</div><canvas id="bk-chart" height="80"></canvas></div>
    <div class="tabs">
      <button class="tb on" onclick="aTab('bk')">Foglal√°sok</button>
      <button class="tb" onclick="aTab('abk')">Admin foglal√°s</button>
      <button class="tb" onclick="aTab('typ')">T√≠pusok</button>
      <button class="tb" onclick="aTab('rm')">Szob√°k</button>
      <button class="tb" onclick="aTab('rv')">V√©lem√©nyek</button>
    </div>

    <div id="at-bk">
      <div style="display:flex;gap:.85rem;margin-bottom:1.2rem;">
        <select class="fsel" id="a-flt" onchange="loadAdminBk()"><option value="">Minden st√°tusz</option><option value="pending">F√ºgg≈ëben</option><option value="confirmed">Visszaigazolt</option><option value="cancelled">Lemondva</option></select>
      </div>
      <div class="card"><div class="tw"><table>
        <thead><tr><th>Vend√©g</th><th>T√≠pus</th><th>Szoba #</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>Forr√°s</th><th>Check-in/out</th><th>St√°tusz</th><th>√ñsszeg</th><th>M≈±veletek</th></tr></thead>
        <tbody id="a-bk-tb"><tr><td colspan="11" style="text-align:center;padding:3rem;color:var(--tm);">Bet√∂lt√©s...</td></tr></tbody>
      </table></div></div>
    </div>

    <div id="at-abk" style="display:none;">
      <div style="background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);padding:1.2rem 1.4rem;margin-bottom:1.5rem;display:flex;gap:1rem;align-items:center;font-size:.8rem;color:var(--td);">
        <span style="font-size:1.4rem;">üìû</span>
        <div><strong style="color:var(--tx);display:block;margin-bottom:.2rem;">Foglal√°s r√∂gz√≠t√©se vend√©g nev√©ben</strong>Telefonh√≠v√°s, email vagy szem√©lyes megjelen√©s alapj√°n.</div>
      </div>
      <div class="card" style="padding:2rem;max-width:660px;">
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="fr"><div class="fg"><label>Szobat√≠pus *</label><select id="ab-type" onchange="updateAbSum()"></select></div><div class="fg"><label>Forr√°s</label><select id="ab-src"><option value="phone">Telefonh√≠v√°s</option><option value="walkin">Szem√©lyes</option><option value="email_src">Email</option><option value="other">Egy√©b</option></select></div></div>
          <div class="fr"><div class="fg"><label>√ârkez√©s *</label><input type="date" id="ab-ci" onchange="updateAbSum()"></div><div class="fg"><label>T√°voz√°s *</label><input type="date" id="ab-co" onchange="updateAbSum()"></div></div>
          <div class="fr"><div class="fg"><label>Feln≈ëttek</label><select id="ab-ad"><option>1</option><option selected>2</option><option>3</option><option>4</option></select></div><div class="fg"><label>Gyerekek</label><select id="ab-ch"><option selected>0</option><option>1</option><option>2</option><option>3</option></select></div></div>
          <div class="fr"><div class="fg"><label>Keresztn√©v *</label><input type="text" id="ab-fn"></div><div class="fg"><label>Vezet√©kn√©v *</label><input type="text" id="ab-ln"></div></div>
          <div class="fg"><label>Email *</label><input type="email" id="ab-em"></div>
          <div class="fg"><label>Telefon</label><input type="tel" id="ab-ph"></div>
          <div class="fg"><label>Megjegyz√©s</label><textarea id="ab-nt"></textarea></div>
          <div id="ab-sum" style="background:var(--s2);border:1px solid var(--br);border-radius:var(--r);padding:1rem;font-size:.8rem;color:var(--td);">V√°lasszon t√≠pust √©s d√°tumot</div>
        </div>
        <br><button class="btn bg" onclick="submitAdminBk()">‚úì Foglal√°s r√∂gz√≠t√©se</button>
      </div>
    </div>

    <div id="at-typ" style="display:none;">
      <div style="margin-bottom:1.4rem;"><button class="btn bo bsm" onclick="openTypeForm()">+ √öj szobat√≠pus</button></div>
      <div class="tgrid" id="a-typ-grid"></div>
    </div>

    <div id="at-rm" style="display:none;">
      <div style="margin-bottom:1.4rem;display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;">
        <button class="btn bo bsm" onclick="openRoomForm()">+ √öj szoba</button>
        <select class="fsel" id="a-rm-flt" onchange="loadAdminRooms()"><option value="">Minden t√≠pus</option></select>
      </div>
      <div class="card"><div class="tw"><table>
        <thead><tr><th>Szobasz√°m</th><th>T√≠pus</th><th>Emelet</th><th>St√°tusz</th><th>Megjegyz√©s</th><th>M≈±veletek</th></tr></thead>
        <tbody id="a-rm-tb"></tbody>
      </table></div></div>
    </div>

    <div id="at-rv" style="display:none;">
      <div class="card"><div class="tw"><table>
        <thead><tr><th>Vend√©g</th><th>T√≠pus</th><th>√ârt√©kel√©s</th><th>Sz√∂veg</th><th>D√°tum</th><th></th></tr></thead>
        <tbody id="a-rv-tb"></tbody>
      </table></div></div>
    </div>
  </div>
</div>

<div id="toasts"></div>

<!-- MODALS -->
<div class="mo" id="m-type"><div class="mod" style="max-width:540px;"><button class="mc" onclick="closeM('m-type')">‚úï</button><div id="m-type-c"></div></div></div>

<div class="mo" id="m-type-form">
  <div class="mod"><button class="mc" onclick="closeM('m-type-form')">‚úï</button>
    <div class="mt" id="tf-title">√öj szobat√≠pus</div><div class="msub">A t√≠pus jellemz≈ëi (pl. Deluxe, Standard)</div>
    <div style="display:flex;flex-direction:column;gap:.9rem;">
      <div class="fg"><label>T√≠pus neve *</label><input type="text" id="tf-name" placeholder="pl. Deluxe Suite"></div>
      <div class="fg"><label>Le√≠r√°s</label><textarea id="tf-desc"></textarea></div>
      <div class="fr"><div class="fg"><label>√År / √©jszaka (Ft) *</label><input type="number" id="tf-price"></div><div class="fg"><label>Max. vend√©g</label><input type="number" id="tf-cap" value="2"></div></div>
      <div class="fr"><div class="fg"><label>Emoji</label><input type="text" id="tf-emoji" value="üõèÔ∏è"></div><div class="fg"><label>Kiemelt?</label><select id="tf-feat"><option value="0">Nem</option><option value="1">Igen</option></select></div></div>
      <div class="fg"><label>Felszerelts√©g (vessz≈ëvel)</label><input type="text" id="tf-am" placeholder="WiFi, TV, Kl√≠ma"></div>
    </div>
    <br><button class="btn bg blk" onclick="saveType()">Ment√©s</button>
    <input type="hidden" id="tf-id">
  </div>
</div>

<div class="mo" id="m-room-form">
  <div class="mod"><button class="mc" onclick="closeM('m-room-form')">‚úï</button>
    <div class="mt" id="rf-title">√öj szoba</div><div class="msub">Konkr√©t fizikai szoba hozz√°ad√°sa</div>
    <div style="display:flex;flex-direction:column;gap:.9rem;">
      <div class="fg"><label>Szobasz√°m *</label><input type="text" id="rf-num" placeholder="pl. 101"></div>
      <div class="fg"><label>Szobat√≠pus *</label><select id="rf-type"></select></div>
      <div class="fg"><label>Emelet</label><input type="text" id="rf-floor" placeholder="pl. 1. emelet"></div>
      <div class="fg"><label>St√°tusz</label><select id="rf-status"><option value="active">Akt√≠v</option><option value="maintenance">Karbantart√°s</option><option value="inactive">Inakt√≠v</option></select></div>
      <div class="fg"><label>Megjegyz√©s (admin)</label><textarea id="rf-note"></textarea></div>
    </div>
    <br><button class="btn bg blk" onclick="saveRoom()">Ment√©s</button>
    <input type="hidden" id="rf-id">
  </div>
</div>

<div class="mo" id="m-assign">
  <div class="mod"><button class="mc" onclick="closeM('m-assign')">‚úï</button>
    <div class="mt">Szoba hozz√°rendel√©se</div>
    <div class="msub" id="m-assign-sub"></div>
    <div class="fg" style="margin-bottom:1.2rem;"><label>Szoba kiv√°laszt√°sa</label><select id="assign-sel"></select></div>
    <button class="btn bg blk" onclick="doAssign()">Hozz√°rendel√©s</button>
    <input type="hidden" id="assign-bk-id">
  </div>
</div>

<div class="mo" id="m-bkdet"><div class="mod" style="max-width:520px;"><button class="mc" onclick="closeM('m-bkdet')">‚úï</button><div id="m-bkdet-c"></div></div></div>
<script>
const EJS='marciibelhotels',EJT='foglalas_budapest',EJK='AbatrWN5NbbsWfMsM';
let CU=null,isAdmin=false,roomTypes=[],physRooms=[],allBk=[];
let calY=new Date().getFullYear(),calM=new Date().getMonth();
let wStep=1,rvRating=0,bkChart=null;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
window.addEventListener('fbReady',async()=>{
  emailjs.init(EJK);
  const{auth,onAuthStateChanged}=window._fb;
  window.addEventListener('scroll',()=>document.getElementById('mnav').classList.toggle('sc',scrollY>20));
  onAuthStateChanged(auth,async user=>{
    CU=user;
    if(user){
      const{db,doc,getDoc}=window._fb;
      const snap=await getDoc(doc(db,'users',user.uid));
      isAdmin=snap.exists()&&snap.data().role==='admin';
      show('n-pill');hide('n-auth');
      document.getElementById('n-av').textContent=user.email[0].toUpperCase();
      document.getElementById('n-em').textContent=user.email;
      show('n-my');show('n-prof');
      document.getElementById('n-adm').style.display=isAdmin?'':'none';
      show('d-my');show('d-prof');
      document.getElementById('d-adm').style.display=isAdmin?'':'none';
      hide('d-auth');show('d-out');
      const di=document.getElementById('d-info');di.style.display='';di.textContent=user.email;
      if(document.getElementById('page-auth').classList.contains('on'))go('types');
      if(document.getElementById('page-reviews').classList.contains('on'))loadReviews();
    }else{
      isAdmin=false;
      hide('n-pill');show('n-auth');
      ['n-my','n-prof','n-adm','d-my','d-prof','d-adm','d-out'].forEach(hide);
      show('d-auth');
      document.getElementById('d-info').style.display='none';
    }
  });
  await fetchAll();
  initRvStars();
});

function show(id){const e=document.getElementById(id);if(e)e.style.display='';}
function hide(id){const e=document.getElementById(id);if(e)e.style.display='none';}

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
async function fetchAll(){
  const{db,collection,getDocs}=window._fb;
  const[ts,rs]=await Promise.all([getDocs(collection(db,'roomTypes')),getDocs(collection(db,'rooms'))]);
  roomTypes=ts.docs.map(d=>({id:d.id,...d.data()}));
  physRooms=rs.docs.map(d=>({id:d.id,...d.data()}));
  if(!roomTypes.length){await seedData();await fetchAll();}
}

async function seedData(){
  const{db,collection,addDoc}=window._fb;
  const types=[
    {name:'Standard Szoba',desc:'K√©nyelmes standard szoba r√∂vid tart√≥zkod√°sra, k√∂zvetlen utcai kil√°t√°ssal.',price:18000,capacity:2,emoji:'üõèÔ∏è',featured:false,amenities:['WiFi','TV','Kl√≠ma','F√ºrd≈ëszoba']},
    {name:'Deluxe Szoba',desc:'T√°gas pr√©mium szoba panor√°m√°s ablakkal, minibarral √©s pr√©mium felszerelts√©ggel.',price:28000,capacity:2,emoji:'üåÖ',featured:true,amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Safe']},
    {name:'Junior Suite',desc:'K√ºl√∂n√°ll√≥ nappalival √©s h√°l√≥val rendelkez≈ë suite, jakuzzival √©s exkluz√≠v felszerelts√©ggel.',price:45000,capacity:3,emoji:'üè°',featured:true,amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Jakuzzi','Nappali']},
    {name:'Penthouse Suite',desc:'Tet≈ëterasz szoba leny≈±g√∂z≈ë panor√°m√°val, butler szolg√°lattal √©s priv√°t jacuzzival.',price:75000,capacity:4,emoji:'‚ú®',featured:true,amenities:['WiFi','4K TV','Kl√≠ma','Priv√°t b√°r','Jakuzzi','Butler','Terasz']},
  ];
  const ids=[];
  for(const t of types){const r=await addDoc(collection(db,'roomTypes'),t);ids.push(r.id);}
  const nums=[['101','102'],['201','202'],['301'],['401']];
  for(let i=0;i<ids.length;i++){
    for(const n of nums[i]){
      await addDoc(collection(db,'rooms'),{number:n,typeId:ids[i],typeName:types[i].name,floor:n[0]+'. emelet',status:'active',note:''});
    }
  }
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function go(name){
  document.querySelectorAll('.page,.pflex').forEach(p=>{p.classList.remove('on');p.style.display='none';});
  const pg=document.getElementById('page-'+name);if(!pg)return;
  pg.style.display=pg.classList.contains('pflex')?'flex':'block';
  pg.classList.add('on');
  window.scrollTo(0,0);
  if(name==='types')renderTypes();
  if(name==='calendar')renderCal();
  if(name==='reviews')loadReviews();
  if(name==='mybookings')loadMyBk();
  if(name==='booking')initBookForm();
  if(name==='profile')loadProfile();
  if(name==='admin'){loadAdminBk();loadAdminTypes();loadAdminRooms();loadAdminRv();}
}
function toggleDrw(){
  const d=document.getElementById('drw'),o=document.getElementById('dov'),h=document.getElementById('hbg');
  const op=d.classList.toggle('op');o.classList.toggle('op',op);h.classList.toggle('op',op);
}

// ‚îÄ‚îÄ TYPES (guest-facing) ‚îÄ‚îÄ
function filterTypes(){renderTypes();}
function renderTypes(){
  const q=(document.getElementById('ts-q')?.value||'').toLowerCase();
  const sort=document.getElementById('ts-sort')?.value||'';
  let list=[...roomTypes].filter(t=>!q||t.name.toLowerCase().includes(q)||t.desc.toLowerCase().includes(q)||(t.amenities||[]).some(a=>a.toLowerCase().includes(q)));
  if(sort==='pa')list.sort((a,b)=>a.price-b.price);
  else if(sort==='pd')list.sort((a,b)=>b.price-a.price);
  else if(sort==='cap')list.sort((a,b)=>b.capacity-a.capacity);
  const g=document.getElementById('types-grid');if(!g)return;
  if(!list.length){g.innerHTML='<div style="text-align:center;padding:4rem;color:var(--tm);">Nincs tal√°lat.</div>';return;}
  const emos=['üõèÔ∏è','üõÅ','üåá','‚òï'];
  g.innerHTML=list.map(t=>{
    const cnt=physRooms.filter(r=>r.typeId===t.id&&r.status==='active').length;
    const em=t.emoji||'üõèÔ∏è';
    const slides=[em,...emos.filter(e=>e!==em)].slice(0,4).map((e,i)=>`<div class="tc-slide${i?' hid':''}" id="sl-${t.id}-${i}">${e}</div>`).join('');
    const dots=Array(4).fill(0).map((_,i)=>`<div class="gdot${!i?' on':''}" onclick="event.stopPropagation();slideT('${t.id}',${i})"></div>`).join('');
    return`<div class="tc" onclick="openTypeDet('${t.id}')">
      <div class="tc-img">
        <div class="tc-slides">${slides}</div>
        <div class="gdots">${dots}</div>
        <div class="tc-badges"><span class="rb ${cnt>0?'rb-a':'rb-n'}">${cnt>0?'El√©rhet≈ë':'Foglalt'}</span>${t.featured?'<span class="rb rb-f">Kiemelt</span>':''}</div>
        <div class="tc-rcnt">${cnt} szoba</div>
      </div>
      <div class="tc-body">
        <div class="tc-name">${t.name}</div>
        <div class="tc-desc">${t.desc}</div>
        <div class="ams">${(t.amenities||[]).map(a=>`<span class="am">‚úì ${a}</span>`).join('')}</div>
        <div class="tc-foot">
          <div><div class="tc-price">${(t.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div><div style="font-size:.65rem;color:var(--tm);margin-top:.15rem;">üë• Max. ${t.capacity||2} f≈ë</div></div>
          <button class="btn bo bsm" onclick="event.stopPropagation();openTypeDet('${t.id}')">R√©szletek</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function slideT(tid,idx){
  for(let i=0;i<4;i++){const el=document.getElementById(`sl-${tid}-${i}`);if(el)el.classList.toggle('hid',i!==idx);}
  document.querySelectorAll(`[onclick*="openTypeDet('${tid}')"] .gdot`).forEach((d,i)=>d.classList.toggle('on',i===idx));
}

function openTypeDet(id){
  const t=roomTypes.find(x=>x.id===id);if(!t)return;
  const cnt=physRooms.filter(r=>r.typeId===id&&r.status==='active').length;
  document.getElementById('m-type-c').innerHTML=`
    <div style="font-size:3.5rem;text-align:center;margin-bottom:1rem;">${t.emoji||'üõèÔ∏è'}</div>
    <div class="mt">${t.name}</div>
    <div class="msub">${t.desc}</div>
    <div class="ams" style="margin-bottom:1rem;">${(t.amenities||[]).map(a=>`<span class="am">‚úì ${a}</span>`).join('')}</div>
    <div style="display:flex;gap:1rem;font-size:.75rem;color:var(--td);margin-bottom:1.2rem;">
      <span>üë• Max. ${t.capacity||2} f≈ë</span><span>üö™ ${cnt} akt√≠v szoba</span>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding-top:1.2rem;border-top:1px solid var(--br);">
      <div style="font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--gold);">${(t.price||0).toLocaleString('hu-HU')} Ft <small style="font-size:.62rem;color:var(--tm);font-family:'Jost',sans-serif;">/ √©jszaka</small></div>
      <button class="btn bg" onclick="selectType('${t.id}')">Foglal√°s ‚Üí</button>
    </div>`;
  openM('m-type');
}

function selectType(id){
  closeM('m-type');
  if(!CU){toast('K√©rj√ºk, jelentkezzen be!','in');go('auth');return;}
  go('booking');
  setTimeout(()=>{const s=document.getElementById('b-type');if(s){s.value=id;updateSum();}},60);
}

// ‚îÄ‚îÄ AVAILABILITY ‚îÄ‚îÄ
async function checkAvail(){
  const typeId=document.getElementById('b-type')?.value;
  const ci=document.getElementById('b-ci')?.value;
  const co=document.getElementById('b-co')?.value;
  const box=document.getElementById('avail-info');
  if(!box||!typeId||!ci||!co||new Date(ci)>=new Date(co)){if(box)box.style.display='none';return;}
  const free=await getFreeRooms(typeId,ci,co);
  const total=physRooms.filter(r=>r.typeId===typeId&&r.status==='active').length;
  box.style.display='';
  if(free.length===0){
    box.style.cssText='background:rgba(168,50,50,.08);border:1px solid rgba(168,50,50,.25);border-radius:var(--r);padding:.85rem 1.1rem;font-size:.76rem;color:#e06060;line-height:1.65;';
    box.textContent='‚ö†Ô∏è Nincs szabad szoba erre az id≈ëszakra ebb≈ël a t√≠pusb√≥l.';
  }else{
    box.style.cssText='background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);padding:.85rem 1.1rem;font-size:.76rem;color:var(--td);line-height:1.65;';
    box.textContent=`‚úì ${free.length} szabad szoba el√©rhet≈ë (√∂sszesen: ${total}).`;
  }
}

async function getFreeRooms(typeId,ci,co){
  const{db,collection,getDocs}=window._fb;
  const typeRooms=physRooms.filter(r=>r.typeId===typeId&&r.status==='active');
  if(!typeRooms.length)return[];
  const snap=await getDocs(collection(db,'bookings'));
  const bks=snap.docs.map(d=>d.data()).filter(b=>b.typeId===typeId&&b.status!=='cancelled'&&b.checkin<co&&b.checkout>ci);
  const bookedIds=new Set(bks.map(b=>b.roomId).filter(Boolean));
  return typeRooms.filter(r=>!bookedIds.has(r.id));
}

// ‚îÄ‚îÄ BOOKING WIZARD ‚îÄ‚îÄ
function initBookForm(){
  const sel=document.getElementById('b-type');if(!sel)return;
  sel.innerHTML=roomTypes.map(t=>`<option value="${t.id}">${t.name} ‚Äì ${(t.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  if(CU)document.getElementById('b-em').value=CU.email;
  const today=new Date().toISOString().split('T')[0];
  const tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('b-ci'),co=document.getElementById('b-co');
  ci.min=today;co.min=tom;if(!ci.value)ci.value=today;if(!co.value)co.value=tom;
  document.getElementById('adm-banner').style.display=isAdmin?'':'none';
  setWStep(1);updateSum();
}

function setWStep(n){
  wStep=n;
  [1,2,3].forEach(i=>{
    const ws=document.getElementById('ws'+i),wl=document.getElementById('wl'+i),wp=document.getElementById('step-'+i);
    if(ws){ws.classList.toggle('ac',i===n);ws.classList.toggle('dn',i<n);}
    if(wl)wl.classList.toggle('dn',i<n);
    if(wp)wp.classList.toggle('ac',i===n);
  });
  if(n===3)buildS3();
}
function wNext(s){
  if(s===1){
    const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
    if(!ci||!co){toast('Adja meg a d√°tumokat!','er');return;}
    if(new Date(ci)>=new Date(co)){toast('A t√°voz√°s d√°tuma kor√°bbi az √©rkez√©sn√©l!','er');return;}
  }
  if(s===2){
    if(!document.getElementById('b-fn').value.trim()||!document.getElementById('b-ln').value.trim()||!document.getElementById('b-em').value.trim()){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','er');return;}
  }
  setWStep(s+1);
}
function wPrev(s){setWStep(s-1);}

function updateSum(){
  const t=roomTypes.find(x=>x.id===document.getElementById('b-type')?.value);
  const ci=document.getElementById('b-ci')?.value,co=document.getElementById('b-co')?.value;
  const sc=document.getElementById('sum-c');if(!sc)return;
  if(!t||!ci||!co){sc.innerHTML='<p style="color:var(--tm);font-size:.78rem;font-style:italic;">V√°lasszon t√≠pust √©s d√°tumot</p>';return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(t.price||0);
  sc.innerHTML=`<div class="sr"><span>T√≠pus</span><span>${t.name}</span></div><div class="sr"><span>√ârkez√©s</span><span>${ci}</span></div><div class="sr"><span>T√°voz√°s</span><span>${co}</span></div><div class="sr"><span>√âjszak√°k</span><span>${n}</span></div><div class="sr"><span>√År/√©j</span><span>${(t.price||0).toLocaleString('hu-HU')} Ft</span></div><div class="sr tot"><span>V√©g√∂sszeg</span><span>${tot.toLocaleString('hu-HU')} Ft</span></div><div class="sum-note">üí° Fizet√©s √©rkez√©skor. Szobasz√°mot automatikusan rendeli a rendszer.</div>`;
}

function buildS3(){
  const t=roomTypes.find(x=>x.id===document.getElementById('b-type').value);
  const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
  const fn=document.getElementById('b-fn').value,ln=document.getElementById('b-ln').value;
  const em=document.getElementById('b-em').value,ph=document.getElementById('b-ph').value;
  const ad=document.getElementById('b-ad').value,ch=document.getElementById('b-ch').value;
  const nt=document.getElementById('b-nt').value;
  if(!t)return;
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(t.price||0);
  document.getElementById('s3-c').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.7rem;font-size:.8rem;margin-bottom:1rem;">
      ${[['T√≠pus',t.name],['Vend√©g',`${fn} ${ln}`],['√ârkez√©s',ci],['T√°voz√°s',co],['Email',em],['Telefon',ph||'‚Äì'],['Vend√©gek',`${ad} feln≈ëtt${+ch>0?', '+ch+' gyerek':''}`],['√âjszak√°k',n+' √©j']].map(([l,v])=>`<div><div style="font-size:.6rem;letter-spacing:.12em;text-transform:uppercase;color:var(--tm);">${l}</div><div style="margin-top:.2rem;">${v}</div></div>`).join('')}
    </div>
    ${nt?`<div style="font-size:.76rem;color:var(--td);padding:.7rem;background:var(--s2);border-radius:var(--r);margin-bottom:.8rem;">üí¨ ${nt}</div>`:''}
    <div style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);">
      <span style="font-size:.65rem;letter-spacing:.15em;text-transform:uppercase;color:var(--td);">V√©g√∂sszeg</span>
      <span style="font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--gold);">${tot.toLocaleString('hu-HU')} Ft</span>
    </div>`;
}

async function submitBooking(){
  if(!CU){toast('K√©rj√ºk, jelentkezzen be!','er');return;}
  const typeId=document.getElementById('b-type').value;
  const t=roomTypes.find(x=>x.id===typeId);
  const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
  const fn=document.getElementById('b-fn').value.trim(),ln=document.getElementById('b-ln').value.trim();
  const em=document.getElementById('b-em').value.trim(),ph=document.getElementById('b-ph').value.trim();
  const ad=document.getElementById('b-ad').value,ch=document.getElementById('b-ch').value;
  const nt=document.getElementById('b-nt').value.trim();
  const src=isAdmin?(document.getElementById('b-src')?.value||'admin'):'online';
  if(!t||!ci||!co||!fn||!ln||!em){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','er');return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(t.price||0);
  const freeRooms=await getFreeRooms(typeId,ci,co);
  const freeRoom=freeRooms[0]||null;
  const{db,collection,addDoc,serverTimestamp}=window._fb;
  try{
    const ref=await addDoc(collection(db,'bookings'),{userId:CU.uid,userEmail:CU.email,typeId,typeName:t.name,roomId:freeRoom?.id||null,roomNumber:freeRoom?.number||null,checkin:ci,checkout:co,firstname:fn,lastname:ln,email:em,phone:ph,adults:+ad,children:+ch,notes:nt,nights:n,total:tot,status:'pending',source:src,checkedIn:false,checkedOut:false,createdAt:serverTimestamp()});
    try{await emailjs.send(EJS,EJT,{to_name:`${fn} ${ln}`,to_email:em,room_name:t.name,checkin:ci,checkout:co,nights:n.toString(),total:tot.toLocaleString('hu-HU')+' Ft',booking_id:ref.id,adults:ad.toString(),children:ch.toString(),phone:ph||'‚Äì',notes:nt||'‚Äì',room_number:freeRoom?.number||'Hamarosan hozz√°rendelve'});}catch(e){console.warn('EmailJS:',e);}
    toast(freeRoom?`Foglal√°s elk√ºldve! Szoba: #${freeRoom.number}`:'Foglal√°s elk√ºldve! Admin hamarosan szob√°t rendel.','ok');
    go('mybookings');
  }catch(e){toast('Hiba: '+e.message,'er');}
}

// ‚îÄ‚îÄ MY BOOKINGS ‚îÄ‚îÄ
async function loadMyBk(){
  if(!CU)return;
  const{db,collection,getDocs,query,where}=window._fb;
  const tb=document.getElementById('my-tb');if(!tb)return;
  try{
    const snap=await getDocs(query(collection(db,'bookings'),where('userId','==',CU.uid)));
    const items=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
    if(!items.length){tb.innerHTML=`<tr><td colspan="8" style="text-align:center;padding:3rem;color:var(--tm);">M√©g nincs foglal√°sa. <button class="btn bo bsm" onclick="go('types')" style="margin-left:.5rem;">Szobat√≠pusok</button></td></tr>`;return;}
    tb.innerHTML=items.map(b=>`<tr>
      <td><strong>${b.typeName||'‚Äì'}</strong></td>
      <td>${b.roomNumber?`<span class="badge b-g">#${b.roomNumber}</span>`:'<span style="color:var(--tm);font-size:.7rem;font-style:italic;">Folyamatban...</span>'}</td>
      <td>${b.checkin}</td><td>${b.checkout}</td>
      <td>${b.adults}f${(b.children||0)>0?' '+b.children+'gy':''}</td>
      <td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td>
      <td style="color:var(--gold);font-family:'Cormorant Garamond',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
      <td style="display:flex;gap:.35rem;flex-wrap:wrap;">
        <button class="btn bgh bsm" onclick='showBkDet(${safeJ(b)})'>R√©szletek</button>
        ${b.status==='pending'?`<button class="btn bd bsm" onclick="cancelMyBk('${b.id}')">Lemond√°s</button>`:''}
      </td>
    </tr>`).join('');
  }catch(e){tb.innerHTML=`<tr><td colspan="8" style="color:var(--red);padding:1rem;">Hiba: ${e.message}</td></tr>`;}
}

async function cancelMyBk(id){
  if(!confirm('Biztosan lemondja a foglal√°st?'))return;
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'cancelled'});
  toast('Foglal√°s lemondva.','in');loadMyBk();
}

function showBkDet(b){
  document.getElementById('m-bkdet-c').innerHTML=`
    <div class="mt">${b.typeName||'‚Äì'}</div><div class="msub">Foglal√°s r√©szletei</div>
    ${[['Foglal√°s ID',b.id.slice(0,10)+'‚Ä¶'],['Szoba #',b.roomNumber||'Hozz√°rendel√©s folyamatban'],['Vend√©g',`${b.firstname||''} ${b.lastname||''}`],['Email',b.email||'‚Äì'],['Telefon',b.phone||'‚Äì'],['√ârkez√©s',b.checkin],['T√°voz√°s',b.checkout],['√âjszak√°k',(b.nights||1)+' √©j'],['Feln≈ëttek',b.adults||0],['Gyerekek',b.children||0],['St√°tusz',bLbl(b.status)],['Forr√°s',srcLbl(b.source)],['Check-in',b.checkedIn?'‚úì Meg√©rkezett':'Nem √©rkezett meg'],['Check-out',b.checkedOut?'‚úì Elutazott':'M√©g bent'],['√ñsszeg',(b.total||0).toLocaleString('hu-HU')+' Ft']].map(([l,v])=>`<div class="bdr"><div class="bdl">${l}</div><div>${v}</div></div>`).join('')}
    ${b.notes?`<div style="margin-top:1rem;padding:.8rem;background:var(--s2);border-radius:var(--r);font-size:.78rem;color:var(--td);">üí¨ ${b.notes}</div>`:''}`;
  openM('m-bkdet');
}

// ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ
async function loadProfile(){
  if(!CU){go('auth');return;}
  const{db,collection,getDocs,query,where,getDoc,doc}=window._fb;
  const snap=await getDoc(doc(db,'users',CU.uid));
  const ud=snap.exists()?snap.data():{};
  const name=ud.firstname||ud.lastname?`${ud.firstname||''} ${ud.lastname||''}`.trim():CU.email.split('@')[0];
  document.getElementById('p-av').textContent=CU.email[0].toUpperCase();
  document.getElementById('p-name').textContent=name;
  document.getElementById('p-email').textContent=CU.email;
  const bks=(await getDocs(query(collection(db,'bookings'),where('userId','==',CU.uid)))).docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  document.getElementById('p-bc').textContent=bks.length;
  document.getElementById('p-rc').textContent=(await getDocs(query(collection(db,'reviews'),where('userId','==',CU.uid)))).size;
  const ptb=document.getElementById('p-tb');
  ptb.innerHTML=bks.length?bks.map(b=>`<tr><td><strong>${b.typeName||'‚Äì'}</strong></td><td>${b.roomNumber?`<span class="badge b-g">#${b.roomNumber}</span>`:'‚Äì'}</td><td>${b.checkin}</td><td>${b.checkout}</td><td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td><td style="color:var(--gold);font-family:'Cormorant Garamond',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td></tr>`).join(''):'<tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--tm);">M√©g nincs foglal√°sa.</td></tr>';
}

async function changePw(){
  if(!CU)return;
  const cp=document.getElementById('p-cp').value,np=document.getElementById('p-np').value,np2=document.getElementById('p-np2').value;
  if(!cp||!np||!np2){toast('T√∂ltse ki az √∂sszes mez≈ët!','er');return;}
  if(np!==np2){toast('Az √∫j jelszavak nem egyeznek!','er');return;}
  if(np.length<6){toast('Min. 6 karakter sz√ºks√©ges!','er');return;}
  const{auth,EmailAuthProvider,reauthenticateWithCredential,updatePassword}=window._fb;
  try{
    await reauthenticateWithCredential(CU,EmailAuthProvider.credential(CU.email,cp));
    await updatePassword(CU,np);
    toast('Jelsz√≥ m√≥dos√≠tva!','ok');
    ['p-cp','p-np','p-np2'].forEach(id=>document.getElementById(id).value='');
  }catch(e){toast(e.code==='auth/wrong-password'?'Hib√°s jelenlegi jelsz√≥!':'Hiba: '+e.message,'er');}
}

// ‚îÄ‚îÄ ADMIN BOOKINGS ‚îÄ‚îÄ
async function loadAdminBk(){
  if(!isAdmin)return;
  const{db,collection,getDocs,query,where}=window._fb;
  const tb=document.getElementById('a-bk-tb');if(!tb)return;
  try{
    const flt=document.getElementById('a-flt')?.value||'';
    const q=flt?query(collection(db,'bookings'),where('status','==',flt)):collection(db,'bookings');
    const snap=await getDocs(q);
    allBk=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
    const tod=new Date().toISOString().split('T')[0];
    document.getElementById('st-tot').textContent=allBk.length;
    document.getElementById('st-pen').textContent=allBk.filter(b=>b.status==='pending').length;
    document.getElementById('st-con').textContent=allBk.filter(b=>b.status==='confirmed').length;
    document.getElementById('st-ci').textContent=allBk.filter(b=>b.checkin===tod&&b.status==='confirmed').length;
    document.getElementById('st-rev').textContent=allBk.filter(b=>b.status==='confirmed').reduce((s,b)=>s+(b.total||0),0).toLocaleString('hu-HU')+' Ft';
    renderChart(allBk);
    if(!allBk.length){tb.innerHTML='<tr><td colspan="11" style="text-align:center;padding:3rem;color:var(--tm);">Nincs foglal√°s.</td></tr>';return;}
    tb.innerHTML=allBk.map(b=>`<tr>
      <td><strong>${b.firstname||''} ${b.lastname||''}</strong><br><span style="font-size:.7rem;color:var(--tm);">${b.userEmail}</span>${b.phone?`<br><span style="font-size:.7rem;color:var(--tm);">${b.phone}</span>`:''}</td>
      <td>${b.typeName||'‚Äì'}</td>
      <td>
        ${b.roomNumber?`<span class="badge b-g">#${b.roomNumber}</span>`:'<span style="color:var(--tm);font-size:.7rem;">‚Äì</span>'}
        <br><button class="btn bgh bsm" style="margin-top:.3rem;" onclick="openAssign('${b.id}','${b.typeId||''}','${(b.typeName||'').replace(/'/g,'&apos;')}')">Hozz√°rendel</button>
      </td>
      <td>${b.checkin}</td><td>${b.checkout}</td>
      <td>${b.adults||0}f${(b.children||0)>0?' '+(b.children)+'gy':''}</td>
      <td><span style="font-size:.68rem;color:var(--tm);">${srcLbl(b.source)}</span></td>
      <td>
        <span class="badge ${b.checkedIn?'b-ok':'b-p'}" style="cursor:pointer;display:block;margin-bottom:.2rem;" onclick="toggleCI('${b.id}','in',${!b.checkedIn})">${b.checkedIn?'‚úì Be-':'Be ‚Üí'}</span>
        <span class="badge ${b.checkedOut?'b-ok':'b-p'}" style="cursor:pointer;" onclick="toggleCI('${b.id}','out',${!b.checkedOut})">${b.checkedOut?'‚úì Ki-':'Ki ‚Üí'}</span>
      </td>
      <td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td>
      <td style="color:var(--gold);font-family:'Cormorant Garamond',serif;white-space:nowrap;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
      <td style="display:flex;gap:.3rem;flex-wrap:wrap;">
        <button class="btn bgh bsm" onclick='showBkDet(${safeJ(b)})'>üëÅ</button>
        ${b.status==='pending'?`<button class="btn bs bsm" onclick="confirmBk('${b.id}')">‚úì</button>`:''}
        ${b.status!=='cancelled'?`<button class="btn bd bsm" onclick="adminCancel('${b.id}')">‚úï</button>`:''}
      </td>
    </tr>`).join('');
  }catch(e){tb.innerHTML=`<tr><td colspan="11" style="color:var(--red);padding:1rem;">Hiba: ${e.message}</td></tr>`;}
}

function openAssign(bkId,typeId,typeName){
  document.getElementById('m-assign-sub').textContent='T√≠pus: '+typeName;
  document.getElementById('assign-bk-id').value=bkId;
  const typeRooms=physRooms.filter(r=>r.typeId===typeId&&r.status==='active');
  const sel=document.getElementById('assign-sel');
  sel.innerHTML='<option value="">‚Äì Szoba n√©lk√ºl ‚Äì</option>'+typeRooms.map(r=>`<option value="${r.id}">${r.number}${r.floor?' ‚Äì '+r.floor:''}</option>`).join('');
  const bk=allBk.find(b=>b.id===bkId);if(bk?.roomId)sel.value=bk.roomId;
  openM('m-assign');
}
async function doAssign(){
  const bkId=document.getElementById('assign-bk-id').value;
  const roomId=document.getElementById('assign-sel').value;
  const room=physRooms.find(r=>r.id===roomId);
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',bkId),{roomId:roomId||null,roomNumber:room?.number||null});
  toast(room?`Szoba #${room.number} hozz√°rendelve!`:'Szoba hozz√°rendel√©s t√∂r√∂lve.','ok');
  closeM('m-assign');loadAdminBk();
}
async function toggleCI(id,type,val){
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{[type==='in'?'checkedIn':'checkedOut']:val});
  toast(val?(type==='in'?'Check-in jel√∂lve!':'Check-out jel√∂lve!'):(type==='in'?'Check-in visszavonva':'Check-out visszavonva'),'in');
  loadAdminBk();
}
async function confirmBk(id){const{db,doc,updateDoc}=window._fb;await updateDoc(doc(db,'bookings',id),{status:'confirmed'});toast('Visszaigazolva!','ok');loadAdminBk();}
async function adminCancel(id){if(!confirm('T√∂rli?'))return;const{db,doc,updateDoc}=window._fb;await updateDoc(doc(db,'bookings',id),{status:'cancelled'});toast('T√∂r√∂lve.','in');loadAdminBk();}

// ADMIN BOOK FORM
function initAbForm(){
  const s=document.getElementById('ab-type');if(!s)return;
  s.innerHTML=roomTypes.map(t=>`<option value="${t.id}">${t.name} ‚Äì ${(t.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  const today=new Date().toISOString().split('T')[0],tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('ab-ci'),co=document.getElementById('ab-co');
  if(ci){ci.min=today;if(!ci.value)ci.value=today;}if(co){co.min=tom;if(!co.value)co.value=tom;}
  updateAbSum();
}
function updateAbSum(){
  const t=roomTypes.find(x=>x.id===document.getElementById('ab-type')?.value);
  const ci=document.getElementById('ab-ci')?.value,co=document.getElementById('ab-co')?.value;
  const box=document.getElementById('ab-sum');if(!box||!t||!ci||!co)return;
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  box.innerHTML=`<strong>${t.name}</strong> ¬∑ ${n} √©j ¬∑ <span style="color:var(--gold);font-family:'Cormorant Garamond',serif;font-size:1rem;">${(n*(t.price||0)).toLocaleString('hu-HU')} Ft</span>`;
}
async function submitAdminBk(){
  if(!isAdmin)return;
  const typeId=document.getElementById('ab-type').value,t=roomTypes.find(x=>x.id===typeId);
  const ci=document.getElementById('ab-ci').value,co=document.getElementById('ab-co').value;
  const fn=document.getElementById('ab-fn').value.trim(),ln=document.getElementById('ab-ln').value.trim();
  const em=document.getElementById('ab-em').value.trim(),ph=document.getElementById('ab-ph').value.trim();
  const ad=document.getElementById('ab-ad').value,ch=document.getElementById('ab-ch').value;
  const nt=document.getElementById('ab-nt').value.trim(),src=document.getElementById('ab-src').value;
  if(!t||!ci||!co||!fn||!ln||!em){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','er');return;}
  if(new Date(ci)>=new Date(co)){toast('Hib√°s d√°tum!','er');return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000)),tot=n*(t.price||0);
  const freeRooms=await getFreeRooms(typeId,ci,co);
  const freeRoom=freeRooms[0]||null;
  const{db,collection,addDoc,serverTimestamp}=window._fb;
  try{
    await addDoc(collection(db,'bookings'),{userId:CU.uid,userEmail:CU.email,typeId,typeName:t.name,roomId:freeRoom?.id||null,roomNumber:freeRoom?.number||null,checkin:ci,checkout:co,firstname:fn,lastname:ln,email:em,phone:ph,adults:+ad,children:+ch,notes:nt,nights:n,total:tot,status:'confirmed',source:src,checkedIn:false,checkedOut:false,adminBooking:true,createdAt:serverTimestamp()});
    toast(freeRoom?`Admin foglal√°s r√∂gz√≠tve! Szoba: #${freeRoom.number}`:'Admin foglal√°s r√∂gz√≠tve! Szoba manu√°lisan rendelend≈ë.','ok');
    loadAdminBk();aTab('bk');
  }catch(e){toast('Hiba: '+e.message,'er');}
}

// ADMIN TYPES
function loadAdminTypes(){
  if(!isAdmin)return;
  const g=document.getElementById('a-typ-grid');if(!g)return;
  g.innerHTML=roomTypes.map(t=>`<div class="tc" style="cursor:default;">
    <div class="tc-img"><div style="font-size:5rem;">${t.emoji||'üõèÔ∏è'}</div></div>
    <div class="tc-body">
      <div class="tc-name">${t.name}</div>
      <div class="tc-desc">${t.desc}</div>
      <div class="ams">${(t.amenities||[]).map(a=>`<span class="am">${a}</span>`).join('')}</div>
      <div class="tc-foot">
        <div><div class="tc-price">${(t.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div><div style="font-size:.65rem;color:var(--tm);">üë• Max. ${t.capacity||2} f≈ë ¬∑ ${physRooms.filter(r=>r.typeId===t.id).length} szoba</div></div>
        <div style="display:flex;gap:.4rem;">
          <button class="btn bo bsm" onclick="openTypeForm('${t.id}')">Szerkeszt</button>
          <button class="btn bd bsm" onclick="deleteType('${t.id}')">T√∂rl√©s</button>
        </div>
      </div>
    </div>
  </div>`).join('');
}

function openTypeForm(id){
  const t=id?roomTypes.find(x=>x.id===id):null;
  document.getElementById('tf-title').textContent=t?'T√≠pus szerkeszt√©se':'√öj szobat√≠pus';
  document.getElementById('tf-id').value=id||'';
  document.getElementById('tf-name').value=t?.name||'';
  document.getElementById('tf-desc').value=t?.desc||'';
  document.getElementById('tf-price').value=t?.price||'';
  document.getElementById('tf-cap').value=t?.capacity||2;
  document.getElementById('tf-emoji').value=t?.emoji||'üõèÔ∏è';
  document.getElementById('tf-feat').value=t?.featured?'1':'0';
  document.getElementById('tf-am').value=(t?.amenities||[]).join(', ');
  openM('m-type-form');
}
async function saveType(){
  const name=document.getElementById('tf-name').value.trim();
  const price=+document.getElementById('tf-price').value;
  if(!name||!price){toast('N√©v √©s √°r k√∂telez≈ë!','er');return;}
  const data={name,desc:document.getElementById('tf-desc').value.trim(),price,capacity:+document.getElementById('tf-cap').value||2,emoji:document.getElementById('tf-emoji').value.trim()||'üõèÔ∏è',featured:document.getElementById('tf-feat').value==='1',amenities:document.getElementById('tf-am').value.split(',').map(s=>s.trim()).filter(Boolean)};
  const editId=document.getElementById('tf-id').value;
  const{db,collection,addDoc,doc,updateDoc}=window._fb;
  if(editId){await updateDoc(doc(db,'roomTypes',editId),data);toast('T√≠pus friss√≠tve!','ok');}
  else{await addDoc(collection(db,'roomTypes'),data);toast('T√≠pus hozz√°adva!','ok');}
  closeM('m-type-form');await fetchAll();loadAdminTypes();renderTypes();
}
async function deleteType(id){
  if(!confirm('Biztosan t√∂rli a t√≠pust? A hozz√° tartoz√≥ szob√°k is t√∂rl≈ëdnek!'))return;
  const{db,doc,deleteDoc,collection,getDocs,query,where}=window._fb;
  await deleteDoc(doc(db,'roomTypes',id));
  const rmSnap=await getDocs(query(collection(db,'rooms'),where('typeId','==',id)));
  for(const d of rmSnap.docs)await deleteDoc(doc(db,'rooms',d.id));
  toast('T√≠pus √©s szob√°i t√∂r√∂lve.','in');await fetchAll();loadAdminTypes();loadAdminRooms();renderTypes();
}

// ADMIN ROOMS
function loadAdminRooms(){
  if(!isAdmin)return;
  const tb=document.getElementById('a-rm-tb');if(!tb)return;
  const flt=document.getElementById('a-rm-flt')?.value||'';
  // update filter dropdown
  const fltSel=document.getElementById('a-rm-flt');
  if(fltSel&&fltSel.options.length<=1){
    roomTypes.forEach(t=>{const o=document.createElement('option');o.value=t.id;o.textContent=t.name;fltSel.appendChild(o);});
  }
  let list=flt?physRooms.filter(r=>r.typeId===flt):physRooms;
  if(!list.length){tb.innerHTML='<tr><td colspan="6" style="text-align:center;padding:3rem;color:var(--tm);">Nincs szoba. Hozzon l√©tre egyet!</td></tr>';return;}
  const stMap={active:'<span class="badge b-c">Akt√≠v</span>',maintenance:'<span class="badge b-p">Karbantart√°s</span>',inactive:'<span class="badge b-x">Inakt√≠v</span>'};
  tb.innerHTML=list.map(r=>`<tr>
    <td><strong style="font-family:'Cormorant Garamond',serif;font-size:1.1rem;">#${r.number}</strong></td>
    <td>${r.typeName||roomTypes.find(t=>t.id===r.typeId)?.name||'‚Äì'}</td>
    <td>${r.floor||'‚Äì'}</td>
    <td>${stMap[r.status]||r.status}</td>
    <td style="font-size:.75rem;color:var(--tm);">${r.note||'‚Äì'}</td>
    <td style="display:flex;gap:.35rem;">
      <button class="btn bo bsm" onclick="openRoomForm('${r.id}')">Szerkeszt</button>
      <button class="btn bd bsm" onclick="deleteRoom('${r.id}')">T√∂rl√©s</button>
    </td>
  </tr>`).join('');
}

function openRoomForm(id){
  const r=id?physRooms.find(x=>x.id===id):null;
  document.getElementById('rf-title').textContent=r?'Szoba szerkeszt√©se':'√öj szoba';
  document.getElementById('rf-id').value=id||'';
  document.getElementById('rf-num').value=r?.number||'';
  document.getElementById('rf-floor').value=r?.floor||'';
  document.getElementById('rf-status').value=r?.status||'active';
  document.getElementById('rf-note').value=r?.note||'';
  const ts=document.getElementById('rf-type');
  ts.innerHTML=roomTypes.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');
  if(r?.typeId)ts.value=r.typeId;
  openM('m-room-form');
}
async function saveRoom(){
  const num=document.getElementById('rf-num').value.trim();
  const typeId=document.getElementById('rf-type').value;
  const t=roomTypes.find(x=>x.id===typeId);
  if(!num||!typeId){toast('Szobasz√°m √©s t√≠pus k√∂telez≈ë!','er');return;}
  const data={number:num,typeId,typeName:t?.name||'',floor:document.getElementById('rf-floor').value.trim(),status:document.getElementById('rf-status').value,note:document.getElementById('rf-note').value.trim()};
  const editId=document.getElementById('rf-id').value;
  const{db,collection,addDoc,doc,updateDoc}=window._fb;
  if(editId){await updateDoc(doc(db,'rooms',editId),data);toast('Szoba friss√≠tve!','ok');}
  else{await addDoc(collection(db,'rooms'),data);toast('Szoba hozz√°adva!','ok');}
  closeM('m-room-form');await fetchAll();loadAdminRooms();renderTypes();
}
async function deleteRoom(id){
  if(!confirm('Biztosan t√∂rli a szob√°t?'))return;
  const{db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'rooms',id));
  toast('Szoba t√∂r√∂lve.','in');await fetchAll();loadAdminRooms();renderTypes();
}

// ‚îÄ‚îÄ REVIEWS ‚îÄ‚îÄ
function initRvStars(){
  const el=document.getElementById('rv-stars');if(!el)return;
  el.querySelectorAll('.star').forEach(s=>{
    s.addEventListener('click',()=>{rvRating=+s.dataset.v;el.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('on',i<rvRating));});
    s.addEventListener('mouseover',()=>el.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('hv',i<+s.dataset.v)));
    s.addEventListener('mouseout',()=>el.querySelectorAll('.star').forEach(st=>st.classList.remove('hv')));
  });
}

async function loadReviews(){
  const{db,collection,getDocs}=window._fb;
  // update type select
  const ts=document.getElementById('rv-type');
  if(ts)ts.innerHTML=roomTypes.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');

  // show/hide form based on login state
  const wrap=document.getElementById('rv-wrap');
  if(wrap){
    if(CU){
      if(!document.getElementById('rv-inner')){
        wrap.innerHTML=`<div class="pe" style="margin-bottom:1rem;">V√©lem√©ny √≠r√°sa</div><div id="rv-inner"><div class="fg" style="margin-bottom:1rem;"><label>Szobat√≠pus</label><select id="rv-type">${roomTypes.map(t=>`<option value="${t.id}">${t.name}</option>`).join('')}</select></div><div class="fg" style="margin-bottom:1rem;"><label>√ârt√©kel√©s</label><div class="stars" id="rv-stars"><span class="star" data-v="1">‚òÖ</span><span class="star" data-v="2">‚òÖ</span><span class="star" data-v="3">‚òÖ</span><span class="star" data-v="4">‚òÖ</span><span class="star" data-v="5">‚òÖ</span></div></div><div class="fg" style="margin-bottom:1.2rem;"><label>V√©lem√©ny *</label><textarea id="rv-txt" placeholder="√çrja meg tapasztalat√°t..."></textarea></div><button class="btn bg blk" onclick="submitReview()">V√©lem√©ny k√ºld√©se</button></div>`;
        initRvStars();
      }
    }else{
      wrap.innerHTML=`<div class="pe" style="margin-bottom:1rem;">V√©lem√©ny √≠r√°sa</div><p style="color:var(--tm);font-size:.82rem;line-height:1.7;">V√©lem√©ny √≠r√°s√°hoz k√©rj√ºk, <button class="btn bo bsm" onclick="go('auth')" style="margin-left:.3rem;">jelentkezzen be</button></p>`;
    }
  }

  const snap=await getDocs(collection(db,'reviews'));
  const rvs=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  const g=document.getElementById('rv-grid');
  const avgEl=document.getElementById('avg-r'),cntEl=document.getElementById('rv-cnt'),asEl=document.getElementById('avg-stars');
  if(rvs.length&&avgEl){
    const avg=(rvs.reduce((s,r)=>s+(r.rating||0),0)/rvs.length).toFixed(1);
    avgEl.textContent=avg;
    if(cntEl)cntEl.textContent=`${rvs.length} v√©lem√©ny`;
    if(asEl)asEl.innerHTML=Array(5).fill(0).map((_,i)=>`<span class="star${i<Math.round(+avg)?' on':''}">‚òÖ</span>`).join('');
  }else if(avgEl)avgEl.textContent='‚Äì';
  if(!g)return;
  if(!rvs.length){g.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--tm);font-style:italic;">M√©g nincs v√©lem√©ny.</div>';return;}
  g.innerHTML=rvs.map(r=>`<div class="rvc">
    <div class="rvh">
      <div class="rvav">${(r.name||'?')[0].toUpperCase()}</div>
      <div><div style="font-size:.82rem;font-weight:500;">${r.name||'N√©vtelen'}</div><div style="font-size:.68rem;color:var(--tm);">${r.typeName||''} ¬∑ ${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</div></div>
      <div class="stars" style="margin-left:auto;">${Array(5).fill(0).map((_,i)=>`<span class="star${i<(r.rating||0)?' on':''}">‚òÖ</span>`).join('')}</div>
    </div>
    <div class="rvtxt">${r.text}</div>
  </div>`).join('');
}

async function submitReview(){
  if(!CU){toast('Bejelentkez√©s sz√ºks√©ges!','in');return;}
  const typeId=document.getElementById('rv-type')?.value;
  const t=roomTypes.find(x=>x.id===typeId);
  const txt=document.getElementById('rv-txt')?.value.trim();
  if(!txt){toast('√çrja meg a v√©lem√©ny√©t!','er');return;}
  if(!rvRating){toast('Adjon √©rt√©kel√©st (csillagok)!','er');return;}
  const{db,collection,addDoc,serverTimestamp}=window._fb;
  await addDoc(collection(db,'reviews'),{userId:CU.uid,name:CU.email.split('@')[0],userEmail:CU.email,typeId:typeId||'',typeName:t?.name||'',rating:rvRating,text:txt,createdAt:serverTimestamp()});
  toast('K√∂sz√∂nj√ºk v√©lem√©ny√©t!','ok');
  rvRating=0;
  if(document.getElementById('rv-txt'))document.getElementById('rv-txt').value='';
  document.querySelectorAll('#rv-stars .star').forEach(s=>s.classList.remove('on'));
  loadReviews();
}

// ADMIN REVIEWS
async function loadAdminRv(){
  if(!isAdmin)return;
  const{db,collection,getDocs}=window._fb;
  const tb=document.getElementById('a-rv-tb');if(!tb)return;
  const snap=await getDocs(collection(db,'reviews'));
  const rvs=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  if(!rvs.length){tb.innerHTML='<tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--tm);">Nincs v√©lem√©ny.</td></tr>';return;}
  tb.innerHTML=rvs.map(r=>`<tr>
    <td>${r.name||'‚Äì'}<br><span style="font-size:.7rem;color:var(--tm);">${r.userEmail}</span></td>
    <td>${r.typeName||'‚Äì'}</td>
    <td><span style="color:var(--gold);">${'‚òÖ'.repeat(r.rating||0)}</span></td>
    <td style="max-width:180px;font-style:italic;font-size:.76rem;color:var(--td);">${r.text}</td>
    <td style="font-size:.72rem;color:var(--tm);">${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</td>
    <td><button class="btn bd bsm" onclick="deleteRv('${r.id}')">T√∂rl√©s</button></td>
  </tr>`).join('');
}
async function deleteRv(id){
  if(!confirm('T√∂rli?'))return;
  const{db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'reviews',id));
  toast('V√©lem√©ny t√∂r√∂lve.','in');loadAdminRv();loadReviews();
}

// ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ
async function renderCal(){
  const{db,collection,getDocs}=window._fb;
  const snap=await getDocs(collection(db,'bookings'));
  const allB=snap.docs.map(d=>d.data()).filter(b=>b.status!=='cancelled');
  const months=['Janu√°r','Febru√°r','M√°rcius','√Åprilis','M√°jus','J√∫nius','J√∫lius','Augusztus','Szeptember','Okt√≥ber','November','December'];
  document.getElementById('cal-lbl').textContent=`${months[calM]} ${calY}`;
  const g=document.getElementById('cal-grid');
  g.innerHTML=['H','K','Sze','Cs','P','Szo','V'].map(d=>`<div class="cdn">${d}</div>`).join('');
  const off=(new Date(calY,calM,1).getDay()+6)%7;
  const tot2=new Date(calY,calM+1,0).getDate();
  const td=new Date();
  for(let i=0;i<off;i++)g.innerHTML+=`<div class="cd em"></div>`;
  const totalRooms=physRooms.filter(r=>r.status==='active').length||1;
  for(let d=1;d<=tot2;d++){
    const ds=`${calY}-${String(calM+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const past=new Date(ds)<new Date(td.toDateString());
    const today=d===td.getDate()&&calM===td.getMonth()&&calY===td.getFullYear();
    const dayB=allB.filter(b=>b.checkin<=ds&&b.checkout>ds);
    let cls='cd';
    if(past)cls+=' pa';else if(today)cls+=' td2';
    else if(dayB.length>=totalRooms)cls+=' fb';
    else if(dayB.length>0)cls+=' hb';
    g.innerHTML+=`<div class="${cls}" onclick="showCalDay('${ds}',${safeJ(dayB)})">${d}</div>`;
  }
  document.getElementById('cal-p').onclick=()=>{calM--;if(calM<0){calM=11;calY--;}renderCal();};
  document.getElementById('cal-n').onclick=()=>{calM++;if(calM>11){calM=0;calY++;}renderCal();};
}

function showCalDay(ds,dayB){
  const el=document.getElementById('cal-det');
  if(!dayB.length){el.innerHTML=`<div style="font-family:'Cormorant Garamond',serif;font-size:1.1rem;margin-bottom:.5rem;">üìÖ ${ds}</div><p style="color:var(--tm);font-size:.8rem;font-style:italic;">Ezen a napon nincs foglal√°s.</p>`;return;}
  el.innerHTML=`<div style="font-family:'Cormorant Garamond',serif;font-size:1.1rem;margin-bottom:1.2rem;">üìÖ ${ds} ‚Äì ${dayB.length} foglal√°s</div>`+
    dayB.map(b=>`<div style="border:1px solid var(--bl);border-radius:var(--r);padding:.9rem;margin-bottom:.5rem;">
      <div style="font-weight:500;font-size:.82rem;margin-bottom:.2rem;">${b.typeName||'‚Äì'} ${b.roomNumber?'<span style="color:var(--gold);">#'+b.roomNumber+'</span>':''}</div>
      <div style="font-size:.72rem;color:var(--tm);">${b.firstname||''} ${b.lastname||''}</div>
      <div style="font-size:.72rem;color:var(--tm);">${b.checkin} ‚Üí ${b.checkout}</div>
      <div style="margin-top:.4rem;display:flex;gap:.4rem;flex-wrap:wrap;">
        <span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span>
        ${b.checkedIn?'<span class="badge b-ok">‚úì Check-in</span>':''}
        ${b.checkedOut?'<span class="badge b-ok">‚úì Check-out</span>':''}
      </div>
    </div>`).join('');
}

// ‚îÄ‚îÄ CHART ‚îÄ‚îÄ
function renderChart(bks){
  const c=document.getElementById('bk-chart');if(!c)return;
  const labels=[],data=[];
  for(let i=6;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    labels.push(d.toLocaleDateString('hu-HU',{month:'short',day:'numeric'}));
    data.push(bks.filter(b=>b.createdAt?.seconds&&new Date(b.createdAt.seconds*1000).toISOString().split('T')[0]===ds).length);
  }
  if(bkChart)bkChart.destroy();
  bkChart=new Chart(c,{type:'bar',data:{labels,datasets:[{label:'Foglal√°sok',data,backgroundColor:'rgba(201,168,76,.22)',borderColor:'rgba(201,168,76,.75)',borderWidth:1.5,borderRadius:2}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,.03)'},ticks:{color:'#42404e',font:{size:11,family:'Jost'}}},y:{grid:{color:'rgba(255,255,255,.03)'},ticks:{color:'#42404e',font:{size:11,family:'Jost'},stepSize:1},beginAtZero:true}}}});
}

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
function authTab(t){
  document.getElementById('auth-li').style.display=t==='li'?'':'none';
  document.getElementById('auth-reg').style.display=t==='reg'?'':'none';
  document.querySelectorAll('#page-auth .tb').forEach((b,i)=>b.classList.toggle('on',(i===0&&t==='li')||(i===1&&t==='reg')));
}
async function doLogin(){
  const{auth,signInWithEmailAndPassword}=window._fb;
  try{await signInWithEmailAndPassword(auth,document.getElementById('l-em').value,document.getElementById('l-pw').value);toast('Sikeres bejelentkez√©s!','ok');}
  catch(e){toast('Hib√°s email vagy jelsz√≥.','er');}
}
async function doReg(){
  const{auth,db,createUserWithEmailAndPassword,doc,setDoc}=window._fb;
  const em=document.getElementById('r-em').value,pw=document.getElementById('r-pw').value;
  try{
    const cred=await createUserWithEmailAndPassword(auth,em,pw);
    await setDoc(doc(db,'users',cred.user.uid),{email:em,role:'user',firstname:document.getElementById('r-fn').value,lastname:document.getElementById('r-ln').value,createdAt:new Date().toISOString()});
    toast('Sikeres regisztr√°ci√≥!','ok');
  }catch(e){toast('Hiba: '+e.message,'er');}
}
async function logout(){const{auth,signOut}=window._fb;await signOut(auth);toast('Kijelentkezett.','in');go('home');}

// ‚îÄ‚îÄ ADMIN TABS ‚îÄ‚îÄ
function aTab(t){
  ['bk','abk','typ','rm','rv'].forEach(x=>{const el=document.getElementById('at-'+x);if(el)el.style.display=t===x?'':'none';});
  document.querySelectorAll('#page-admin .tb').forEach((b,i)=>b.classList.toggle('on',['bk','abk','typ','rm','rv'][i]===t));
  if(t==='abk')initAbForm();
  if(t==='rv')loadAdminRv();
}

// ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ
function openM(id){document.getElementById(id).classList.add('op');}
function closeM(id){document.getElementById(id).classList.remove('op');}
window.addEventListener('click',e=>{if(e.target.classList.contains('mo'))document.querySelectorAll('.mo.op').forEach(m=>m.classList.remove('op'));});

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function toast(msg,type='in'){
  const ic={ok:'‚úì',er:'‚úï',in:'‚Ñπ'};
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span>${ic[type]||'‚Ñπ'}</span><span>${msg}</span>`;
  document.getElementById('toasts').appendChild(el);
  setTimeout(()=>el.remove(),4500);
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function bCls(s){return{pending:'b-p',confirmed:'b-c',cancelled:'b-x'}[s]||'b-p';}
function bLbl(s){return{pending:'F√ºgg≈ëben',confirmed:'Visszaigazolt',cancelled:'Lemondva'}[s]||s;}
function srcLbl(s){return{online:'Online',phone:'Telefon',walkin:'Szem√©lyes',email_src:'Email',admin:'Admin',other:'Egy√©b'}[s]||'Online';}
function safeJ(obj){return JSON.stringify(obj).replace(/'/g,"&#39;").replace(/"/g,'&quot;');}
</script>
</body>
</html>
