<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marciibel Hotels Budapest</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, getDoc, setDoc, query, where, doc, updateDoc, deleteDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDKTjKz5rZ0CAp6Senl95yIMetbdf_UJJ0",
    authDomain: "marciibel-hotels.firebaseapp.com",
    projectId: "marciibel-hotels",
    storageBucket: "marciibel-hotels.firebasestorage.app",
    messagingSenderId: "74569747642",
    appId: "1:74569747642:web:587b5cf2443509b8460683"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  window._fb = { auth, db, collection, addDoc, getDocs, getDoc, setDoc, query, where, doc, updateDoc, deleteDoc, serverTimestamp, orderBy, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged };
  window.dispatchEvent(new Event('firebaseReady'));
</script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>
:root {
  --bg: #080808;
  --surface: #111111;
  --surface2: #1a1a1a;
  --surface3: #222222;
  --border: #2a2a2a;
  --border-light: #333333;
  --gold: #c9a84c;
  --gold2: #e8c97a;
  --gold3: #f5e0a0;
  --gold-dim: rgba(201,168,76,0.15);
  --gold-glow: rgba(201,168,76,0.08);
  --text: #f0ece4;
  --text-dim: #8a8078;
  --text-muted: #4a4540;
  --danger: #c0392b;
  --success: #27ae60;
  --radius: 3px;
  --nav-h: 68px;
}

*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}

body {
  background:var(--bg);
  color:var(--text);
  font-family:'Jost',sans-serif;
  font-weight:300;
  min-height:100vh;
  overflow-x:hidden;
}

/* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border-light);border-radius:2px;}

/* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ */
nav {
  position:fixed;top:0;left:0;right:0;z-index:200;
  height:var(--nav-h);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 2.5rem;
  background:rgba(8,8,8,0.92);
  backdrop-filter:blur(16px);
  border-bottom:1px solid var(--border);
  transition:all 0.3s;
}
nav.scrolled { border-bottom-color:var(--gold-dim); }

.nav-logo {
  font-family:'Playfair Display',serif;
  font-size:1.3rem;
  font-weight:600;
  color:var(--gold);
  letter-spacing:0.05em;
  display:flex;align-items:center;gap:0.6rem;
  cursor:pointer;
}
.nav-logo-sub {
  font-family:'Jost',sans-serif;
  font-size:0.65rem;
  font-weight:400;
  color:var(--text-dim);
  letter-spacing:0.25em;
  text-transform:uppercase;
  line-height:1;
}

.nav-desktop {
  display:flex;align-items:center;gap:0.25rem;
}

.nav-link {
  padding:0.5rem 1rem;
  font-size:0.72rem;
  font-weight:500;
  letter-spacing:0.12em;
  text-transform:uppercase;
  color:var(--text-dim);
  cursor:pointer;
  background:none;border:none;
  font-family:'Jost',sans-serif;
  transition:all 0.2s;
  border-radius:2px;
}
.nav-link:hover{color:var(--gold);}
.nav-link.active{color:var(--gold);background:var(--gold-glow);}
.nav-link.gold{color:var(--gold);border:1px solid var(--gold-dim);}

.nav-user-pill {
  display:flex;align-items:center;gap:0.6rem;
  background:var(--surface2);
  border:1px solid var(--border-light);
  border-radius:999px;
  padding:0.3rem 0.8rem 0.3rem 0.4rem;
  font-size:0.75rem;color:var(--text-dim);
}
.nav-avatar {
  width:26px;height:26px;border-radius:50%;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#111;font-size:0.7rem;font-weight:700;
  display:flex;align-items:center;justify-content:center;
}

/* ‚îÄ‚îÄ‚îÄ HAMBURGER ‚îÄ‚îÄ‚îÄ */
.hamburger {
  display:none;
  flex-direction:column;gap:5px;
  cursor:pointer;padding:6px;
  background:none;border:none;
}
.hamburger span {
  display:block;width:22px;height:1.5px;
  background:var(--text-dim);
  transition:all 0.3s;
}
.hamburger.open span:nth-child(1){transform:translateY(6.5px) rotate(45deg);background:var(--gold);}
.hamburger.open span:nth-child(2){opacity:0;}
.hamburger.open span:nth-child(3){transform:translateY(-6.5px) rotate(-45deg);background:var(--gold);}

/* ‚îÄ‚îÄ‚îÄ MOBILE DRAWER ‚îÄ‚îÄ‚îÄ */
.mobile-drawer {
  display:none;
  position:fixed;top:var(--nav-h);right:0;bottom:0;
  width:280px;z-index:190;
  background:var(--surface);
  border-left:1px solid var(--border);
  padding:2rem 1.5rem;
  flex-direction:column;gap:0.5rem;
  transform:translateX(100%);
  transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);
}
.mobile-drawer.open{transform:translateX(0);}
.drawer-overlay {
  display:none;
  position:fixed;inset:0;z-index:180;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(2px);
}
.drawer-overlay.open{display:block;}

.mob-link {
  padding:0.85rem 1rem;
  font-size:0.8rem;font-weight:500;
  letter-spacing:0.12em;text-transform:uppercase;
  color:var(--text-dim);cursor:pointer;
  background:none;border:none;
  font-family:'Jost',sans-serif;
  border-bottom:1px solid var(--border);
  text-align:left;transition:color 0.2s;
  width:100%;
}
.mob-link:hover{color:var(--gold);}
.mob-link.active{color:var(--gold);}

/* ‚îÄ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ‚îÄ */
.page{display:none;min-height:100vh;padding-top:var(--nav-h);}
.page.active{display:block;}
.page-hero{display:none;min-height:100vh;padding-top:var(--nav-h);}
.page-hero.active{display:flex;flex-direction:column;}

.container{max-width:1160px;margin:0 auto;padding:3rem 2rem;}

/* ‚îÄ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ */
.hero-wrap {
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  position:relative;text-align:center;
  overflow:hidden;
  min-height:calc(100vh - var(--nav-h));
}
.hero-bg {
  position:absolute;inset:0;
  background:
    radial-gradient(ellipse 70% 50% at 50% 30%, rgba(201,168,76,0.07) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 20% 80%, rgba(201,168,76,0.04) 0%, transparent 60%);
}
.hero-grid {
  position:absolute;inset:0;
  background-image:
    linear-gradient(rgba(201,168,76,0.035) 1px, transparent 1px),
    linear-gradient(90deg, rgba(201,168,76,0.035) 1px, transparent 1px);
  background-size:80px 80px;
}
.hero-eyebrow {
  font-size:0.65rem;letter-spacing:0.45em;text-transform:uppercase;
  color:var(--gold);margin-bottom:2rem;
  display:flex;align-items:center;gap:1rem;
  animation:fadeUp 0.8s ease both;
}
.hero-eyebrow::before,.hero-eyebrow::after{content:'';width:40px;height:1px;background:var(--gold-dim);}
.hero-h1 {
  font-family:'Playfair Display',serif;
  font-size:clamp(2.8rem,7vw,6rem);
  font-weight:700;
  line-height:1.05;
  letter-spacing:-0.01em;
  margin-bottom:1.5rem;
  animation:fadeUp 0.8s 0.1s ease both;
}
.hero-h1 em{font-style:italic;color:var(--gold);}
.hero-desc {
  color:var(--text-dim);font-size:0.9rem;line-height:1.8;
  max-width:480px;margin:0 auto 3rem;
  animation:fadeUp 0.8s 0.2s ease both;
}
.hero-cta {
  display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;
  animation:fadeUp 0.8s 0.3s ease both;
}
.hero-stats {
  display:flex;gap:3rem;justify-content:center;
  margin-top:5rem;
  border-top:1px solid var(--border);
  padding-top:2.5rem;
  animation:fadeUp 0.8s 0.4s ease both;
}
.hero-stat-val {
  font-family:'Playfair Display',serif;
  font-size:2rem;font-weight:700;color:var(--gold);
}
.hero-stat-label{font-size:0.65rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--text-muted);margin-top:0.3rem;}

@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}

/* ‚îÄ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ‚îÄ */
.page-header{
  padding:3rem 2rem 0;
  max-width:1160px;margin:0 auto;
  border-bottom:1px solid var(--border);
  padding-bottom:2rem;margin-bottom:2.5rem;
}
.page-eyebrow{font-size:0.62rem;letter-spacing:0.4em;text-transform:uppercase;color:var(--gold);margin-bottom:0.6rem;}
.page-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,4vw,2.8rem);font-weight:600;line-height:1.1;}
.page-title em{font-style:italic;color:var(--gold);}
.page-sub{color:var(--text-dim);font-size:0.82rem;margin-top:0.4rem;letter-spacing:0.02em;}

/* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
.btn{
  display:inline-flex;align-items:center;gap:0.45rem;
  padding:0.7rem 1.8rem;
  font-family:'Jost',sans-serif;font-size:0.72rem;
  font-weight:500;letter-spacing:0.18em;text-transform:uppercase;
  cursor:pointer;border:none;transition:all 0.25s;border-radius:var(--radius);
}
.btn-gold{background:var(--gold);color:#080808;font-weight:600;}
.btn-gold:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 8px 24px rgba(201,168,76,0.25);}
.btn-outline{background:transparent;color:var(--gold);border:1px solid var(--gold-dim);}
.btn-outline:hover{background:var(--gold-glow);border-color:var(--gold);}
.btn-ghost{background:transparent;color:var(--text-dim);border:1px solid var(--border-light);}
.btn-ghost:hover{border-color:var(--text-dim);color:var(--text);}
.btn-danger{background:var(--danger);color:#fff;}
.btn-danger:hover{background:#e74c3c;}
.btn-success{background:var(--success);color:#fff;}
.btn-success:hover{background:#2ecc71;}
.btn-sm{padding:0.45rem 1rem;font-size:0.68rem;}
.btn-lg{padding:0.9rem 2.5rem;font-size:0.78rem;}
.btn-block{width:100%;justify-content:center;}

/* ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ */
.card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);
}
.card-gold{border-color:var(--gold-dim);}

/* ‚îÄ‚îÄ‚îÄ ROOMS ‚îÄ‚îÄ‚îÄ */
.rooms-toolbar{
  display:flex;gap:1rem;align-items:center;
  flex-wrap:wrap;margin-bottom:2rem;
}
.search-box{
  position:relative;flex:1;min-width:200px;
}
.search-box input{
  background:var(--surface);border:1px solid var(--border-light);
  color:var(--text);padding:0.65rem 1rem 0.65rem 2.5rem;
  font-family:'Jost',sans-serif;font-size:0.82rem;
  border-radius:var(--radius);width:100%;outline:none;
  transition:border-color 0.2s;
}
.search-box input:focus{border-color:var(--gold);}
.search-box::before{content:'‚åï';position:absolute;left:0.85rem;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:1.1rem;}
.filter-select{
  background:var(--surface);border:1px solid var(--border-light);
  color:var(--text-dim);padding:0.65rem 1rem;
  font-family:'Jost',sans-serif;font-size:0.78rem;
  border-radius:var(--radius);outline:none;
  transition:border-color 0.2s;cursor:pointer;
}
.filter-select:focus{border-color:var(--gold);}
.filter-select option{background:var(--surface);}

.rooms-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:1.5rem;
}

.room-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);overflow:hidden;
  transition:transform 0.3s,border-color 0.3s,box-shadow 0.3s;
  cursor:pointer;
}
.room-card:hover{transform:translateY(-4px);border-color:var(--gold-dim);box-shadow:0 16px 40px rgba(0,0,0,0.4);}

.room-gallery{position:relative;height:220px;overflow:hidden;background:var(--surface2);}
.room-gallery-slide{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:5rem;
  transition:opacity 0.5s,transform 0.5s;
  background:linear-gradient(135deg,var(--surface2) 0%,#1e1a10 100%);
}
.room-gallery-slide.hidden{opacity:0;transform:scale(1.05);}
.gallery-dots{
  position:absolute;bottom:0.75rem;left:50%;transform:translateX(-50%);
  display:flex;gap:0.35rem;
}
.gallery-dot{
  width:5px;height:5px;border-radius:50%;
  background:rgba(255,255,255,0.3);
  transition:background 0.2s,transform 0.2s;cursor:pointer;
}
.gallery-dot.active{background:var(--gold);transform:scale(1.3);}
.room-badge-wrap{position:absolute;top:0.75rem;left:0.75rem;display:flex;gap:0.4rem;}
.room-badge{
  padding:0.2rem 0.6rem;font-size:0.6rem;letter-spacing:0.15em;
  text-transform:uppercase;border-radius:2px;font-weight:600;
}
.badge-available{background:rgba(39,174,96,0.2);color:#2ecc71;border:1px solid rgba(39,174,96,0.3);}
.badge-featured{background:rgba(201,168,76,0.2);color:var(--gold);border:1px solid var(--gold-dim);}

.room-body{padding:1.5rem;}
.room-name{
  font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:600;
  margin-bottom:0.35rem;
  display:flex;align-items:baseline;gap:0.6rem;
}
.room-code{font-family:'Jost',sans-serif;font-size:0.65rem;color:var(--text-muted);font-weight:400;letter-spacing:0.1em;}
.room-desc{color:var(--text-dim);font-size:0.8rem;line-height:1.6;margin-bottom:1rem;}
.room-amenities{display:flex;flex-wrap:wrap;gap:0.4rem;margin-bottom:1.25rem;}
.amenity-tag{
  background:var(--surface2);border:1px solid var(--border-light);
  color:var(--text-dim);padding:0.2rem 0.55rem;
  font-size:0.65rem;letter-spacing:0.05em;border-radius:2px;
}
.room-footer{
  display:flex;align-items:center;justify-content:space-between;
  padding-top:1rem;border-top:1px solid var(--border);
}
.room-price{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:600;color:var(--gold);}
.room-price small{font-family:'Jost',sans-serif;font-size:0.65rem;color:var(--text-muted);font-weight:300;}
.room-capacity{font-size:0.72rem;color:var(--text-muted);}

/* ‚îÄ‚îÄ‚îÄ RATING STARS ‚îÄ‚îÄ‚îÄ */
.stars{display:flex;gap:2px;}
.star{color:var(--text-muted);font-size:0.85rem;cursor:pointer;transition:color 0.15s;}
.star.filled,.star:hover,.star.hover{color:var(--gold);}

/* ‚îÄ‚îÄ‚îÄ REVIEWS ‚îÄ‚îÄ‚îÄ */
.reviews-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.25rem;}
.review-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:1.5rem;
  transition:border-color 0.2s;
}
.review-card:hover{border-color:var(--gold-dim);}
.review-header{display:flex;align-items:center;gap:0.75rem;margin-bottom:0.75rem;}
.review-avatar{
  width:36px;height:36px;border-radius:50%;
  background:linear-gradient(135deg,var(--surface2),var(--surface3));
  border:1px solid var(--border-light);
  display:flex;align-items:center;justify-content:center;
  font-size:0.85rem;color:var(--gold);font-family:'Playfair Display',serif;
}
.review-name{font-size:0.82rem;font-weight:500;}
.review-date{font-size:0.7rem;color:var(--text-muted);}
.review-text{font-size:0.8rem;color:var(--text-dim);line-height:1.65;font-style:italic;}
.review-text::before{content:'"';font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--gold-dim);line-height:0;vertical-align:-0.4em;margin-right:0.2rem;}

/* ‚îÄ‚îÄ‚îÄ BOOKING WIZARD ‚îÄ‚îÄ‚îÄ */
.wizard-steps{
  display:flex;align-items:center;
  margin-bottom:2.5rem;
  gap:0;
}
.wizard-step{
  display:flex;align-items:center;gap:0.75rem;
  flex:1;position:relative;
}
.wizard-step:not(:last-child)::after{
  content:'';flex:1;height:1px;
  background:var(--border);
  margin:0 1rem;
  transition:background 0.4s;
}
.wizard-step.done:not(:last-child)::after{background:var(--gold-dim);}
.step-num{
  width:34px;height:34px;border-radius:50%;
  border:1.5px solid var(--border-light);
  display:flex;align-items:center;justify-content:center;
  font-size:0.72rem;font-weight:600;color:var(--text-muted);
  transition:all 0.3s;flex-shrink:0;
}
.wizard-step.active .step-num{border-color:var(--gold);color:var(--gold);background:var(--gold-glow);}
.wizard-step.done .step-num{border-color:var(--gold);color:#080808;background:var(--gold);}
.step-label{font-size:0.7rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--text-muted);transition:color 0.3s;}
.wizard-step.active .step-label{color:var(--gold);}
.wizard-step.done .step-label{color:var(--text-dim);}

.wizard-panel{display:none;animation:fadeUp 0.3s ease;}
.wizard-panel.active{display:block;}

/* ‚îÄ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ‚îÄ */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.form-row.three{grid-template-columns:1fr 1fr 1fr;}
@media(max-width:600px){.form-row,.form-row.three{grid-template-columns:1fr;}}
.form-group{display:flex;flex-direction:column;gap:0.4rem;}

label{font-size:0.68rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--text-dim);font-weight:500;}

input,select,textarea{
  background:var(--surface2);border:1px solid var(--border-light);
  color:var(--text);padding:0.75rem 1rem;
  font-family:'Jost',sans-serif;font-size:0.85rem;
  border-radius:var(--radius);width:100%;outline:none;
  transition:border-color 0.2s,box-shadow 0.2s;
}
input:focus,select:focus,textarea:focus{
  border-color:var(--gold);
  box-shadow:0 0 0 3px rgba(201,168,76,0.08);
}
input::placeholder{color:var(--text-muted);}
textarea{resize:vertical;min-height:90px;}
select option{background:var(--surface2);}

/* ‚îÄ‚îÄ‚îÄ SUMMARY BOX ‚îÄ‚îÄ‚îÄ */
.summary-box{
  background:var(--surface2);border:1px solid var(--border-light);
  border-radius:var(--radius);padding:1.5rem;
  position:sticky;top:calc(var(--nav-h) + 1rem);
}
.summary-title{
  font-family:'Playfair Display',serif;font-size:1rem;
  border-bottom:1px solid var(--border);padding-bottom:0.75rem;margin-bottom:1rem;
}
.summary-row{display:flex;justify-content:space-between;font-size:0.8rem;padding:0.35rem 0;color:var(--text-dim);}
.summary-row.total{
  border-top:1px solid var(--border);margin-top:0.5rem;padding-top:0.85rem;
  font-size:1rem;color:var(--text);
}
.summary-row.total span:last-child{color:var(--gold);font-family:'Playfair Display',serif;font-size:1.1rem;}
.summary-note{
  font-size:0.7rem;color:var(--text-muted);letter-spacing:0.05em;
  margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid var(--border);
  line-height:1.6;
}

/* ‚îÄ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ‚îÄ */
.cal-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.75rem;}
.cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;}
.cal-month-label{font-family:'Playfair Display',serif;font-size:1.1rem;}
.cal-btn{
  width:34px;height:34px;border:1px solid var(--border-light);
  background:transparent;color:var(--text-dim);cursor:pointer;
  font-size:1rem;display:flex;align-items:center;justify-content:center;
  border-radius:var(--radius);transition:all 0.2s;
}
.cal-btn:hover{border-color:var(--gold);color:var(--gold);}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cal-dn{text-align:center;font-size:0.6rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);padding:0.4rem 0;}
.cal-d{
  aspect-ratio:1;display:flex;align-items:center;justify-content:center;
  font-size:0.78rem;border-radius:var(--radius);cursor:pointer;
  transition:all 0.15s;font-weight:400;
}
.cal-d:hover:not(.empty):not(.past){background:var(--gold-glow);color:var(--gold);}
.cal-d.empty,.cal-d.past{cursor:default;color:var(--text-muted);opacity:0.4;}
.cal-d.today{background:var(--gold-glow);color:var(--gold);font-weight:600;}
.cal-d.has-booking{background:rgba(201,168,76,0.12);color:var(--gold);}
.cal-d.fully-booked{background:rgba(192,57,43,0.15);color:#e74c3c;}
.cal-legend{display:flex;gap:1.25rem;margin-top:1.25rem;flex-wrap:wrap;}
.leg-item{display:flex;align-items:center;gap:0.4rem;font-size:0.68rem;color:var(--text-muted);}
.leg-dot{width:8px;height:8px;border-radius:2px;}

/* ‚îÄ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ‚îÄ */
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th{
  background:var(--surface2);padding:0.75rem 1rem;
  text-align:left;font-size:0.62rem;font-weight:600;
  letter-spacing:0.18em;text-transform:uppercase;color:var(--text-muted);
  border-bottom:1px solid var(--border);white-space:nowrap;
}
td{padding:1rem;border-bottom:1px solid var(--border);font-size:0.82rem;vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,0.015);}

/* ‚îÄ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;padding:0.22rem 0.65rem;border-radius:2px;font-size:0.65rem;font-weight:600;letter-spacing:0.08em;}
.badge-pending{background:rgba(241,196,15,0.1);color:#f1c40f;border:1px solid rgba(241,196,15,0.2);}
.badge-confirmed{background:rgba(39,174,96,0.1);color:#27ae60;border:1px solid rgba(39,174,96,0.2);}
.badge-cancelled{background:rgba(192,57,43,0.1);color:#c0392b;border:1px solid rgba(192,57,43,0.2);}

/* ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;margin-bottom:2rem;}
.stat-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:1.5rem;
  transition:border-color 0.2s;
}
.stat-card:hover{border-color:var(--gold-dim);}
.stat-label{font-size:0.62rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-muted);margin-bottom:0.5rem;}
.stat-val{font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:var(--gold);}
.stat-sub{font-size:0.7rem;color:var(--text-muted);margin-top:0.25rem;}

/* ‚îÄ‚îÄ‚îÄ CHART ‚îÄ‚îÄ‚îÄ */
.chart-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.75rem;margin-bottom:2rem;}
.chart-title{font-family:'Playfair Display',serif;font-size:0.95rem;margin-bottom:1.25rem;color:var(--text-dim);}

/* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
.modal-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,0.85);backdrop-filter:blur(6px);
  z-index:300;align-items:center;justify-content:center;padding:1rem;
}
.modal-overlay.open{display:flex;}
.modal{
  background:var(--surface);border:1px solid var(--border-light);
  border-radius:var(--radius);padding:2.5rem;
  width:100%;max-width:520px;position:relative;
  animation:modalIn 0.25s ease;
  max-height:90vh;overflow-y:auto;
}
@keyframes modalIn{from{transform:translateY(12px) scale(0.97);opacity:0;}to{transform:translateY(0) scale(1);opacity:1;}}
.modal-close{
  position:absolute;top:1.25rem;right:1.25rem;
  background:var(--surface2);border:1px solid var(--border-light);
  color:var(--text-dim);width:30px;height:30px;border-radius:50%;
  cursor:pointer;font-size:0.8rem;display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;
}
.modal-close:hover{border-color:var(--gold);color:var(--gold);}
.modal-title{font-family:'Playfair Display',serif;font-size:1.4rem;margin-bottom:0.3rem;}
.modal-sub{font-size:0.78rem;color:var(--text-dim);margin-bottom:1.75rem;letter-spacing:0.02em;}

/* ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ */
.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:1.75rem;}
.tab-btn{
  padding:0.65rem 1.4rem;font-size:0.7rem;font-weight:500;
  letter-spacing:0.12em;text-transform:uppercase;
  cursor:pointer;background:none;border:none;color:var(--text-muted);
  border-bottom:2px solid transparent;margin-bottom:-1px;
  font-family:'Jost',sans-serif;transition:all 0.2s;
}
.tab-btn.active{color:var(--gold);border-bottom-color:var(--gold);}
.tab-btn:hover:not(.active){color:var(--text-dim);}

/* ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ */
.auth-wrap{
  min-height:calc(100vh - var(--nav-h));
  display:flex;align-items:center;justify-content:center;
  padding:3rem 1rem;
  background:radial-gradient(ellipse 60% 60% at 50% 50%,rgba(201,168,76,0.04) 0%,transparent 70%);
}
.auth-card{
  background:var(--surface);border:1px solid var(--border-light);
  border-radius:var(--radius);padding:3rem;
  width:100%;max-width:440px;
}
.auth-logo{
  font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:600;
  color:var(--gold);text-align:center;margin-bottom:2rem;
  letter-spacing:0.05em;
}

/* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
#toasts{position:fixed;bottom:2rem;right:2rem;z-index:400;display:flex;flex-direction:column;gap:0.5rem;}
.toast{
  display:flex;align-items:center;gap:0.75rem;
  padding:0.9rem 1.25rem;border-radius:var(--radius);
  font-size:0.8rem;font-weight:400;
  background:var(--surface);border:1px solid var(--border-light);
  box-shadow:0 8px 24px rgba(0,0,0,0.5);
  animation:toastIn 0.3s ease;max-width:330px;
}
.toast.success{border-left:3px solid var(--success);}
.toast.error{border-left:3px solid var(--danger);}
.toast.info{border-left:3px solid var(--gold);}
@keyframes toastIn{from{transform:translateX(20px);opacity:0;}to{transform:translateX(0);opacity:1;}}

/* ‚îÄ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ‚îÄ */
.divider{display:flex;align-items:center;gap:1rem;margin:1.5rem 0;color:var(--text-muted);font-size:0.7rem;letter-spacing:0.1em;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}

/* ‚îÄ‚îÄ‚îÄ INFO BOX ‚îÄ‚îÄ‚îÄ */
.info-box{
  background:var(--gold-glow);border:1px solid var(--gold-dim);
  border-radius:var(--radius);padding:0.9rem 1.1rem;
  font-size:0.78rem;color:var(--text-dim);margin-bottom:1.75rem;
  letter-spacing:0.02em;line-height:1.6;
}

/* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
.empty-state{text-align:center;padding:4rem 2rem;color:var(--text-muted);}
.empty-state .icon{font-size:2.5rem;margin-bottom:1rem;opacity:0.5;}
.empty-state p{font-size:0.82rem;letter-spacing:0.05em;}

/* ‚îÄ‚îÄ‚îÄ ADMIN BOOKING FORM ‚îÄ‚îÄ‚îÄ */
.admin-booking-banner{
  background:linear-gradient(135deg,var(--surface2),var(--surface3));
  border:1px solid var(--gold-dim);border-radius:var(--radius);
  padding:1.25rem 1.5rem;margin-bottom:1.5rem;
  display:flex;align-items:center;gap:1rem;
  font-size:0.82rem;color:var(--text-dim);
}
.admin-booking-banner .icon{font-size:1.5rem;}

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
@media(max-width:900px){
  .hamburger{display:flex;}
  .nav-desktop{display:none;}
  .mobile-drawer{display:flex;}
  .hero-stats{gap:1.5rem;flex-wrap:wrap;}
}
@media(max-width:640px){
  nav{padding:0 1.25rem;}
  .container{padding:2rem 1rem;}
  .auth-card{padding:2rem 1.5rem;}
  .modal{padding:1.75rem;}
  .page-header{padding:2rem 1rem 1.5rem;}
  .hero-h1{font-size:2.2rem;}
}

/* ‚îÄ‚îÄ‚îÄ GOLD LINE DECORATION ‚îÄ‚îÄ‚îÄ */
.gold-line{width:40px;height:1px;background:var(--gold);margin-bottom:1rem;}
</style>
</head>
<body>

<!-- NAV -->
<nav id="main-nav">
  <div class="nav-logo" onclick="showPage('home')">
    <span>üè®</span>
    <div>
      Marciibel
      <div class="nav-logo-sub">Hotels Budapest</div>
    </div>
  </div>

  <div class="nav-desktop">
    <button class="nav-link active" onclick="showPage('home')">F≈ëoldal</button>
    <button class="nav-link" onclick="showPage('rooms')">Szob√°k</button>
    <button class="nav-link" onclick="showPage('calendar')">Napt√°r</button>
    <button class="nav-link" onclick="showPage('reviews')">V√©lem√©nyek</button>
    <button class="nav-link" id="nav-mybookings" style="display:none" onclick="showPage('mybookings')">Foglal√°saim</button>
    <button class="nav-link gold" id="nav-admin" style="display:none" onclick="showPage('admin')">‚öô Admin</button>
    <div class="nav-user-pill" id="nav-user" style="display:none">
      <div class="nav-avatar" id="nav-avatar">?</div>
      <span id="nav-email" style="max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.75rem;"></span>
      <button class="nav-link" style="padding:0.3rem 0.5rem;" onclick="logout()">Ki</button>
    </div>
    <button class="nav-link" id="nav-auth" onclick="showPage('auth')">Bejelentkez√©s</button>
  </div>

  <button class="hamburger" id="hamburger" onclick="toggleDrawer()">
    <span></span><span></span><span></span>
  </button>
</nav>

<!-- DRAWER OVERLAY -->
<div class="drawer-overlay" id="drawer-overlay" onclick="toggleDrawer()"></div>

<!-- MOBILE DRAWER -->
<div class="mobile-drawer" id="mobile-drawer">
  <button class="mob-link active" onclick="showPage('home');toggleDrawer()">üè† F≈ëoldal</button>
  <button class="mob-link" onclick="showPage('rooms');toggleDrawer()">üõèÔ∏è Szob√°k</button>
  <button class="mob-link" onclick="showPage('calendar');toggleDrawer()">üìÖ Napt√°r</button>
  <button class="mob-link" onclick="showPage('reviews');toggleDrawer()">‚≠ê V√©lem√©nyek</button>
  <button class="mob-link" id="mob-mybookings" style="display:none" onclick="showPage('mybookings');toggleDrawer()">üìã Foglal√°saim</button>
  <button class="mob-link" id="mob-admin" style="display:none" onclick="showPage('admin');toggleDrawer()">‚öôÔ∏è Admin</button>
  <div style="border-top:1px solid var(--border);margin-top:auto;padding-top:1rem;">
    <div id="mob-user-info" style="display:none;font-size:0.75rem;color:var(--text-dim);padding:0.5rem 1rem;margin-bottom:0.5rem;" id="mob-email"></div>
    <button class="mob-link" id="mob-auth" onclick="showPage('auth');toggleDrawer()">üîë Bejelentkez√©s</button>
    <button class="mob-link" id="mob-logout" style="display:none;color:var(--danger);" onclick="logout();toggleDrawer()">‚Ü© Kil√©p√©s</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-home" class="page-hero active">
  <div class="hero-wrap">
    <div class="hero-bg"></div>
    <div class="hero-grid"></div>
    <div style="position:relative;max-width:700px;padding:2rem;">
      <div class="hero-eyebrow">Budapest pr√©mium sz√°llod√°ja</div>
      <h1 class="hero-h1">Marciibel<br><em>Hotels</em> Budapest</h1>
      <p class="hero-desc">Foglaljon szob√°t egyszer≈±en √©s gyorsan. Pr√©mium szob√°k, kiv√°l√≥ elhelyezked√©s ‚Äì fizet√©s √©rkez√©skor, helysz√≠nen.</p>
      <div class="hero-cta">
        <button class="btn btn-gold btn-lg" onclick="showPage('rooms')">Szob√°k megtekint√©se</button>
        <button class="btn btn-outline btn-lg" onclick="showPage('calendar')">Napt√°r n√©zet</button>
      </div>
      <div class="hero-stats">
        <div>
          <div class="hero-stat-val">4</div>
          <div class="hero-stat-label">Pr√©mium szoba</div>
        </div>
        <div style="width:1px;background:var(--border);"></div>
        <div>
          <div class="hero-stat-val">‚òÖ 4.9</div>
          <div class="hero-stat-label">Vend√©g√©rt√©kel√©s</div>
        </div>
        <div style="width:1px;background:var(--border);"></div>
        <div>
          <div class="hero-stat-val">24/7</div>
          <div class="hero-stat-label">Recepci√≥</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROOMS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-rooms" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Szob√°k & Suites</div>
    <h2 class="page-title">V√°lasszon <em>szob√°t</em></h2>
    <p class="page-sub">K√©nyelmes √©s eleg√°ns szob√°ink k√∂z√ºl minden ig√©nyt kiel√©g√≠t</p>
  </div>
  <div class="container" style="padding-top:0;">
    <div class="rooms-toolbar">
      <div class="search-box">
        <input type="text" id="room-search" placeholder="Szoba keres√©se..." oninput="filterRooms()">
      </div>
      <select class="filter-select" id="room-sort" onchange="filterRooms()">
        <option value="">Rendez√©s: alap√©rtelmezett</option>
        <option value="price-asc">√År: alacsonyabb el≈ëbb</option>
        <option value="price-desc">√År: magasabb el≈ëbb</option>
        <option value="capacity">Kapacit√°s</option>
      </select>
      <select class="filter-select" id="room-cap-filter" onchange="filterRooms()">
        <option value="">Minden kapacit√°s</option>
        <option value="1">1-2 f≈ë</option>
        <option value="3">3+ f≈ë</option>
      </select>
    </div>
    <div class="rooms-grid" id="rooms-grid">
      <div class="empty-state"><div class="icon">‚è≥</div><p>Bet√∂lt√©s...</p></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-calendar" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Foglalts√°g √°ttekint√©se</div>
    <h2 class="page-title">Napt√°r <em>n√©zet</em></h2>
    <p class="page-sub">Kattintson egy napra a r√©szletek megtekint√©s√©hez</p>
  </div>
  <div class="container" style="padding-top:0;display:grid;grid-template-columns:1fr 360px;gap:1.5rem;align-items:start;">
    <div class="cal-wrap">
      <div class="cal-head">
        <button class="cal-btn" id="cal-prev">‚Äπ</button>
        <div class="cal-month-label" id="cal-label"></div>
        <button class="cal-btn" id="cal-next">‚Ä∫</button>
      </div>
      <div class="cal-grid" id="cal-grid"></div>
      <div class="cal-legend">
        <div class="leg-item"><div class="leg-dot" style="background:rgba(201,168,76,0.2);border:1px solid var(--gold-dim);"></div>R√©szben foglalt</div>
        <div class="leg-item"><div class="leg-dot" style="background:rgba(192,57,43,0.2);border:1px solid rgba(192,57,43,0.3);"></div>Tele</div>
        <div class="leg-item"><div class="leg-dot" style="background:var(--gold-glow);border:1px solid var(--gold-dim);"></div>Ma</div>
      </div>
    </div>
    <div class="card" style="padding:1.75rem;" id="cal-detail">
      <p style="color:var(--text-muted);font-size:0.82rem;font-style:italic;">Kattintson egy napra...</p>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REVIEWS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-reviews" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Vend√©geink mondt√°k</div>
    <h2 class="page-title">V√©le<em>m√©nyek</em></h2>
    <p class="page-sub">Ossza meg tapasztalat√°t ‚Äì seg√≠tsen m√°s vend√©geknek d√∂nteni</p>
  </div>
  <div class="container" style="padding-top:0;">
    <div style="display:flex;gap:1.5rem;align-items:start;flex-wrap:wrap;margin-bottom:2.5rem;">
      <!-- Write review -->
      <div class="card card-gold" style="padding:1.75rem;flex:1;min-width:280px;" id="review-form-wrap">
        <div class="gold-line"></div>
        <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.25rem;">√çrjon v√©lem√©nyt</div>
        <div id="review-form-inner">
          <div class="form-group" style="margin-bottom:1rem;">
            <label>Szoba</label>
            <select id="rv-room"></select>
          </div>
          <div class="form-group" style="margin-bottom:1rem;">
            <label>√ârt√©kel√©s</label>
            <div class="stars" id="rv-stars">
              <span class="star" data-v="1">‚òÖ</span>
              <span class="star" data-v="2">‚òÖ</span>
              <span class="star" data-v="3">‚òÖ</span>
              <span class="star" data-v="4">‚òÖ</span>
              <span class="star" data-v="5">‚òÖ</span>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:1.25rem;">
            <label>V√©lem√©ny sz√∂vege</label>
            <textarea id="rv-text" placeholder="√çrja meg tapasztalat√°t..."></textarea>
          </div>
          <button class="btn btn-gold btn-block" onclick="submitReview()">V√©lem√©ny k√ºld√©se</button>
        </div>
      </div>
      <!-- Stats -->
      <div style="display:flex;flex-direction:column;gap:1rem;min-width:200px;">
        <div class="card" style="padding:1.5rem;text-align:center;">
          <div style="font-family:'Playfair Display',serif;font-size:3rem;font-weight:700;color:var(--gold);" id="avg-rating">‚Äì</div>
          <div class="stars" style="justify-content:center;margin:0.5rem 0;" id="avg-stars"></div>
          <div style="font-size:0.72rem;color:var(--text-muted);letter-spacing:0.1em;" id="review-count">0 v√©lem√©ny</div>
        </div>
      </div>
    </div>
    <div class="reviews-grid" id="reviews-grid">
      <div class="empty-state"><div class="icon">üí¨</div><p>M√©g nincs v√©lem√©ny.</p></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOOKING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-booking" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Online foglal√°s</div>
    <h2 class="page-title">Szoba <em>foglal√°s</em></h2>
    <p class="page-sub">T√∂ltse ki az adatokat ‚Äì fizet√©s √©rkez√©skor, helysz√≠nen</p>
  </div>
  <div class="container" style="padding-top:0;">
    <div class="info-box">üí° Az online fizet√©s nem sz√ºks√©ges. A sz√°ml√°t √©rkez√©skor rendezi helysz√≠nen.</div>

    <!-- Wizard steps -->
    <div class="wizard-steps" id="wizard-steps">
      <div class="wizard-step active" data-step="1">
        <div class="step-num">1</div>
        <div class="step-label">Szoba & D√°tum</div>
      </div>
      <div class="wizard-step" data-step="2">
        <div class="step-num">2</div>
        <div class="step-label">Szem√©lyes adatok</div>
      </div>
      <div class="wizard-step" data-step="3">
        <div class="step-num">3</div>
        <div class="step-label">√ñsszes√≠t≈ë</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 320px;gap:1.5rem;align-items:start;">
      <div>
        <!-- Step 1 -->
        <div class="wizard-panel active" id="step-1">
          <div class="card" style="padding:1.75rem;">
            <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.25rem;color:var(--text-dim);">Szoba √©s id≈ëpont kiv√°laszt√°sa</div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="form-group">
                <label>Szoba kiv√°laszt√°sa *</label>
                <select id="b-room" onchange="updateSummary()"></select>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>√ârkez√©s *</label>
                  <input type="date" id="b-checkin" onchange="updateSummary()">
                </div>
                <div class="form-group">
                  <label>T√°voz√°s *</label>
                  <input type="date" id="b-checkout" onchange="updateSummary()">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Feln≈ëttek</label>
                  <select id="b-adults" onchange="updateSummary()">
                    <option>1</option><option selected>2</option><option>3</option><option>4</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Gyerekek</label>
                  <select id="b-children" onchange="updateSummary()">
                    <option selected>0</option><option>1</option><option>2</option><option>3</option>
                  </select>
                </div>
              </div>
            </div>
            <br>
            <button class="btn btn-gold" onclick="wizardNext(1)">Tov√°bb ‚Üí</button>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="wizard-panel" id="step-2">
          <div class="card" style="padding:1.75rem;">
            <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.25rem;color:var(--text-dim);">Szem√©lyes adatok</div>

            <!-- Admin foglal√≥ mez≈ë -->
            <div id="admin-for-field" style="display:none;margin-bottom:1.25rem;">
              <div class="admin-booking-banner">
                <span class="icon">üìû</span>
                <div>
                  <div style="font-weight:500;color:var(--text);font-size:0.82rem;margin-bottom:0.2rem;">Admin foglal√°s</div>
                  <div>Telefonh√≠v√°s vagy szem√©lyes megkeres√©s alapj√°n foglal.</div>
                </div>
              </div>
              <div class="form-group">
                <label>Foglal√°s forr√°sa</label>
                <select id="b-source">
                  <option value="phone">Telefonh√≠v√°s</option>
                  <option value="walkin">Szem√©lyes megjelen√©s</option>
                  <option value="email">Email</option>
                  <option value="other">Egy√©b</option>
                </select>
              </div>
              <br>
            </div>

            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="form-row">
                <div class="form-group">
                  <label>Keresztn√©v *</label>
                  <input type="text" id="b-firstname" placeholder="P√©ter">
                </div>
                <div class="form-group">
                  <label>Vezet√©kn√©v *</label>
                  <input type="text" id="b-lastname" placeholder="Nagy">
                </div>
              </div>
              <div class="form-group">
                <label>Email c√≠m *</label>
                <input type="email" id="b-email" placeholder="pelda@email.hu">
              </div>
              <div class="form-group">
                <label>Telefonsz√°m</label>
                <input type="tel" id="b-phone" placeholder="+36 30 123 4567">
              </div>
              <div class="form-group">
                <label>Megjegyz√©s</label>
                <textarea id="b-notes" placeholder="K√ºl√∂nleges k√©r√©sek, megjegyz√©sek..."></textarea>
              </div>
            </div>
            <br>
            <div style="display:flex;gap:0.75rem;">
              <button class="btn btn-ghost" onclick="wizardPrev(2)">‚Üê Vissza</button>
              <button class="btn btn-gold" onclick="wizardNext(2)">Tov√°bb ‚Üí</button>
            </div>
          </div>
        </div>

        <!-- Step 3: Confirm -->
        <div class="wizard-panel" id="step-3">
          <div class="card" style="padding:1.75rem;">
            <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.25rem;color:var(--text-dim);">Foglal√°s meger≈ës√≠t√©se</div>
            <div id="step3-summary" style="margin-bottom:1.5rem;"></div>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
              <button class="btn btn-ghost" onclick="wizardPrev(3)">‚Üê Vissza</button>
              <button class="btn btn-gold btn-lg" onclick="submitBooking()">‚úì Foglal√°s v√©gleges√≠t√©se</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar summary -->
      <div class="summary-box" id="booking-summary">
        <div class="summary-title">√ñsszes√≠t≈ë</div>
        <div id="summary-content"><p style="color:var(--text-muted);font-size:0.8rem;font-style:italic;">V√°lasszon szob√°t √©s d√°tumot</p></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MY BOOKINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-mybookings" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Saj√°t foglal√°sok</div>
    <h2 class="page-title">Foglal√°<em>saim</em></h2>
    <p class="page-sub">Akt√≠v √©s kor√°bbi foglal√°sai</p>
  </div>
  <div class="container" style="padding-top:0;">
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Szoba</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>St√°tusz</th><th>√ñsszeg</th><th></th></tr></thead>
          <tbody id="my-tbody"><tr><td colspan="7" style="text-align:center;padding:3rem;color:var(--text-muted);">Bet√∂lt√©s...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-auth" class="page">
  <div class="auth-wrap">
    <div class="auth-card">
      <div class="auth-logo">üè® Marciibel Hotels Budapest</div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchAuthTab('login')">Bejelentkez√©s</button>
        <button class="tab-btn" onclick="switchAuthTab('register')">Regisztr√°ci√≥</button>
      </div>
      <div id="auth-login">
        <div class="form-group" style="margin-bottom:1rem;"><label>Email c√≠m</label><input type="email" id="l-email" placeholder="email@example.com"></div>
        <div class="form-group" style="margin-bottom:1.5rem;"><label>Jelsz√≥</label><input type="password" id="l-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <button class="btn btn-gold btn-block" onclick="doLogin()">Bejelentkez√©s</button>
      </div>
      <div id="auth-register" style="display:none;">
        <div class="form-row" style="margin-bottom:1rem;">
          <div class="form-group"><label>Keresztn√©v</label><input type="text" id="r-fn"></div>
          <div class="form-group"><label>Vezet√©kn√©v</label><input type="text" id="r-ln"></div>
        </div>
        <div class="form-group" style="margin-bottom:1rem;"><label>Email c√≠m</label><input type="email" id="r-email"></div>
        <div class="form-group" style="margin-bottom:1.5rem;"><label>Jelsz√≥ (min. 6 karakter)</label><input type="password" id="r-pass"></div>
        <button class="btn btn-gold btn-block" onclick="doRegister()">Regisztr√°ci√≥</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-admin" class="page">
  <div class="page-header">
    <div class="page-eyebrow">Vez√©rl≈ëpult</div>
    <h2 class="page-title">Admin <em>fel√ºlet</em></h2>
    <p class="page-sub">Foglal√°sok, szob√°k √©s v√©lem√©nyek kezel√©se</p>
  </div>
  <div class="container" style="padding-top:0;">
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-label">√ñsszes foglal√°s</div><div class="stat-val" id="s-total">‚Äì</div></div>
      <div class="stat-card"><div class="stat-label">F√ºgg≈ëben</div><div class="stat-val" id="s-pending">‚Äì</div></div>
      <div class="stat-card"><div class="stat-label">Visszaigazolt</div><div class="stat-val" id="s-confirmed">‚Äì</div></div>
      <div class="stat-card"><div class="stat-label">Bev√©tel (visszaig.)</div><div class="stat-val" id="s-revenue">‚Äì</div></div>
    </div>

    <!-- Chart -->
    <div class="chart-wrap">
      <div class="chart-title">Foglal√°sok az elm√∫lt 7 napban</div>
      <canvas id="bookings-chart" height="90"></canvas>
    </div>

    <div class="tabs">
      <button class="tab-btn active" onclick="switchAdminTab('bookings')">Foglal√°sok</button>
      <button class="tab-btn" onclick="switchAdminTab('admin-book')">Admin foglal√°s</button>
      <button class="tab-btn" onclick="switchAdminTab('rooms')">Szob√°k</button>
      <button class="tab-btn" onclick="switchAdminTab('reviews-admin')">V√©lem√©nyek</button>
    </div>

    <!-- Bookings list -->
    <div id="atab-bookings">
      <div style="display:flex;gap:1rem;margin-bottom:1.25rem;flex-wrap:wrap;align-items:center;">
        <select class="filter-select" id="admin-filter" onchange="loadAdminBookings()">
          <option value="">Minden st√°tusz</option>
          <option value="pending">F√ºgg≈ëben</option>
          <option value="confirmed">Visszaigazolt</option>
          <option value="cancelled">T√∂r√∂lve</option>
        </select>
      </div>
      <div class="card">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Vend√©g</th><th>Szoba</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>Forr√°s</th><th>St√°tusz</th><th>√ñsszeg</th><th>M≈±veletek</th></tr></thead>
            <tbody id="admin-tbody"><tr><td colspan="9" style="text-align:center;padding:3rem;color:var(--text-muted);">Bet√∂lt√©s...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Admin booking form -->
    <div id="atab-admin-book" style="display:none;">
      <div class="admin-booking-banner" style="margin-bottom:2rem;">
        <span class="icon">üìû</span>
        <div>
          <div style="font-weight:500;color:var(--text);font-size:0.9rem;margin-bottom:0.2rem;">Foglal√°s r√∂gz√≠t√©se</div>
          <div>Telefonh√≠v√°s, email vagy szem√©lyes megjelen√©s alapj√°n r√∂gz√≠tse a foglal√°st a vend√©g nev√©ben.</div>
        </div>
      </div>
      <div class="card" style="padding:2rem;max-width:680px;">
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="form-row">
            <div class="form-group"><label>Szoba *</label><select id="ab-room" onchange="updateAdminSummary()"></select></div>
            <div class="form-group"><label>Foglal√°s forr√°sa</label>
              <select id="ab-source"><option value="phone">Telefonh√≠v√°s</option><option value="walkin">Szem√©lyes megjelen√©s</option><option value="email">Email</option><option value="other">Egy√©b</option></select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>√ârkez√©s *</label><input type="date" id="ab-checkin" onchange="updateAdminSummary()"></div>
            <div class="form-group"><label>T√°voz√°s *</label><input type="date" id="ab-checkout" onchange="updateAdminSummary()"></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Feln≈ëttek</label><select id="ab-adults"><option>1</option><option selected>2</option><option>3</option><option>4</option></select></div>
            <div class="form-group"><label>Gyerekek</label><select id="ab-children"><option selected>0</option><option>1</option><option>2</option><option>3</option></select></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Keresztn√©v *</label><input type="text" id="ab-fn" placeholder="P√©ter"></div>
            <div class="form-group"><label>Vezet√©kn√©v *</label><input type="text" id="ab-ln" placeholder="Nagy"></div>
          </div>
          <div class="form-group"><label>Email c√≠m *</label><input type="email" id="ab-email" placeholder="pelda@email.hu"></div>
          <div class="form-group"><label>Telefonsz√°m</label><input type="tel" id="ab-phone" placeholder="+36 30 123 4567"></div>
          <div class="form-group"><label>Megjegyz√©s</label><textarea id="ab-notes" placeholder="Megjegyz√©sek..."></textarea></div>
          <div id="ab-summary-box" style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;font-size:0.8rem;color:var(--text-dim);">V√°lasszon szob√°t √©s d√°tumot az √∂sszes√≠t≈ëh√∂z</div>
        </div>
        <br>
        <button class="btn btn-gold" onclick="submitAdminBooking()">‚úì Foglal√°s r√∂gz√≠t√©se</button>
      </div>
    </div>

    <!-- Rooms -->
    <div id="atab-rooms" style="display:none;">
      <div style="margin-bottom:1.5rem;"><button class="btn btn-outline btn-sm" onclick="openModal('modal-add-room')">+ √öj szoba</button></div>
      <div class="rooms-grid" id="admin-rooms-grid"></div>
    </div>

    <!-- Reviews admin -->
    <div id="atab-reviews-admin" style="display:none;">
      <div class="card">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Vend√©g</th><th>Szoba</th><th>√ârt√©kel√©s</th><th>V√©lem√©ny</th><th>D√°tum</th><th></th></tr></thead>
            <tbody id="admin-reviews-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toasts"></div>

<!-- ROOM DETAIL MODAL -->
<div class="modal-overlay" id="modal-room">
  <div class="modal" style="max-width:580px;">
    <button class="modal-close" onclick="closeModal('modal-room')">‚úï</button>
    <div id="modal-room-content"></div>
  </div>
</div>

<!-- ADD ROOM MODAL -->
<div class="modal-overlay" id="modal-add-room">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('modal-add-room')">‚úï</button>
    <div class="modal-title">√öj szoba</div>
    <div class="modal-sub">Szoba adatainak megad√°sa</div>
    <div style="display:flex;flex-direction:column;gap:1rem;">
      <div class="form-group"><label>Szoba neve *</label><input type="text" id="nr-name" placeholder="pl. Deluxe Suite"></div>
      <div class="form-group"><label>Le√≠r√°s</label><textarea id="nr-desc"></textarea></div>
      <div class="form-row">
        <div class="form-group"><label>√År / √©jszaka (Ft) *</label><input type="number" id="nr-price" placeholder="35000"></div>
        <div class="form-group"><label>Max. vend√©g</label><input type="number" id="nr-cap" value="2"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Emoji ikon</label><input type="text" id="nr-emoji" value="üõèÔ∏è"></div>
        <div class="form-group"><label>Szoba k√≥d</label><input type="text" id="nr-code" placeholder="101"></div>
      </div>
      <div class="form-group"><label>Kiemelt? (featured)</label><select id="nr-featured"><option value="0">Nem</option><option value="1">Igen</option></select></div>
      <div class="form-group"><label>Felszerelts√©g (vessz≈ëvel)</label><input type="text" id="nr-amenities" placeholder="WiFi, TV, Kl√≠ma"></div>
    </div>
    <br>
    <button class="btn btn-gold btn-block" onclick="saveRoom()">Szoba ment√©se</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EMAILJS_SERVICE  = 'marciibelhotels';
const EMAILJS_TEMPLATE = 'foglalas_budapest';
const EMAILJS_KEY      = 'AbatrWN5NbbsWfMsM';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentUser = null, isAdmin = false;
let rooms = [], allBookings = [];
let calYear = new Date().getFullYear(), calMonth = new Date().getMonth();
let currentWizardStep = 1;
let reviewRating = 0;
let bookingChart = null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('firebaseReady', async () => {
  emailjs.init(EMAILJS_KEY);
  const { auth, onAuthStateChanged } = window._fb;

  window.addEventListener('scroll', () => {
    document.getElementById('main-nav').classList.toggle('scrolled', window.scrollY > 30);
  });

  onAuthStateChanged(auth, async (user) => {
    currentUser = user;
    if (user) {
      const { db, doc, getDoc } = window._fb;
      const snap = await getDoc(doc(db, 'users', user.uid));
      isAdmin = snap.exists() && snap.data().role === 'admin';

      document.getElementById('nav-auth').style.display = 'none';
      document.getElementById('nav-user').style.display = 'flex';
      document.getElementById('nav-mybookings').style.display = '';
      document.getElementById('nav-avatar').textContent = user.email[0].toUpperCase();
      document.getElementById('nav-email').textContent = user.email;
      document.getElementById('nav-admin').style.display = isAdmin ? '' : 'none';
      document.getElementById('mob-mybookings').style.display = '';
      document.getElementById('mob-admin').style.display = isAdmin ? '' : 'none';
      document.getElementById('mob-auth').style.display = 'none';
      document.getElementById('mob-logout').style.display = '';
      const mui = document.getElementById('mob-user-info');
      if(mui){mui.style.display='block';mui.textContent=user.email;}

      if (document.getElementById('page-auth').classList.contains('active')) showPage('rooms');
    } else {
      isAdmin = false;
      document.getElementById('nav-auth').style.display = '';
      document.getElementById('nav-user').style.display = 'none';
      document.getElementById('nav-mybookings').style.display = 'none';
      document.getElementById('nav-admin').style.display = 'none';
      document.getElementById('mob-mybookings').style.display = 'none';
      document.getElementById('mob-admin').style.display = 'none';
      document.getElementById('mob-auth').style.display = '';
      document.getElementById('mob-logout').style.display = 'none';
      const mui = document.getElementById('mob-user-info');
      if(mui) mui.style.display='none';
    }
  });

  await fetchRooms();
  initStars();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV / DRAWER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDrawer() {
  const d = document.getElementById('mobile-drawer');
  const o = document.getElementById('drawer-overlay');
  const h = document.getElementById('hamburger');
  const open = d.classList.toggle('open');
  o.classList.toggle('open', open);
  h.classList.toggle('open', open);
}

function showPage(name) {
  document.querySelectorAll('.page, .page-hero').forEach(p => {
    p.classList.remove('active');
    p.style.display = 'none';
  });
  const pg = document.getElementById('page-' + name);
  if (!pg) return;
  const isFlex = pg.classList.contains('page-hero');
  pg.style.display = isFlex ? 'flex' : 'block';
  pg.classList.add('active');

  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

  if (name === 'rooms') { fetchRooms().then(renderRooms); }
  if (name === 'calendar') renderCalendar();
  if (name === 'mybookings') loadMyBookings();
  if (name === 'booking') initBookingForm();
  if (name === 'reviews') loadReviews();
  if (name === 'admin') { loadAdminBookings(); loadAdminRooms(); loadAdminReviews(); }
  window.scrollTo(0, 0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ROOMS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fetchRooms() {
  const { db, collection, getDocs } = window._fb;
  const snap = await getDocs(collection(db, 'rooms'));
  rooms = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  if (rooms.length === 0) { await seedRooms(); const s2 = await getDocs(collection(db,'rooms')); rooms = s2.docs.map(d=>({id:d.id,...d.data()})); }
}

async function seedRooms() {
  const { db, collection, addDoc } = window._fb;
  const d = [
    { name:'Standard Szoba', desc:'K√©nyelmes, modern standard szoba r√∂vid vagy hosszabb tart√≥zkod√°sra. K√∂zvetlen utcai kil√°t√°ssal.', price:18000, capacity:2, emoji:'üõèÔ∏è', code:'101', featured:false, amenities:['WiFi','TV','Kl√≠ma','F√ºrd≈ëszoba'] },
    { name:'Deluxe Szoba', desc:'T√°gas, pr√©mium szoba panor√°m√°s ablakkal, k√©nyelmes √≠r√≥asztallal √©s pr√©mium felszerelts√©ggel.', price:28000, capacity:2, emoji:'üåÖ', code:'201', featured:true, amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Safe'] },
    { name:'Junior Suite', desc:'K√ºl√∂n√°ll√≥ nappalival √©s h√°l√≥szob√°val rendelkez≈ë suite, jakuzzival √©s exkluz√≠v k√©nyelemmel.', price:45000, capacity:3, emoji:'üè°', code:'301', featured:true, amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Jakuzzi','Nappali','Safe'] },
    { name:'Penthouse Suite', desc:'Tet≈ëterasz szoba leny≈±g√∂z≈ë panor√°m√°val Budapest felett. Exkluz√≠v b√°r, jacuzzi √©s butler szolg√°lat.', price:75000, capacity:4, emoji:'‚ú®', code:'401', featured:true, amenities:['WiFi','4K TV','Kl√≠ma','Priv√°t b√°r','Jakuzzi','Butler','Terasz','Nappali'] },
  ];
  for (const r of d) await addDoc(collection(db, 'rooms'), r);
}

function renderRooms() {
  const q = (document.getElementById('room-search')?.value || '').toLowerCase();
  const sort = document.getElementById('room-sort')?.value || '';
  const capF = document.getElementById('room-cap-filter')?.value || '';

  let list = [...rooms].filter(r => {
    const matchQ = !q || r.name.toLowerCase().includes(q) || r.desc.toLowerCase().includes(q) || (r.amenities||[]).some(a=>a.toLowerCase().includes(q));
    const matchC = !capF || (capF==='1' ? (r.capacity||2)<=2 : (r.capacity||2)>=3);
    return matchQ && matchC;
  });

  if (sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
  else if (sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
  else if (sort === 'capacity') list.sort((a,b)=>b.capacity-a.capacity);

  const grid = document.getElementById('rooms-grid');
  if (!grid) return;
  if (list.length === 0) { grid.innerHTML='<div class="empty-state"><div class="icon">üîç</div><p>Nincs tal√°lat.</p></div>'; return; }

  grid.innerHTML = list.map(r => {
    const emojis = [r.emoji||'üõèÔ∏è', 'üõÅ', 'üåá', '‚òï'];
    const dots = emojis.map((_,i)=>`<div class="gallery-dot${i===0?' active':''}" onclick="event.stopPropagation();slideGallery('${r.id}',${i})"></div>`).join('');
    const slides = emojis.map((e,i)=>`<div class="room-gallery-slide${i===0?'':' hidden'}" id="slide-${r.id}-${i}">${e}</div>`).join('');
    return `
    <div class="room-card" onclick="openRoomDetail('${r.id}')">
      <div class="room-gallery">
        ${slides}
        <div class="room-badge-wrap">
          <span class="room-badge badge-available">El√©rhet≈ë</span>
          ${r.featured?'<span class="room-badge badge-featured">Kiemelt</span>':''}
        </div>
        <div class="gallery-dots">${dots}</div>
      </div>
      <div class="room-body">
        <div class="room-name">
          ${r.name}
          ${r.code?`<span class="room-code">#${r.code}</span>`:''}
        </div>
        <div class="room-desc">${r.desc}</div>
        <div class="room-amenities">${(r.amenities||[]).map(a=>`<span class="amenity-tag">${a}</span>`).join('')}</div>
        <div class="room-footer">
          <div>
            <div class="room-price">${(r.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div>
            <div class="room-capacity">üë• Max. ${r.capacity||2} f≈ë</div>
          </div>
          <button class="btn btn-outline btn-sm" onclick="event.stopPropagation();openRoomDetail('${r.id}')">R√©szletek</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function filterRooms() { renderRooms(); }

let galleryTimers = {};
function slideGallery(roomId, idx) {
  const emojis = 4;
  for (let i = 0; i < emojis; i++) {
    const el = document.getElementById(`slide-${roomId}-${i}`);
    const dot = document.querySelectorAll(`.room-card .gallery-dot`);
    if (el) el.classList.toggle('hidden', i !== idx);
  }
  // Update dots in that specific card
  const card = document.querySelector(`[onclick*="openRoomDetail('${roomId}')"]`);
  if (card) card.querySelectorAll('.gallery-dot').forEach((d,i)=>d.classList.toggle('active',i===idx));
}

function openRoomDetail(roomId) {
  const r = rooms.find(x => x.id === roomId);
  if (!r) return;
  const emojis = [r.emoji||'üõèÔ∏è','üõÅ','üåá','‚òï'];
  let slideIdx = 0;
  document.getElementById('modal-room-content').innerHTML = `
    <div style="font-size:4rem;text-align:center;margin-bottom:1rem;transition:all 0.3s;" id="modal-emoji">${emojis[0]}</div>
    <div style="display:flex;justify-content:center;gap:0.5rem;margin-bottom:1.25rem;">
      ${emojis.map((e,i)=>`<button onclick="document.getElementById('modal-emoji').textContent='${e}';document.querySelectorAll('#modal-room-content .gallery-dot').forEach((d,j)=>d.classList.toggle('active',j===${i}))" class="gallery-dot${i===0?' active':''}" style="width:8px;height:8px;"></button>`).join('')}
    </div>
    <div class="modal-title">${r.name}${r.code?` <span style="font-size:0.8rem;color:var(--text-muted);font-family:'Jost',sans-serif;font-weight:300;">#${r.code}</span>`:''}</div>
    <div class="modal-sub">${r.desc}</div>
    <div class="room-amenities" style="margin-bottom:1rem;">${(r.amenities||[]).map(a=>`<span class="amenity-tag">‚úì ${a}</span>`).join('')}</div>
    <p style="font-size:0.72rem;color:var(--text-muted);margin-bottom:1rem;letter-spacing:0.05em;">üë• Max. ${r.capacity||2} vend√©g</p>
    <div style="display:flex;align-items:center;justify-content:space-between;padding-top:1.25rem;border-top:1px solid var(--border);">
      <div style="font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:600;color:var(--gold);">${(r.price||0).toLocaleString('hu-HU')} Ft <small style="font-size:0.65rem;color:var(--text-muted);font-family:'Jost',sans-serif;font-weight:300;">/ √©jszaka</small></div>
      <button class="btn btn-gold" onclick="selectRoom('${r.id}')">Foglal√°s ‚Üí</button>
    </div>
  `;
  openModal('modal-room');
}

function selectRoom(id) {
  closeModal('modal-room');
  if (!currentUser) { toast('K√©rj√ºk, jelentkezzen be a foglal√°shoz!', 'info'); showPage('auth'); return; }
  showPage('booking');
  setTimeout(() => {
    document.getElementById('b-room').value = id;
    updateSummary();
  }, 50);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOKING WIZARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initBookingForm() {
  const sel = document.getElementById('b-room');
  if (!sel) return;
  sel.innerHTML = rooms.map(r => `<option value="${r.id}">${r.name} ‚Äì ${(r.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  if (currentUser) document.getElementById('b-email').value = currentUser.email;
  const today = new Date().toISOString().split('T')[0];
  const tom = new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('b-checkin'), co=document.getElementById('b-checkout');
  ci.min=today; co.min=tom;
  if(!ci.value)ci.value=today;
  if(!co.value)co.value=tom;
  document.getElementById('admin-for-field').style.display = isAdmin ? '' : 'none';
  setWizardStep(1);
  updateSummary();
}

function setWizardStep(n) {
  currentWizardStep = n;
  document.querySelectorAll('.wizard-step').forEach((s,i) => {
    const sn = i+1;
    s.classList.toggle('active', sn===n);
    s.classList.toggle('done', sn<n);
  });
  document.querySelectorAll('.wizard-panel').forEach((p,i) => {
    p.classList.toggle('active', i+1===n);
  });
  if (n===3) buildStep3Summary();
}

function wizardNext(step) {
  if (step===1) {
    const ci=document.getElementById('b-checkin').value;
    const co=document.getElementById('b-checkout').value;
    if (!ci||!co) { toast('K√©rj√ºk, adja meg a d√°tumokat!','error'); return; }
    if (new Date(ci)>=new Date(co)) { toast('A t√°voz√°s kor√°bbi az √©rkez√©sn√©l!','error'); return; }
  }
  if (step===2) {
    const fn=document.getElementById('b-firstname').value.trim();
    const ln=document.getElementById('b-lastname').value.trim();
    const em=document.getElementById('b-email').value.trim();
    if (!fn||!ln||!em) { toast('K√©rj√ºk, t√∂ltse ki a k√∂telez≈ë mez≈ëket!','error'); return; }
  }
  setWizardStep(step+1);
}
function wizardPrev(step) { setWizardStep(step-1); }

function buildStep3Summary() {
  const roomId=document.getElementById('b-room').value;
  const room=rooms.find(r=>r.id===roomId);
  const ci=document.getElementById('b-checkin').value;
  const co=document.getElementById('b-checkout').value;
  const fn=document.getElementById('b-firstname').value;
  const ln=document.getElementById('b-lastname').value;
  const em=document.getElementById('b-email').value;
  const ph=document.getElementById('b-phone').value;
  const adults=document.getElementById('b-adults').value;
  const children=document.getElementById('b-children').value;
  const notes=document.getElementById('b-notes').value;
  if (!room) return;
  const nights=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const total=nights*(room.price||0);
  document.getElementById('step3-summary').innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;font-size:0.82rem;">
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">Szoba</span><div style="margin-top:0.2rem;">${room.name}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">Vend√©g</span><div style="margin-top:0.2rem;">${fn} ${ln}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">√ârkez√©s</span><div style="margin-top:0.2rem;">${ci}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">T√°voz√°s</span><div style="margin-top:0.2rem;">${co}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">Email</span><div style="margin-top:0.2rem;">${em}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">Telefon</span><div style="margin-top:0.2rem;">${ph||'‚Äì'}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">Vend√©gek</span><div style="margin-top:0.2rem;">${adults} feln≈ëtt${+children>0?', '+children+' gyerek':''}</div></div>
      <div><span style="color:var(--text-muted);font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;">√âjszak√°k</span><div style="margin-top:0.2rem;">${nights} √©j</div></div>
    </div>
    ${notes?`<div style="margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid var(--border);font-size:0.78rem;color:var(--text-dim);">üí¨ ${notes}</div>`:''}
    <div style="margin-top:1rem;padding:1rem;background:var(--gold-glow);border:1px solid var(--gold-dim);border-radius:var(--radius);display:flex;justify-content:space-between;align-items:center;">
      <span style="font-size:0.72rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--text-dim);">V√©g√∂sszeg</span>
      <span style="font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--gold);">${total.toLocaleString('hu-HU')} Ft</span>
    </div>
  `;
}

function updateSummary() {
  const roomId = document.getElementById('b-room')?.value;
  const room = rooms.find(r => r.id === roomId);
  const ci = document.getElementById('b-checkin')?.value;
  const co = document.getElementById('b-checkout')?.value;
  const sc = document.getElementById('summary-content');
  if (!sc) return;
  if (!room || !ci || !co) { sc.innerHTML='<p style="color:var(--text-muted);font-size:0.8rem;font-style:italic;">V√°lasszon szob√°t √©s d√°tumot</p>'; return; }
  const nights = Math.max(1, Math.round((new Date(co)-new Date(ci))/86400000));
  const total = nights*(room.price||0);
  sc.innerHTML = `
    <div class="summary-row"><span>Szoba</span><span>${room.name}</span></div>
    <div class="summary-row"><span>√ârkez√©s</span><span>${ci}</span></div>
    <div class="summary-row"><span>T√°voz√°s</span><span>${co}</span></div>
    <div class="summary-row"><span>√âjszak√°k</span><span>${nights}</span></div>
    <div class="summary-row"><span>√År/√©j</span><span>${(room.price||0).toLocaleString('hu-HU')} Ft</span></div>
    <div class="summary-row total"><span>V√©g√∂sszeg</span><span>${total.toLocaleString('hu-HU')} Ft</span></div>
    <div class="summary-note">üí° Fizet√©s √©rkez√©skor, helysz√≠nen. Online el≈ëleg nem sz√ºks√©ges.</div>
  `;
}

async function submitBooking() {
  if (!currentUser) { toast('K√©rj√ºk, jelentkezzen be!','error'); return; }
  const roomId=document.getElementById('b-room').value;
  const room=rooms.find(r=>r.id===roomId);
  const ci=document.getElementById('b-checkin').value;
  const co=document.getElementById('b-checkout').value;
  const fn=document.getElementById('b-firstname').value.trim();
  const ln=document.getElementById('b-lastname').value.trim();
  const em=document.getElementById('b-email').value.trim();
  const ph=document.getElementById('b-phone').value.trim();
  const adults=document.getElementById('b-adults').value;
  const children=document.getElementById('b-children').value;
  const notes=document.getElementById('b-notes').value.trim();
  const source = isAdmin ? (document.getElementById('b-source')?.value||'admin') : 'online';
  const nights=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const total=nights*(room.price||0);
  const { db, collection, addDoc, serverTimestamp } = window._fb;
  try {
    const ref = await addDoc(collection(db,'bookings'), {
      userId:currentUser.uid, userEmail:currentUser.email,
      roomId, roomName:room.name, roomCode:room.code||'',
      checkin:ci, checkout:co, firstname:fn, lastname:ln,
      email:em, phone:ph, adults:+adults, children:+children,
      notes, nights, total, status:'pending', source,
      createdAt:serverTimestamp()
    });
    try {
      await emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, {
        to_name:`${fn} ${ln}`, to_email:em, room_name:room.name,
        checkin:ci, checkout:co, nights:nights.toString(),
        total:total.toLocaleString('hu-HU')+' Ft', booking_id:ref.id,
        adults:adults.toString(), children:children.toString(),
        phone:ph||'‚Äì', notes:notes||'‚Äì'
      });
    } catch(e){ console.warn('EmailJS:',e); }
    toast('Foglal√°s sikeresen elk√ºldve! Email √©rtes√≠t≈ët k√ºldt√ºnk.','success');
    showPage('mybookings');
  } catch(e){ toast('Hiba: '+e.message,'error'); }
}

// Admin booking
function initAdminBookingForm() {
  const sel=document.getElementById('ab-room');
  if(!sel) return;
  sel.innerHTML=rooms.map(r=>`<option value="${r.id}">${r.name} ‚Äì ${(r.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  const today=new Date().toISOString().split('T')[0];
  const tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('ab-checkin'), co=document.getElementById('ab-checkout');
  if(ci){ci.min=today;if(!ci.value)ci.value=today;}
  if(co){co.min=tom;if(!co.value)co.value=tom;}
  updateAdminSummary();
}

function updateAdminSummary() {
  const roomId=document.getElementById('ab-room')?.value;
  const room=rooms.find(r=>r.id===roomId);
  const ci=document.getElementById('ab-checkin')?.value;
  const co=document.getElementById('ab-checkout')?.value;
  const box=document.getElementById('ab-summary-box');
  if(!box||!room||!ci||!co) return;
  const nights=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const total=nights*(room.price||0);
  box.innerHTML=`<span style="color:var(--text-dim);">Szoba:</span> <strong>${room.name}</strong> &nbsp;|&nbsp; <span style="color:var(--text-dim);">${nights} √©j</span> &nbsp;|&nbsp; <span style="color:var(--gold);font-family:'Playfair Display',serif;font-size:1rem;">${total.toLocaleString('hu-HU')} Ft</span>`;
}

async function submitAdminBooking() {
  if(!isAdmin){toast('Nincs jogosults√°g!','error');return;}
  const roomId=document.getElementById('ab-room').value;
  const room=rooms.find(r=>r.id===roomId);
  const ci=document.getElementById('ab-checkin').value;
  const co=document.getElementById('ab-checkout').value;
  const fn=document.getElementById('ab-fn').value.trim();
  const ln=document.getElementById('ab-ln').value.trim();
  const em=document.getElementById('ab-email').value.trim();
  const ph=document.getElementById('ab-phone').value.trim();
  const adults=document.getElementById('ab-adults').value;
  const children=document.getElementById('ab-children').value;
  const notes=document.getElementById('ab-notes').value.trim();
  const source=document.getElementById('ab-source').value;
  if(!room||!ci||!co||!fn||!ln||!em){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','error');return;}
  if(new Date(ci)>=new Date(co)){toast('Hib√°s d√°tum!','error');return;}
  const nights=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const total=nights*(room.price||0);
  const {db,collection,addDoc,serverTimestamp}=window._fb;
  try {
    const ref=await addDoc(collection(db,'bookings'),{
      userId:currentUser.uid, userEmail:currentUser.email,
      roomId, roomName:room.name, roomCode:room.code||'',
      checkin:ci, checkout:co, firstname:fn, lastname:ln,
      email:em, phone:ph, adults:+adults, children:+children,
      notes, nights, total, status:'confirmed', source,
      adminBooking:true, createdAt:serverTimestamp()
    });
    try{
      await emailjs.send(EMAILJS_SERVICE,EMAILJS_TEMPLATE,{
        to_name:`${fn} ${ln}`,to_email:em,room_name:room.name,
        checkin:ci,checkout:co,nights:nights.toString(),
        total:total.toLocaleString('hu-HU')+' Ft',booking_id:ref.id,
        adults:adults.toString(),children:children.toString(),phone:ph||'‚Äì',notes:notes||'‚Äì'
      });
    }catch(e){console.warn(e);}
    toast('Admin foglal√°s r√∂gz√≠tve √©s visszaigazolva!','success');
    loadAdminBookings();
    switchAdminTab('bookings');
  }catch(e){toast('Hiba: '+e.message,'error');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MY BOOKINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadMyBookings() {
  if(!currentUser) return;
  const {db,collection,getDocs,query,where}=window._fb;
  const tbody=document.getElementById('my-tbody');
  try {
    const q=query(collection(db,'bookings'),where('userId','==',currentUser.uid));
    const snap=await getDocs(q);
    const items=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
    if(!items.length){tbody.innerHTML=`<tr><td colspan="7" style="text-align:center;padding:3rem;color:var(--text-muted);">M√©g nincs foglal√°sa.<br><br><button class="btn btn-outline btn-sm" onclick="showPage('rooms')">Szob√°k megtekint√©se</button></td></tr>`;return;}
    tbody.innerHTML=items.map(b=>`
      <tr>
        <td><strong>${b.roomName}</strong>${b.roomCode?` <span style="color:var(--text-muted);font-size:0.7rem;">#${b.roomCode}</span>`:''}</td>
        <td>${b.checkin}</td><td>${b.checkout}</td>
        <td>${b.adults} feln≈ëtt${(b.children||0)>0?', '+b.children+' gyerek':''}</td>
        <td><span class="badge badge-${b.status}">${statusLabel(b.status)}</span></td>
        <td style="color:var(--gold);font-family:'Playfair Display',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
        <td>${b.status==='pending'?`<button class="btn btn-ghost btn-sm" onclick="cancelBooking('${b.id}')">Lemond√°s</button>`:'‚Äì'}</td>
      </tr>`).join('');
  } catch(e){ tbody.innerHTML=`<tr><td colspan="7" style="color:var(--danger);padding:1rem;">Hiba: ${e.message}</td></tr>`; }
}
async function cancelBooking(id){
  if(!confirm('Biztosan lemondja a foglal√°st?'))return;
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'cancelled'});
  toast('Foglal√°s lemondva.','info');
  loadMyBookings();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAdminBookings() {
  if(!isAdmin)return;
  const {db,collection,getDocs,query,where}=window._fb;
  const tbody=document.getElementById('admin-tbody');
  if(!tbody)return;
  try {
    const filter=document.getElementById('admin-filter')?.value||'';
    const q=filter?query(collection(db,'bookings'),where('status','==',filter)):collection(db,'bookings');
    const snap=await getDocs(q);
    allBookings=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));

    const all=allBookings;
    document.getElementById('s-total').textContent=all.length;
    document.getElementById('s-pending').textContent=all.filter(b=>b.status==='pending').length;
    document.getElementById('s-confirmed').textContent=all.filter(b=>b.status==='confirmed').length;
    const rev=all.filter(b=>b.status==='confirmed').reduce((s,b)=>s+(b.total||0),0);
    document.getElementById('s-revenue').textContent=rev.toLocaleString('hu-HU')+' Ft';

    renderBookingChart(all);

    if(!all.length){tbody.innerHTML='<tr><td colspan="9" style="text-align:center;padding:3rem;color:var(--text-muted);">Nincs foglal√°s.</td></tr>';return;}
    tbody.innerHTML=all.map(b=>`
      <tr>
        <td><strong>${b.firstname||''} ${b.lastname||''}</strong><br><span style="color:var(--text-muted);font-size:0.72rem;">${b.userEmail}</span>${b.phone?`<br><span style="color:var(--text-muted);font-size:0.72rem;">${b.phone}</span>`:''}</td>
        <td>${b.roomName}${b.roomCode?` <span style="color:var(--text-muted);font-size:0.7rem;">#${b.roomCode}</span>`:''}</td>
        <td>${b.checkin}</td><td>${b.checkout}</td>
        <td>${b.adults||0} feln≈ëtt${(b.children||0)>0?', '+b.children+' gyerek':''}</td>
        <td><span style="font-size:0.7rem;color:var(--text-muted);">${sourceLabel(b.source)}</span></td>
        <td><span class="badge badge-${b.status}">${statusLabel(b.status)}</span></td>
        <td style="color:var(--gold);font-family:'Playfair Display',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
        <td style="display:flex;gap:0.4rem;flex-wrap:wrap;">
          ${b.status==='pending'?`<button class="btn btn-success btn-sm" onclick="confirmBooking('${b.id}')">‚úì</button>`:''}
          ${b.status!=='cancelled'?`<button class="btn btn-danger btn-sm" onclick="adminCancel('${b.id}')">‚úï</button>`:''}
        </td>
      </tr>`).join('');
  }catch(e){if(tbody)tbody.innerHTML=`<tr><td colspan="9" style="color:var(--danger);padding:1rem;">Hiba: ${e.message}</td></tr>`;}
}

function renderBookingChart(bookings) {
  const canvas=document.getElementById('bookings-chart');
  if(!canvas)return;
  const labels=[],data=[];
  for(let i=6;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    labels.push(d.toLocaleDateString('hu-HU',{month:'short',day:'numeric'}));
    data.push(bookings.filter(b=>b.createdAt?.seconds&&new Date(b.createdAt.seconds*1000).toISOString().split('T')[0]===ds).length);
  }
  if(bookingChart){bookingChart.destroy();}
  bookingChart=new Chart(canvas,{
    type:'bar',
    data:{
      labels,
      datasets:[{
        label:'Foglal√°sok',
        data,
        backgroundColor:'rgba(201,168,76,0.25)',
        borderColor:'rgba(201,168,76,0.8)',
        borderWidth:1.5,
        borderRadius:3,
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{
        x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#4a4540',font:{size:11,family:'Jost'}}},
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#4a4540',font:{size:11,family:'Jost'},stepSize:1},beginAtZero:true}
      }
    }
  });
}

async function confirmBooking(id){
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'confirmed'});
  toast('Foglal√°s visszaigazolva!','success');
  loadAdminBookings();
}
async function adminCancel(id){
  if(!confirm('T√∂rli a foglal√°st?'))return;
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'cancelled'});
  toast('Foglal√°s t√∂r√∂lve.','info');
  loadAdminBookings();
}

async function loadAdminRooms(){
  if(!isAdmin)return;
  const grid=document.getElementById('admin-rooms-grid');
  if(!grid)return;
  grid.innerHTML=rooms.map(r=>`
    <div class="room-card" style="cursor:default;">
      <div class="room-gallery"><div class="room-gallery-slide">${r.emoji||'üõèÔ∏è'}</div></div>
      <div class="room-body">
        <div class="room-name">${r.name}${r.code?` <span class="room-code">#${r.code}</span>`:''}</div>
        <div class="room-desc">${r.desc}</div>
        <div class="room-amenities">${(r.amenities||[]).map(a=>`<span class="amenity-tag">${a}</span>`).join('')}</div>
        <div class="room-footer">
          <div class="room-price">${(r.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div>
          <button class="btn btn-danger btn-sm" onclick="deleteRoom('${r.id}')">T√∂rl√©s</button>
        </div>
      </div>
    </div>`).join('');
}

async function saveRoom(){
  const name=document.getElementById('nr-name').value.trim();
  const price=+document.getElementById('nr-price').value;
  if(!name||!price){toast('N√©v √©s √°r k√∂telez≈ë!','error');return;}
  const{db,collection,addDoc}=window._fb;
  await addDoc(collection(db,'rooms'),{
    name, desc:document.getElementById('nr-desc').value.trim(),
    price, capacity:+document.getElementById('nr-cap').value||2,
    emoji:document.getElementById('nr-emoji').value.trim()||'üõèÔ∏è',
    code:document.getElementById('nr-code').value.trim(),
    featured:document.getElementById('nr-featured').value==='1',
    amenities:document.getElementById('nr-amenities').value.split(',').map(s=>s.trim()).filter(Boolean)
  });
  toast('Szoba hozz√°adva!','success');
  closeModal('modal-add-room');
  await fetchRooms();
  loadAdminRooms();
  renderRooms();
}
async function deleteRoom(id){
  if(!confirm('Biztosan t√∂rli?'))return;
  const{db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'rooms',id));
  rooms=rooms.filter(r=>r.id!==id);
  toast('Szoba t√∂r√∂lve.','info');
  loadAdminRooms();renderRooms();
}

function switchAdminTab(tab){
  ['bookings','admin-book','rooms','reviews-admin'].forEach(t=>{
    const el=document.getElementById('atab-'+t);
    if(el)el.style.display=t===tab?'':'none';
  });
  document.querySelectorAll('#page-admin .tab-btn').forEach((b,i)=>{
    const tabs=['bookings','admin-book','rooms','reviews-admin'];
    b.classList.toggle('active',tabs[i]===tab);
  });
  if(tab==='admin-book') initAdminBookingForm();
  if(tab==='reviews-admin') loadAdminReviews();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initStars(){
  const starsEl=document.getElementById('rv-stars');
  if(!starsEl)return;
  starsEl.querySelectorAll('.star').forEach(s=>{
    s.addEventListener('click',()=>{
      reviewRating=+s.dataset.v;
      starsEl.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('filled',i<reviewRating));
    });
    s.addEventListener('mouseover',()=>starsEl.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('hover',i<=+s.dataset.v-1)));
    s.addEventListener('mouseout',()=>starsEl.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('hover',false)));
  });
}

async function loadReviews(){
  const{db,collection,getDocs}=window._fb;
  const rvSel=document.getElementById('rv-room');
  if(rvSel)rvSel.innerHTML=rooms.map(r=>`<option value="${r.id}">${r.name}</option>`).join('');
  if(!currentUser&&document.getElementById('review-form-wrap'))
    document.getElementById('review-form-wrap').innerHTML='<p style="color:var(--text-muted);font-size:0.82rem;font-style:italic;">V√©lem√©ny √≠r√°s√°hoz k√©rj√ºk, <button class="btn btn-outline btn-sm" onclick="showPage(\'auth\')">jelentkezzen be</button></p>';

  const snap=await getDocs(collection(db,'reviews'));
  const reviews=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));

  const grid=document.getElementById('reviews-grid');
  const avgEl=document.getElementById('avg-rating');
  const cntEl=document.getElementById('review-count');
  const avgStars=document.getElementById('avg-stars');

  if(avgEl&&reviews.length){
    const avg=(reviews.reduce((s,r)=>s+(r.rating||0),0)/reviews.length).toFixed(1);
    avgEl.textContent=avg;
    if(cntEl)cntEl.textContent=`${reviews.length} v√©lem√©ny`;
    if(avgStars)avgStars.innerHTML=Array(5).fill(0).map((_,i)=>`<span class="star${i<Math.round(avg)?' filled':''}">‚òÖ</span>`).join('');
  }

  if(!grid)return;
  if(!reviews.length){grid.innerHTML='<div class="empty-state"><div class="icon">üí¨</div><p>M√©g nincs v√©lem√©ny.</p></div>';return;}
  grid.innerHTML=reviews.map(r=>`
    <div class="review-card">
      <div class="review-header">
        <div class="review-avatar">${(r.name||'?')[0].toUpperCase()}</div>
        <div>
          <div class="review-name">${r.name||'N√©vtelen vend√©g'}</div>
          <div class="review-date">${r.roomName||''} ¬∑ ${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</div>
        </div>
        <div class="stars" style="margin-left:auto;">${Array(5).fill(0).map((_,i)=>`<span class="star${i<(r.rating||0)?' filled':''}">‚òÖ</span>`).join('')}</div>
      </div>
      <div class="review-text">${r.text}</div>
    </div>`).join('');
}

async function submitReview(){
  if(!currentUser){toast('Bejelentkez√©s sz√ºks√©ges!','info');return;}
  const roomId=document.getElementById('rv-room')?.value;
  const room=rooms.find(r=>r.id===roomId);
  const text=document.getElementById('rv-text')?.value.trim();
  if(!text){toast('K√©rj√ºk, √≠rja meg v√©lem√©ny√©t!','error');return;}
  if(!reviewRating){toast('K√©rj√ºk, adjon √©rt√©kel√©st!','error');return;}
  const{db,collection,addDoc,serverTimestamp}=window._fb;
  await addDoc(collection(db,'reviews'),{
    userId:currentUser.uid, name:currentUser.email.split('@')[0],
    userEmail:currentUser.email, roomId:roomId||'', roomName:room?.name||'',
    rating:reviewRating, text, createdAt:serverTimestamp()
  });
  toast('K√∂sz√∂nj√ºk v√©lem√©ny√©t!','success');
  if(document.getElementById('rv-text'))document.getElementById('rv-text').value='';
  reviewRating=0;
  document.querySelectorAll('#rv-stars .star').forEach(s=>s.classList.remove('filled'));
  loadReviews();
}

async function loadAdminReviews(){
  if(!isAdmin)return;
  const{db,collection,getDocs,doc,deleteDoc}=window._fb;
  const tbody=document.getElementById('admin-reviews-tbody');
  if(!tbody)return;
  const snap=await getDocs(collection(db,'reviews'));
  const reviews=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  if(!reviews.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--text-muted);">M√©g nincs v√©lem√©ny.</td></tr>';return;}
  tbody.innerHTML=reviews.map(r=>`
    <tr>
      <td>${r.name||'‚Äì'}<br><span style="font-size:0.72rem;color:var(--text-muted);">${r.userEmail}</span></td>
      <td>${r.roomName||'‚Äì'}</td>
      <td><span style="color:var(--gold);">${'‚òÖ'.repeat(r.rating||0)}</span> ${r.rating}/5</td>
      <td style="max-width:200px;font-style:italic;font-size:0.78rem;color:var(--text-dim);">${r.text}</td>
      <td style="font-size:0.75rem;color:var(--text-muted);">${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteReview('${r.id}')">T√∂rl√©s</button></td>
    </tr>`).join('');
}
async function deleteReview(id){
  if(!confirm('T√∂rli a v√©lem√©nyt?'))return;
  const{db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'reviews',id));
  toast('V√©lem√©ny t√∂r√∂lve.','info');
  loadAdminReviews();loadReviews();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALENDAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function renderCalendar(){
  const{db,collection,getDocs}=window._fb;
  const snap=await getDocs(collection(db,'bookings'));
  const allB=snap.docs.map(d=>d.data()).filter(b=>b.status!=='cancelled');
  const months=['Janu√°r','Febru√°r','M√°rcius','√Åprilis','M√°jus','J√∫nius','J√∫lius','Augusztus','Szeptember','Okt√≥ber','November','December'];
  document.getElementById('cal-label').textContent=`${months[calMonth]} ${calYear}`;
  const grid=document.getElementById('cal-grid');
  grid.innerHTML=['H','K','Sze','Cs','P','Szo','V'].map(d=>`<div class="cal-dn">${d}</div>`).join('');
  const offset=(new Date(calYear,calMonth,1).getDay()+6)%7;
  const total=new Date(calYear,calMonth+1,0).getDate();
  const todayD=new Date();
  for(let i=0;i<offset;i++)grid.innerHTML+=`<div class="cal-d empty"></div>`;
  for(let d=1;d<=total;d++){
    const ds=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isPast=new Date(ds)<new Date(todayD.toDateString());
    const isToday=d===todayD.getDate()&&calMonth===todayD.getMonth()&&calYear===todayD.getFullYear();
    const dayB=allB.filter(b=>b.checkin<=ds&&b.checkout>ds);
    const cls=['cal-d',isPast?'past':'',isToday?'today':'',dayB.length>=rooms.length&&rooms.length>0?'fully-booked':dayB.length>0?'has-booking':''].filter(Boolean).join(' ');
    grid.innerHTML+=`<div class="${cls}" onclick="showCalDay('${ds}',${JSON.stringify(dayB).replace(/"/g,'&quot;')})">${d}</div>`;
  }
  document.getElementById('cal-prev').onclick=()=>{calMonth--;if(calMonth<0){calMonth=11;calYear--;}renderCalendar();};
  document.getElementById('cal-next').onclick=()=>{calMonth++;if(calMonth>11){calMonth=0;calYear++;}renderCalendar();};
}

function showCalDay(ds,dayB){
  const el=document.getElementById('cal-detail');
  if(!dayB.length){el.innerHTML=`<div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:0.5rem;">üìÖ ${ds}</div><p style="color:var(--text-muted);font-size:0.82rem;font-style:italic;">Ezen a napon nincs foglal√°s.</p>`;return;}
  el.innerHTML=`<div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.25rem;">üìÖ ${ds} ‚Äì ${dayB.length} foglal√°s</div>`+
    dayB.map(b=>`<div style="border:1px solid var(--border-light);border-radius:var(--radius);padding:1rem;margin-bottom:0.6rem;">
      <div style="font-weight:500;font-size:0.85rem;margin-bottom:0.3rem;">${b.roomName}</div>
      <div style="font-size:0.75rem;color:var(--text-muted);">${b.firstname||''} ${b.lastname||''}</div>
      <div style="font-size:0.75rem;color:var(--text-muted);">${b.checkin} ‚Üí ${b.checkout}</div>
      <div style="margin-top:0.4rem;"><span class="badge badge-${b.status}">${statusLabel(b.status)}</span></div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchAuthTab(tab){
  document.getElementById('auth-login').style.display=tab==='login'?'':'none';
  document.getElementById('auth-register').style.display=tab==='register'?'':'none';
  document.querySelectorAll('#page-auth .tab-btn').forEach((b,i)=>b.classList.toggle('active',(i===0&&tab==='login')||(i===1&&tab==='register')));
}
async function doLogin(){
  const{auth,signInWithEmailAndPassword}=window._fb;
  try{await signInWithEmailAndPassword(auth,document.getElementById('l-email').value,document.getElementById('l-pass').value);toast('Sikeres bejelentkez√©s!','success');}
  catch(e){toast('Hib√°s email vagy jelsz√≥.','error');}
}
async function doRegister(){
  const{auth,db,createUserWithEmailAndPassword,doc,setDoc}=window._fb;
  const email=document.getElementById('r-email').value;
  const pass=document.getElementById('r-pass').value;
  try{
    const cred=await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,'users',cred.user.uid),{email,role:'user',firstname:document.getElementById('r-fn').value,lastname:document.getElementById('r-ln').value,createdAt:new Date().toISOString()});
    toast('Sikeres regisztr√°ci√≥!','success');
  }catch(e){toast('Hiba: '+e.message,'error');}
}
async function logout(){
  const{auth,signOut}=window._fb;
  await signOut(auth);
  toast('Kijelentkezett.','info');
  showPage('home');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function statusLabel(s){return{pending:'F√ºgg≈ëben',confirmed:'Visszaigazolt',cancelled:'Lemondva'}[s]||s;}
function sourceLabel(s){return{online:'Online',phone:'Telefon',walkin:'Szem√©lyes',email:'Email',admin:'Admin',other:'Egy√©b'}[s]||s||'Online';}
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
window.addEventListener('click',e=>{if(e.target.classList.contains('modal-overlay'))document.querySelectorAll('.modal-overlay.open').forEach(m=>m.classList.remove('open'));});
function toast(msg,type='info'){
  const icons={success:'‚úì',error:'‚úï',info:'‚Ñπ'};
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span style="font-size:0.9rem;flex-shrink:0;">${icons[type]||'‚Ñπ'}</span><span>${msg}</span>`;
  document.getElementById('toasts').appendChild(el);
  setTimeout(()=>el.remove(),4500);
}

showPage('home');
</script>
</body>
</html>
