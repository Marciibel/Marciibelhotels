<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marciibel Hotels Budapest</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updatePassword, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, getDoc, setDoc, query, where, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDKTjKz5rZ0CAp6Senl95yIMetbdf_UJJ0",
    authDomain: "marciibel-hotels.firebaseapp.com",
    projectId: "marciibel-hotels",
    storageBucket: "marciibel-hotels.firebasestorage.app",
    messagingSenderId: "74569747642",
    appId: "1:74569747642:web:587b5cf2443509b8460683"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  window._fb = { auth, db, collection, addDoc, getDocs, getDoc, setDoc, query, where, doc, updateDoc, deleteDoc, serverTimestamp, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updatePassword, EmailAuthProvider, reauthenticateWithCredential };
  window.dispatchEvent(new Event('firebaseReady'));
</script>

<style>
:root{
  --bg:#080808;--surface:#111;--surface2:#1a1a1a;--surface3:#222;
  --border:#2a2a2a;--bl:#333;
  --gold:#c9a84c;--gold2:#e8c97a;
  --gd:rgba(201,168,76,0.15);--gg:rgba(201,168,76,0.08);
  --text:#f0ece4;--td:#8a8078;--tm:#4a4540;
  --danger:#c0392b;--success:#27ae60;--warn:#e67e22;
  --r:3px;--nh:68px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'Jost',sans-serif;font-weight:300;min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--bl);border-radius:2px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;height:var(--nh);display:flex;align-items:center;justify-content:space-between;padding:0 2.5rem;background:rgba(8,8,8,0.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);transition:border-color 0.3s;}
nav.scrolled{border-bottom-color:var(--gd);}
.nav-logo{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:600;color:var(--gold);display:flex;align-items:center;gap:0.6rem;cursor:pointer;letter-spacing:0.04em;}
.nav-logo-sub{font-family:'Jost',sans-serif;font-size:0.62rem;font-weight:400;color:var(--td);letter-spacing:0.25em;text-transform:uppercase;line-height:1;}
.nav-desktop{display:flex;align-items:center;gap:0.2rem;}
.nl{padding:0.45rem 0.9rem;font-size:0.7rem;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;color:var(--td);cursor:pointer;background:none;border:none;font-family:'Jost',sans-serif;transition:all 0.2s;border-radius:2px;}
.nl:hover{color:var(--gold);}
.nl.active{color:var(--gold);background:var(--gg);}
.nl.gold-btn{color:var(--gold);border:1px solid var(--gd);}
.nav-pill{display:flex;align-items:center;gap:0.55rem;background:var(--surface2);border:1px solid var(--bl);border-radius:999px;padding:0.28rem 0.8rem 0.28rem 0.35rem;font-size:0.72rem;color:var(--td);}
.nav-av{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#111;font-size:0.68rem;font-weight:700;display:flex;align-items:center;justify-content:center;}

/* HAMBURGER */
.hbg{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:6px;background:none;border:none;}
.hbg span{display:block;width:22px;height:1.5px;background:var(--td);transition:all 0.3s;}
.hbg.open span:nth-child(1){transform:translateY(6.5px) rotate(45deg);background:var(--gold);}
.hbg.open span:nth-child(2){opacity:0;}
.hbg.open span:nth-child(3){transform:translateY(-6.5px) rotate(-45deg);background:var(--gold);}

/* DRAWER */
.drawer{display:none;position:fixed;top:var(--nh);right:0;bottom:0;width:280px;z-index:190;background:var(--surface);border-left:1px solid var(--border);padding:1.5rem;flex-direction:column;gap:0.3rem;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);}
.drawer.open{transform:translateX(0);}
.dov{display:none;position:fixed;inset:0;z-index:180;background:rgba(0,0,0,0.65);backdrop-filter:blur(2px);}
.dov.open{display:block;}
.dl{padding:0.8rem 1rem;font-size:0.78rem;font-weight:500;letter-spacing:0.1em;text-transform:uppercase;color:var(--td);cursor:pointer;background:none;border:none;border-bottom:1px solid var(--border);text-align:left;transition:color 0.2s;width:100%;font-family:'Jost',sans-serif;}
.dl:hover,.dl.active{color:var(--gold);}

/* PAGES */
.page{display:none;min-height:100vh;padding-top:var(--nh);}
.page.active{display:block;}
.pflex{display:none;min-height:100vh;padding-top:var(--nh);}
.pflex.active{display:flex;flex-direction:column;}

.con{max-width:1160px;margin:0 auto;padding:2.5rem 2rem;}

/* PAGE HEADER */
.ph{padding:3rem 2rem 2rem;max-width:1160px;margin:0 auto;border-bottom:1px solid var(--border);margin-bottom:2.5rem;}
.pe{font-size:0.62rem;letter-spacing:0.4em;text-transform:uppercase;color:var(--gold);margin-bottom:0.5rem;}
.pt{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,4vw,2.6rem);font-weight:600;line-height:1.1;}
.pt em{font-style:italic;color:var(--gold);}
.ps{color:var(--td);font-size:0.8rem;margin-top:0.35rem;}

/* HERO */
.hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 50% 30%,rgba(201,168,76,0.07) 0%,transparent 70%),radial-gradient(ellipse 40% 40% at 20% 80%,rgba(201,168,76,0.04) 0%,transparent 60%);}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(201,168,76,0.032) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,0.032) 1px,transparent 1px);background-size:80px 80px;}
@keyframes fu{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:0.4rem;padding:0.68rem 1.75rem;font-family:'Jost',sans-serif;font-size:0.7rem;font-weight:500;letter-spacing:0.17em;text-transform:uppercase;cursor:pointer;border:none;transition:all 0.22s;border-radius:var(--r);}
.bg{background:var(--gold);color:#080808;font-weight:600;}
.bg:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 8px 24px rgba(201,168,76,0.25);}
.bo{background:transparent;color:var(--gold);border:1px solid var(--gd);}
.bo:hover{background:var(--gg);border-color:var(--gold);}
.bgh{background:transparent;color:var(--td);border:1px solid var(--bl);}
.bgh:hover{border-color:var(--td);color:var(--text);}
.bd{background:var(--danger);color:#fff;}
.bd:hover{background:#e74c3c;}
.bs{background:var(--success);color:#fff;}
.bs:hover{background:#2ecc71;}
.bw{background:var(--warn);color:#fff;}
.bw:hover{background:#f39c12;}
.bsm{padding:0.4rem 0.9rem;font-size:0.66rem;}
.blk{width:100%;justify-content:center;}
.blg{padding:0.85rem 2.4rem;font-size:0.76rem;}

/* CARD */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);}

/* ROOMS */
.rooms-toolbar{display:flex;gap:0.85rem;align-items:center;flex-wrap:wrap;margin-bottom:2rem;}
.sb{position:relative;flex:1;min-width:180px;}
.sb input{background:var(--surface);border:1px solid var(--bl);color:var(--text);padding:0.65rem 1rem 0.65rem 2.4rem;font-family:'Jost',sans-serif;font-size:0.82rem;border-radius:var(--r);width:100%;outline:none;transition:border-color 0.2s;}
.sb input:focus{border-color:var(--gold);}
.sb::before{content:'‚åï';position:absolute;left:0.8rem;top:50%;transform:translateY(-50%);color:var(--tm);font-size:1.1rem;}
.fsel{background:var(--surface);border:1px solid var(--bl);color:var(--td);padding:0.65rem 1rem;font-family:'Jost',sans-serif;font-size:0.77rem;border-radius:var(--r);outline:none;cursor:pointer;transition:border-color 0.2s;}
.fsel:focus{border-color:var(--gold);}
.fsel option{background:var(--surface2);}
.rg{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:1.4rem;}
.rc{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;transition:transform 0.28s,border-color 0.28s,box-shadow 0.28s;}
.rc:hover{transform:translateY(-4px);border-color:var(--gd);box-shadow:0 16px 40px rgba(0,0,0,0.5);}
.rg-wrap{position:relative;height:210px;overflow:hidden;background:var(--surface2);}
.rg-slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:5rem;background:linear-gradient(135deg,var(--surface2) 0%,#1e1a10 100%);transition:opacity 0.45s,transform 0.45s;}
.rg-slide.hidden{opacity:0;transform:scale(1.05);}
.gdots{position:absolute;bottom:0.7rem;left:50%;transform:translateX(-50%);display:flex;gap:0.32rem;}
.gdot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,0.28);transition:all 0.2s;cursor:pointer;}
.gdot.active{background:var(--gold);transform:scale(1.35);}
.rbw{position:absolute;top:0.7rem;left:0.7rem;display:flex;gap:0.35rem;}
.rb{padding:0.18rem 0.55rem;font-size:0.58rem;letter-spacing:0.13em;text-transform:uppercase;border-radius:2px;font-weight:600;}
.rba{background:rgba(39,174,96,0.18);color:#2ecc71;border:1px solid rgba(39,174,96,0.3);}
.rbf{background:rgba(201,168,76,0.18);color:var(--gold);border:1px solid var(--gd);}
.rb-body{padding:1.4rem;}
.rn{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:600;display:flex;align-items:baseline;gap:0.5rem;margin-bottom:0.3rem;}
.rc-code{font-family:'Jost',sans-serif;font-size:0.62rem;color:var(--tm);font-weight:400;letter-spacing:0.08em;}
.rd{color:var(--td);font-size:0.78rem;line-height:1.6;margin-bottom:0.9rem;}
.ams{display:flex;flex-wrap:wrap;gap:0.35rem;margin-bottom:1.1rem;}
.am{background:var(--surface2);border:1px solid var(--bl);color:var(--td);padding:0.18rem 0.5rem;font-size:0.63rem;letter-spacing:0.04em;border-radius:2px;}
.rf{display:flex;align-items:center;justify-content:space-between;padding-top:0.9rem;border-top:1px solid var(--border);}
.rp{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:600;color:var(--gold);}
.rp small{font-family:'Jost',sans-serif;font-size:0.62rem;color:var(--tm);font-weight:300;}

/* STARS */
.stars{display:flex;gap:2px;}
.star{color:var(--tm);font-size:0.9rem;cursor:pointer;transition:color 0.15s;user-select:none;}
.star.on,.star.hov{color:var(--gold);}

/* REVIEWS */
.rvg{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:1.2rem;}
.rvc{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:1.4rem;transition:border-color 0.2s;}
.rvc:hover{border-color:var(--gd);}
.rvh{display:flex;align-items:center;gap:0.7rem;margin-bottom:0.7rem;}
.rvav{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--surface2),var(--surface3));border:1px solid var(--bl);display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:0.85rem;color:var(--gold);}
.rvtxt{font-size:0.78rem;color:var(--td);line-height:1.65;font-style:italic;}

/* WIZARD */
.wsteps{display:flex;align-items:center;margin-bottom:2.5rem;}
.ws{display:flex;align-items:center;gap:0.7rem;flex:1;position:relative;}
.ws:not(:last-child)::after{content:'';flex:1;height:1px;background:var(--border);margin:0 0.75rem;transition:background 0.4s;}
.ws.done:not(:last-child)::after{background:var(--gd);}
.wsn{width:32px;height:32px;border-radius:50%;border:1.5px solid var(--bl);display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:600;color:var(--tm);transition:all 0.3s;flex-shrink:0;}
.ws.active .wsn{border-color:var(--gold);color:var(--gold);background:var(--gg);}
.ws.done .wsn{border-color:var(--gold);background:var(--gold);color:#080808;}
.wsl{font-size:0.68rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--tm);transition:color 0.3s;white-space:nowrap;}
.ws.active .wsl{color:var(--gold);}
.ws.done .wsl{color:var(--td);}
.wp{display:none;animation:fu 0.28s ease;}
.wp.active{display:block;}

/* FORMS */
.fr{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;}
@media(max-width:600px){.fr,.fr3{grid-template-columns:1fr;}}
.fg{display:flex;flex-direction:column;gap:0.38rem;}
label{font-size:0.67rem;letter-spacing:0.17em;text-transform:uppercase;color:var(--td);font-weight:500;}
input,select,textarea{background:var(--surface2);border:1px solid var(--bl);color:var(--text);padding:0.72rem 1rem;font-family:'Jost',sans-serif;font-size:0.84rem;border-radius:var(--r);width:100%;outline:none;transition:border-color 0.2s,box-shadow 0.2s;}
input:focus,select:focus,textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,0.08);}
input::placeholder{color:var(--tm);}
textarea{resize:vertical;min-height:85px;}
select option{background:var(--surface2);}

/* SUMMARY */
.sumbox{background:var(--surface2);border:1px solid var(--bl);border-radius:var(--r);padding:1.5rem;position:sticky;top:calc(var(--nh) + 1rem);}
.sum-title{font-family:'Playfair Display',serif;font-size:0.95rem;border-bottom:1px solid var(--border);padding-bottom:0.7rem;margin-bottom:0.9rem;}
.sr{display:flex;justify-content:space-between;font-size:0.78rem;padding:0.32rem 0;color:var(--td);}
.sr.tot{border-top:1px solid var(--border);margin-top:0.4rem;padding-top:0.8rem;font-size:0.95rem;color:var(--text);}
.sr.tot span:last-child{color:var(--gold);font-family:'Playfair Display',serif;font-size:1.05rem;}
.sum-note{font-size:0.68rem;color:var(--tm);margin-top:0.7rem;padding-top:0.7rem;border-top:1px solid var(--border);line-height:1.65;}

/* CALENDAR */
.calw{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:1.6rem;}
.calh{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.4rem;}
.cal-ml{font-family:'Playfair Display',serif;font-size:1.05rem;}
.calbtn{width:32px;height:32px;border:1px solid var(--bl);background:transparent;color:var(--td);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;border-radius:var(--r);transition:all 0.2s;}
.calbtn:hover{border-color:var(--gold);color:var(--gold);}
.calg{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cdn{text-align:center;font-size:0.58rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--tm);padding:0.38rem 0;}
.cd{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:0.76rem;border-radius:var(--r);cursor:pointer;transition:all 0.15s;}
.cd:hover:not(.empty):not(.past){background:var(--gg);color:var(--gold);}
.cd.empty,.cd.past{cursor:default;color:var(--tm);opacity:0.4;}
.cd.today{background:var(--gg);color:var(--gold);font-weight:600;}
.cd.has-b{background:rgba(201,168,76,0.12);color:var(--gold);}
.cd.full-b{background:rgba(192,57,43,0.15);color:#e74c3c;}
.cal-leg{display:flex;gap:1.2rem;margin-top:1.2rem;flex-wrap:wrap;}
.li{display:flex;align-items:center;gap:0.38rem;font-size:0.66rem;color:var(--tm);}
.ld{width:8px;height:8px;border-radius:2px;}

/* TABLE */
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th{background:var(--surface2);padding:0.72rem 1rem;text-align:left;font-size:0.6rem;font-weight:600;letter-spacing:0.17em;text-transform:uppercase;color:var(--tm);border-bottom:1px solid var(--border);white-space:nowrap;}
td{padding:0.9rem 1rem;border-bottom:1px solid var(--border);font-size:0.8rem;vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,0.013);}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:0.2rem 0.6rem;border-radius:2px;font-size:0.63rem;font-weight:600;letter-spacing:0.07em;}
.bp{background:rgba(230,126,34,0.12);color:var(--warn);border:1px solid rgba(230,126,34,0.25);}
.bc{background:rgba(39,174,96,0.1);color:var(--success);border:1px solid rgba(39,174,96,0.22);}
.bx{background:rgba(192,57,43,0.1);color:var(--danger);border:1px solid rgba(192,57,43,0.22);}
.bi{background:rgba(52,152,219,0.1);color:#3498db;border:1px solid rgba(52,152,219,0.22);}
.bco{background:rgba(39,174,96,0.18);color:#27ae60;border:1px solid rgba(39,174,96,0.3);}

/* STATS */
.sg{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem;margin-bottom:2rem;}
.sc{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:1.4rem;transition:border-color 0.2s;}
.sc:hover{border-color:var(--gd);}
.sl{font-size:0.6rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--tm);margin-bottom:0.45rem;}
.sv{font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:700;color:var(--gold);}
.ss{font-size:0.68rem;color:var(--tm);margin-top:0.2rem;}

/* CHART */
.chw{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:1.6rem;margin-bottom:2rem;}
.cht{font-size:0.7rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--tm);margin-bottom:1.2rem;}

/* MODAL */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);backdrop-filter:blur(6px);z-index:300;align-items:center;justify-content:center;padding:1rem;}
.mo.open{display:flex;}
.mod{background:var(--surface);border:1px solid var(--bl);border-radius:var(--r);padding:2.4rem;width:100%;max-width:520px;position:relative;animation:modalIn 0.22s ease;max-height:90vh;overflow-y:auto;}
@keyframes modalIn{from{transform:translateY(10px) scale(0.97);opacity:0;}to{transform:translateY(0) scale(1);opacity:1;}}
.mc{position:absolute;top:1.2rem;right:1.2rem;background:var(--surface2);border:1px solid var(--bl);color:var(--td);width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:0.78rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.mc:hover{border-color:var(--gold);color:var(--gold);}
.mt{font-family:'Playfair Display',serif;font-size:1.35rem;margin-bottom:0.25rem;}
.msub{font-size:0.76rem;color:var(--td);margin-bottom:1.6rem;}

/* TABS */
.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:1.6rem;overflow-x:auto;}
.tb{padding:0.62rem 1.3rem;font-size:0.68rem;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;cursor:pointer;background:none;border:none;color:var(--tm);border-bottom:2px solid transparent;margin-bottom:-1px;font-family:'Jost',sans-serif;transition:all 0.2s;white-space:nowrap;}
.tb.active{color:var(--gold);border-bottom-color:var(--gold);}
.tb:hover:not(.active){color:var(--td);}

/* AUTH */
.authw{min-height:calc(100vh - var(--nh));display:flex;align-items:center;justify-content:center;padding:3rem 1rem;background:radial-gradient(ellipse 60% 60% at 50% 50%,rgba(201,168,76,0.04) 0%,transparent 70%);}
.authc{background:var(--surface);border:1px solid var(--bl);border-radius:var(--r);padding:2.8rem;width:100%;max-width:430px;}
.auth-logo{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:600;color:var(--gold);text-align:center;margin-bottom:1.8rem;letter-spacing:0.05em;}

/* TOAST */
#toasts{position:fixed;bottom:1.8rem;right:1.8rem;z-index:400;display:flex;flex-direction:column;gap:0.45rem;}
.toast{display:flex;align-items:center;gap:0.7rem;padding:0.85rem 1.2rem;border-radius:var(--r);font-size:0.78rem;background:var(--surface);border:1px solid var(--bl);box-shadow:0 8px 24px rgba(0,0,0,0.6);animation:fu 0.28s ease;max-width:320px;}
.toast.ok{border-left:3px solid var(--success);}
.toast.err{border-left:3px solid var(--danger);}
.toast.inf{border-left:3px solid var(--gold);}

/* INFOBOX */
.ib{background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);padding:0.85rem 1.1rem;font-size:0.76rem;color:var(--td);margin-bottom:1.6rem;line-height:1.6;}

/* PROFILE */
.profile-grid{display:grid;grid-template-columns:260px 1fr;gap:1.5rem;align-items:start;}
@media(max-width:800px){.profile-grid{grid-template-columns:1fr;}}
.profile-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:2rem;text-align:center;}
.profile-av{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#111;font-size:1.8rem;font-weight:700;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;font-family:'Playfair Display',serif;}
.profile-name{font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:0.25rem;}
.profile-email{font-size:0.75rem;color:var(--td);}
.profile-stats{display:flex;gap:1rem;justify-content:center;margin-top:1.25rem;padding-top:1.25rem;border-top:1px solid var(--border);}
.pstat{text-align:center;}
.pstat-val{font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--gold);}
.pstat-lbl{font-size:0.62rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--tm);}

/* ADMIN BOOKING BANNER */
.abb{background:linear-gradient(135deg,var(--surface2),var(--surface3));border:1px solid var(--gd);border-radius:var(--r);padding:1.2rem 1.4rem;margin-bottom:1.4rem;display:flex;align-items:center;gap:1rem;font-size:0.8rem;color:var(--td);}

/* BOOKING DETAIL MODAL */
.bd-row{display:flex;justify-content:space-between;padding:0.55rem 0;border-bottom:1px solid var(--border);font-size:0.8rem;}
.bd-row:last-child{border-bottom:none;}
.bd-label{color:var(--tm);font-size:0.68rem;letter-spacing:0.12em;text-transform:uppercase;}
.bd-val{text-align:right;font-weight:400;}

/* CHECKIN/OUT STATUS */
.ci-status{display:flex;gap:0.5rem;flex-wrap:wrap;}

@media(max-width:900px){.hbg{display:flex;}.nav-desktop{display:none;}.drawer{display:flex;}}
@media(max-width:640px){nav{padding:0 1.2rem;}.con{padding:1.8rem 1rem;}.ph{padding:2rem 1rem 1.5rem;}.authc{padding:2rem 1.4rem;}.mod{padding:1.6rem;}}
</style>
</head>
<body>

<!-- NAV -->
<nav id="mnav">
  <div class="nav-logo" onclick="go('home')">
    <span>üè®</span>
    <div>Marciibel<div class="nav-logo-sub">Hotels Budapest</div></div>
  </div>
  <div class="nav-desktop" id="navd">
    <button class="nl" onclick="go('home')">F≈ëoldal</button>
    <button class="nl" onclick="go('rooms')">Szob√°k</button>
    <button class="nl" onclick="go('calendar')">Napt√°r</button>
    <button class="nl" onclick="go('reviews')">V√©lem√©nyek</button>
    <button class="nl" id="n-my" style="display:none" onclick="go('mybookings')">Foglal√°saim</button>
    <button class="nl" id="n-prof" style="display:none" onclick="go('profile')">Profil</button>
    <button class="nl gold-btn" id="n-adm" style="display:none" onclick="go('admin')">‚öô Admin</button>
    <div class="nav-pill" id="n-user" style="display:none">
      <div class="nav-av" id="n-av">?</div>
      <span id="n-em" style="max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"></span>
      <button class="nl" style="padding:0.3rem 0.5rem;" onclick="logout()">Ki</button>
    </div>
    <button class="nl" id="n-auth" onclick="go('auth')">Bejelentkez√©s</button>
  </div>
  <button class="hbg" id="hbg" onclick="toggleDrawer()"><span></span><span></span><span></span></button>
</nav>

<!-- DRAWER -->
<div class="dov" id="dov" onclick="toggleDrawer()"></div>
<div class="drawer" id="drw">
  <button class="dl" onclick="go('home');toggleDrawer()">üè† F≈ëoldal</button>
  <button class="dl" onclick="go('rooms');toggleDrawer()">üõèÔ∏è Szob√°k</button>
  <button class="dl" onclick="go('calendar');toggleDrawer()">üìÖ Napt√°r</button>
  <button class="dl" onclick="go('reviews');toggleDrawer()">‚≠ê V√©lem√©nyek</button>
  <button class="dl" id="d-my" style="display:none" onclick="go('mybookings');toggleDrawer()">üìã Foglal√°saim</button>
  <button class="dl" id="d-prof" style="display:none" onclick="go('profile');toggleDrawer()">üë§ Profil</button>
  <button class="dl" id="d-adm" style="display:none" onclick="go('admin');toggleDrawer()">‚öôÔ∏è Admin</button>
  <div style="border-top:1px solid var(--border);margin-top:auto;padding-top:1rem;">
    <div id="d-uinfo" style="display:none;font-size:0.72rem;color:var(--td);padding:0.5rem 1rem;margin-bottom:0.4rem;"></div>
    <button class="dl" id="d-auth" onclick="go('auth');toggleDrawer()">üîë Bejelentkez√©s</button>
    <button class="dl" id="d-out" style="display:none;color:var(--danger);" onclick="logout();toggleDrawer()">‚Ü© Kil√©p√©s</button>
  </div>
</div>

<!-- ‚ïê‚ïê HOME ‚ïê‚ïê -->
<div id="page-home" class="pflex active">
  <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;text-align:center;overflow:hidden;min-height:calc(100vh - var(--nh));">
    <div class="hero-bg"></div><div class="hero-grid"></div>
    <div style="position:relative;max-width:680px;padding:2rem;">
      <div style="font-size:0.62rem;letter-spacing:0.45em;text-transform:uppercase;color:var(--gold);margin-bottom:1.8rem;display:flex;align-items:center;gap:1rem;animation:fu 0.8s ease both;">
        <span style="flex:1;height:1px;background:var(--gd);"></span>Budapest pr√©mium sz√°llod√°ja<span style="flex:1;height:1px;background:var(--gd);"></span>
      </div>
      <h1 style="font-family:'Playfair Display',serif;font-size:clamp(2.6rem,7vw,5.5rem);font-weight:700;line-height:1.05;margin-bottom:1.2rem;animation:fu 0.8s 0.1s ease both;">Marciibel<br><em style="color:var(--gold);">Hotels</em> Budapest</h1>
      <p style="color:var(--td);font-size:0.88rem;line-height:1.8;max-width:460px;margin:0 auto 2.5rem;animation:fu 0.8s 0.2s ease both;">Foglaljon szob√°t egyszer≈±en √©s gyorsan. Pr√©mium szob√°k, kiv√°l√≥ elhelyezked√©s ‚Äì fizet√©s √©rkez√©skor, helysz√≠nen.</p>
      <div style="display:flex;gap:0.85rem;justify-content:center;flex-wrap:wrap;animation:fu 0.8s 0.3s ease both;">
        <button class="btn bg blg" onclick="go('rooms')">Szob√°k megtekint√©se</button>
        <button class="btn bo blg" onclick="go('calendar')">Napt√°r n√©zet</button>
      </div>
      <div style="display:flex;gap:2.5rem;justify-content:center;margin-top:4.5rem;border-top:1px solid var(--border);padding-top:2.2rem;animation:fu 0.8s 0.4s ease both;flex-wrap:wrap;">
        <div><div style="font-family:'Playfair Display',serif;font-size:1.9rem;color:var(--gold);font-weight:700;">4</div><div style="font-size:0.6rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--tm);margin-top:0.25rem;">Pr√©mium szoba</div></div>
        <div style="width:1px;background:var(--border);"></div>
        <div><div style="font-family:'Playfair Display',serif;font-size:1.9rem;color:var(--gold);font-weight:700;">‚òÖ 4.9</div><div style="font-size:0.6rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--tm);margin-top:0.25rem;">√Åtlagos √©rt√©kel√©s</div></div>
        <div style="width:1px;background:var(--border);"></div>
        <div><div style="font-family:'Playfair Display',serif;font-size:1.9rem;color:var(--gold);font-weight:700;">24/7</div><div style="font-size:0.6rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--tm);margin-top:0.25rem;">Recepci√≥</div></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ROOMS ‚ïê‚ïê -->
<div id="page-rooms" class="page">
  <div class="ph"><div class="pe">Szob√°k & Suites</div><h2 class="pt">V√°lasszon <em>szob√°t</em></h2><p class="ps">K√©nyelmes √©s eleg√°ns szob√°ink k√∂z√ºl minden ig√©nyt kiel√©g√≠t</p></div>
  <div class="con" style="padding-top:0;">
    <div class="rooms-toolbar">
      <div class="sb"><input type="text" id="r-search" placeholder="Szoba keres√©se..." oninput="filterRooms()"></div>
      <select class="fsel" id="r-sort" onchange="filterRooms()">
        <option value="">Rendez√©s: alap</option>
        <option value="pa">√År: alacsony ‚Üí magas</option>
        <option value="pd">√År: magas ‚Üí alacsony</option>
        <option value="cap">Kapacit√°s</option>
      </select>
      <select class="fsel" id="r-cap" onchange="filterRooms()">
        <option value="">Minden kapacit√°s</option>
        <option value="s">1‚Äì2 f≈ë</option>
        <option value="l">3+ f≈ë</option>
      </select>
    </div>
    <div class="rg" id="rooms-grid"><div style="text-align:center;padding:3rem;color:var(--tm);">‚è≥ Bet√∂lt√©s...</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê CALENDAR ‚ïê‚ïê -->
<div id="page-calendar" class="page">
  <div class="ph"><div class="pe">Foglalts√°g √°ttekint√©se</div><h2 class="pt">Napt√°r <em>n√©zet</em></h2><p class="ps">Kattintson egy napra a foglal√°sok r√©szletei√©rt</p></div>
  <div class="con" style="padding-top:0;display:grid;grid-template-columns:1fr 340px;gap:1.5rem;align-items:start;">
    <div class="calw">
      <div class="calh"><button class="calbtn" id="cal-p">‚Äπ</button><div class="cal-ml" id="cal-lbl"></div><button class="calbtn" id="cal-n">‚Ä∫</button></div>
      <div class="calg" id="cal-grid"></div>
      <div class="cal-leg">
        <div class="li"><div class="ld" style="background:rgba(201,168,76,0.18);border:1px solid var(--gd);"></div>R√©szben foglalt</div>
        <div class="li"><div class="ld" style="background:rgba(192,57,43,0.18);border:1px solid rgba(192,57,43,0.28);"></div>Tele</div>
        <div class="li"><div class="ld" style="background:var(--gg);border:1px solid var(--gd);"></div>Ma</div>
      </div>
    </div>
    <div class="card" style="padding:1.6rem;" id="cal-det"><p style="color:var(--tm);font-size:0.8rem;font-style:italic;">Kattintson egy napra...</p></div>
  </div>
</div>

<!-- ‚ïê‚ïê REVIEWS ‚ïê‚ïê -->
<div id="page-reviews" class="page">
  <div class="ph"><div class="pe">Vend√©geink mondt√°k</div><h2 class="pt">V√©le<em>m√©nyek</em></h2><p class="ps">Ossza meg tapasztalat√°t</p></div>
  <div class="con" style="padding-top:0;">
    <div style="display:flex;gap:1.5rem;align-items:start;flex-wrap:wrap;margin-bottom:2.5rem;">
      <div class="card" style="padding:1.7rem;flex:1;min-width:270px;" id="rv-form-wrap">
        <div style="font-size:0.62rem;letter-spacing:0.35em;text-transform:uppercase;color:var(--gold);margin-bottom:0.7rem;">V√©lem√©ny √≠r√°sa</div>
        <div id="rv-inner">
          <div class="fg" style="margin-bottom:1rem;"><label>Szoba</label><select id="rv-room"></select></div>
          <div class="fg" style="margin-bottom:1rem;">
            <label>√ârt√©kel√©s</label>
            <div class="stars" id="rv-stars">
              <span class="star" data-v="1">‚òÖ</span><span class="star" data-v="2">‚òÖ</span><span class="star" data-v="3">‚òÖ</span><span class="star" data-v="4">‚òÖ</span><span class="star" data-v="5">‚òÖ</span>
            </div>
          </div>
          <div class="fg" style="margin-bottom:1.2rem;"><label>Sz√∂veg *</label><textarea id="rv-txt" placeholder="√çrja meg tapasztalat√°t..."></textarea></div>
          <button class="btn bg blk" onclick="submitReview()">V√©lem√©ny elk√ºld√©se</button>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:1rem;min-width:180px;">
        <div class="card" style="padding:1.4rem;text-align:center;">
          <div style="font-family:'Playfair Display',serif;font-size:2.8rem;font-weight:700;color:var(--gold);" id="avg-r">‚Äì</div>
          <div class="stars" style="justify-content:center;margin:0.45rem 0;" id="avg-stars"></div>
          <div style="font-size:0.7rem;color:var(--tm);letter-spacing:0.08em;" id="rv-cnt">0 v√©lem√©ny</div>
        </div>
      </div>
    </div>
    <div class="rvg" id="rv-grid"><div style="text-align:center;padding:3rem;color:var(--tm);">Bet√∂lt√©s...</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê BOOKING ‚ïê‚ïê -->
<div id="page-booking" class="page">
  <div class="ph"><div class="pe">Online foglal√°s</div><h2 class="pt">Szoba <em>foglal√°s</em></h2><p class="ps">T√∂ltse ki az adatokat ‚Äì fizet√©s √©rkez√©skor</p></div>
  <div class="con" style="padding-top:0;">
    <div class="ib">üí° Az online fizet√©s nem sz√ºks√©ges. A sz√°ml√°t √©rkez√©skor rendezi helysz√≠nen.</div>
    <div class="wsteps" id="wsteps">
      <div class="ws active" data-s="1"><div class="wsn">1</div><div class="wsl">Szoba & D√°tum</div></div>
      <div class="ws" data-s="2"><div class="wsn">2</div><div class="wsl">Szem√©lyes adatok</div></div>
      <div class="ws" data-s="3"><div class="wsn">3</div><div class="wsl">√ñsszes√≠t≈ë</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 310px;gap:1.5rem;align-items:start;">
      <div>
        <!-- Step 1 -->
        <div class="wp active" id="step-1">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Szoba √©s id≈ëpont</div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="fg"><label>Szoba *</label><select id="b-room" onchange="updateSum()"></select></div>
              <div class="fr">
                <div class="fg"><label>√ârkez√©s *</label><input type="date" id="b-ci" onchange="updateSum()"></div>
                <div class="fg"><label>T√°voz√°s *</label><input type="date" id="b-co" onchange="updateSum()"></div>
              </div>
              <div class="fr">
                <div class="fg"><label>Feln≈ëttek</label><select id="b-ad" onchange="updateSum()"><option>1</option><option selected>2</option><option>3</option><option>4</option></select></div>
                <div class="fg"><label>Gyerekek</label><select id="b-ch" onchange="updateSum()"><option selected>0</option><option>1</option><option>2</option><option>3</option></select></div>
              </div>
            </div>
            <br><button class="btn bg" onclick="wNext(1)">Tov√°bb ‚Üí</button>
          </div>
        </div>
        <!-- Step 2 -->
        <div class="wp" id="step-2">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Szem√©lyes adatok</div>
            <div id="adm-src-field" style="display:none;margin-bottom:1.2rem;">
              <div class="abb"><span style="font-size:1.3rem;">üìû</span><div><div style="font-weight:500;color:var(--text);font-size:0.8rem;margin-bottom:0.2rem;">Admin foglal√°s</div><div>Telefonh√≠v√°s vagy szem√©lyes megjelen√©s alapj√°n.</div></div></div>
              <div class="fg"><label>Foglal√°s forr√°sa</label><select id="b-src"><option value="phone">Telefonh√≠v√°s</option><option value="walkin">Szem√©lyes megjelen√©s</option><option value="email_src">Email</option><option value="other">Egy√©b</option></select></div><br>
            </div>
            <div style="display:flex;flex-direction:column;gap:1rem;">
              <div class="fr">
                <div class="fg"><label>Keresztn√©v *</label><input type="text" id="b-fn" placeholder="P√©ter"></div>
                <div class="fg"><label>Vezet√©kn√©v *</label><input type="text" id="b-ln" placeholder="Nagy"></div>
              </div>
              <div class="fg"><label>Email *</label><input type="email" id="b-em" placeholder="pelda@email.hu"></div>
              <div class="fg"><label>Telefonsz√°m</label><input type="tel" id="b-ph" placeholder="+36 30 123 4567"></div>
              <div class="fg"><label>Megjegyz√©s</label><textarea id="b-nt" placeholder="K√ºl√∂nleges k√©r√©sek..."></textarea></div>
            </div>
            <br>
            <div style="display:flex;gap:0.75rem;">
              <button class="btn bgh" onclick="wPrev(2)">‚Üê Vissza</button>
              <button class="btn bg" onclick="wNext(2)">Tov√°bb ‚Üí</button>
            </div>
          </div>
        </div>
        <!-- Step 3 -->
        <div class="wp" id="step-3">
          <div class="card" style="padding:1.7rem;">
            <div style="font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--td);margin-bottom:1.2rem;">Foglal√°s meger≈ës√≠t√©se</div>
            <div id="s3-sum" style="margin-bottom:1.5rem;"></div>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
              <button class="btn bgh" onclick="wPrev(3)">‚Üê Vissza</button>
              <button class="btn bg blg" onclick="submitBooking()">‚úì Foglal√°s v√©gleges√≠t√©se</button>
            </div>
          </div>
        </div>
      </div>
      <div class="sumbox" id="sum-box">
        <div class="sum-title">√ñsszes√≠t≈ë</div>
        <div id="sum-content"><p style="color:var(--tm);font-size:0.78rem;font-style:italic;">V√°lasszon szob√°t √©s d√°tumot</p></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê MY BOOKINGS ‚ïê‚ïê -->
<div id="page-mybookings" class="page">
  <div class="ph"><div class="pe">Saj√°t foglal√°sok</div><h2 class="pt">Foglal√°<em>saim</em></h2><p class="ps">Akt√≠v √©s kor√°bbi foglal√°sai</p></div>
  <div class="con" style="padding-top:0;">
    <div class="card">
      <div class="tw">
        <table>
          <thead><tr><th>Szoba</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>St√°tusz</th><th>√ñsszeg</th><th></th></tr></thead>
          <tbody id="my-tb"><tr><td colspan="7" style="text-align:center;padding:3rem;color:var(--tm);">Bet√∂lt√©s...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê PROFILE ‚ïê‚ïê -->
<div id="page-profile" class="page">
  <div class="ph"><div class="pe">Fi√≥k</div><h2 class="pt">Profil <em>oldal</em></h2><p class="ps">Szem√©lyes adatok √©s be√°ll√≠t√°sok</p></div>
  <div class="con" style="padding-top:0;">
    <div class="profile-grid">
      <div>
        <div class="profile-card" style="margin-bottom:1rem;">
          <div class="profile-av" id="p-av">?</div>
          <div class="profile-name" id="p-name">‚Äì</div>
          <div class="profile-email" id="p-email">‚Äì</div>
          <div class="profile-stats">
            <div class="pstat"><div class="pstat-val" id="p-bcount">0</div><div class="pstat-lbl">Foglal√°s</div></div>
            <div class="pstat"><div class="pstat-val" id="p-rcount">0</div><div class="pstat-lbl">V√©lem√©ny</div></div>
          </div>
        </div>
        <div class="card" style="padding:1.4rem;">
          <div style="font-size:0.62rem;letter-spacing:0.3em;text-transform:uppercase;color:var(--gold);margin-bottom:1rem;">Jelsz√≥ m√≥dos√≠t√°sa</div>
          <div class="fg" style="margin-bottom:0.85rem;"><label>Jelenlegi jelsz√≥</label><input type="password" id="p-cur-pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="fg" style="margin-bottom:0.85rem;"><label>√öj jelsz√≥</label><input type="password" id="p-new-pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="fg" style="margin-bottom:1rem;"><label>√öj jelsz√≥ m√©gegyszer</label><input type="password" id="p-new-pw2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <button class="btn bo" onclick="changePassword()">Jelsz√≥ m√≥dos√≠t√°sa</button>
        </div>
      </div>
      <div>
        <div style="font-size:0.62rem;letter-spacing:0.3em;text-transform:uppercase;color:var(--gold);margin-bottom:1rem;">Kor√°bbi foglal√°saim</div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>Szoba</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>St√°tusz</th><th>√ñsszeg</th></tr></thead>
            <tbody id="p-tb"><tr><td colspan="5" style="text-align:center;padding:2rem;color:var(--tm);">Bet√∂lt√©s...</td></tr></tbody>
          </table></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê AUTH ‚ïê‚ïê -->
<div id="page-auth" class="page">
  <div class="authw">
    <div class="authc">
      <div class="auth-logo">üè® Marciibel Hotels Budapest</div>
      <div class="tabs">
        <button class="tb active" onclick="authTab('login')">Bejelentkez√©s</button>
        <button class="tb" onclick="authTab('register')">Regisztr√°ci√≥</button>
      </div>
      <div id="auth-li">
        <div class="fg" style="margin-bottom:0.9rem;"><label>Email</label><input type="email" id="l-em" placeholder="email@example.com"></div>
        <div class="fg" style="margin-bottom:1.4rem;"><label>Jelsz√≥</label><input type="password" id="l-pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <button class="btn bg blk" onclick="doLogin()">Bejelentkez√©s</button>
      </div>
      <div id="auth-reg" style="display:none;">
        <div class="fr" style="margin-bottom:0.9rem;">
          <div class="fg"><label>Keresztn√©v</label><input type="text" id="r-fn"></div>
          <div class="fg"><label>Vezet√©kn√©v</label><input type="text" id="r-ln"></div>
        </div>
        <div class="fg" style="margin-bottom:0.9rem;"><label>Email</label><input type="email" id="r-em"></div>
        <div class="fg" style="margin-bottom:1.4rem;"><label>Jelsz√≥ (min. 6 karakter)</label><input type="password" id="r-pw"></div>
        <button class="btn bg blk" onclick="doRegister()">Regisztr√°ci√≥</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ADMIN ‚ïê‚ïê -->
<div id="page-admin" class="page">
  <div class="ph"><div class="pe">Vez√©rl≈ëpult</div><h2 class="pt">Admin <em>fel√ºlet</em></h2><p class="ps">Foglal√°sok, szob√°k √©s v√©lem√©nyek kezel√©se</p></div>
  <div class="con" style="padding-top:0;">
    <div class="sg">
      <div class="sc"><div class="sl">√ñsszes foglal√°s</div><div class="sv" id="st-tot">‚Äì</div></div>
      <div class="sc"><div class="sl">F√ºgg≈ëben</div><div class="sv" id="st-pen">‚Äì</div></div>
      <div class="sc"><div class="sl">Visszaigazolt</div><div class="sv" id="st-con">‚Äì</div></div>
      <div class="sc"><div class="sl">Check-in ma</div><div class="sv" id="st-ci">‚Äì</div></div>
      <div class="sc"><div class="sl">Bev√©tel (visszaig.)</div><div class="sv" id="st-rev">‚Äì</div></div>
    </div>
    <div class="chw"><div class="cht">Foglal√°sok az elm√∫lt 7 napban</div><canvas id="bk-chart" height="80"></canvas></div>
    <div class="tabs">
      <button class="tb active" onclick="aTab('bk')">Foglal√°sok</button>
      <button class="tb" onclick="aTab('abk')">Admin foglal√°s</button>
      <button class="tb" onclick="aTab('rm')">Szob√°k</button>
      <button class="tb" onclick="aTab('rv')">V√©lem√©nyek</button>
    </div>

    <!-- Bookings -->
    <div id="at-bk">
      <div style="display:flex;gap:0.85rem;margin-bottom:1.2rem;flex-wrap:wrap;align-items:center;">
        <select class="fsel" id="a-filter" onchange="loadAdminBk()">
          <option value="">Minden st√°tusz</option><option value="pending">F√ºgg≈ëben</option><option value="confirmed">Visszaigazolt</option><option value="cancelled">Lemondva</option>
        </select>
      </div>
      <div class="card"><div class="tw"><table>
        <thead><tr><th>Vend√©g</th><th>Szoba</th><th>√ârkez√©s</th><th>T√°voz√°s</th><th>Vend√©gek</th><th>Forr√°s</th><th>Check-in</th><th>St√°tusz</th><th>√ñsszeg</th><th>M≈±veletek</th></tr></thead>
        <tbody id="a-tb"></tbody>
      </table></div></div>
    </div>

    <!-- Admin booking -->
    <div id="at-abk" style="display:none;">
      <div class="abb"><span style="font-size:1.5rem;">üìû</span><div><div style="font-weight:500;color:var(--text);font-size:0.88rem;margin-bottom:0.2rem;">Foglal√°s r√∂gz√≠t√©se vend√©g nev√©ben</div><div>Telefonh√≠v√°s, email vagy szem√©lyes megjelen√©s alapj√°n.</div></div></div>
      <div class="card" style="padding:2rem;max-width:700px;">
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="fr">
            <div class="fg"><label>Szoba *</label><select id="ab-rm" onchange="updateAbSum()"></select></div>
            <div class="fg"><label>Foglal√°s forr√°sa</label><select id="ab-src"><option value="phone">Telefonh√≠v√°s</option><option value="walkin">Szem√©lyes</option><option value="email_src">Email</option><option value="other">Egy√©b</option></select></div>
          </div>
          <div class="fr">
            <div class="fg"><label>√ârkez√©s *</label><input type="date" id="ab-ci" onchange="updateAbSum()"></div>
            <div class="fg"><label>T√°voz√°s *</label><input type="date" id="ab-co" onchange="updateAbSum()"></div>
          </div>
          <div class="fr">
            <div class="fg"><label>Feln≈ëttek</label><select id="ab-ad"><option>1</option><option selected>2</option><option>3</option><option>4</option></select></div>
            <div class="fg"><label>Gyerekek</label><select id="ab-ch"><option selected>0</option><option>1</option><option>2</option><option>3</option></select></div>
          </div>
          <div class="fr">
            <div class="fg"><label>Keresztn√©v *</label><input type="text" id="ab-fn" placeholder="P√©ter"></div>
            <div class="fg"><label>Vezet√©kn√©v *</label><input type="text" id="ab-ln" placeholder="Nagy"></div>
          </div>
          <div class="fg"><label>Email *</label><input type="email" id="ab-em" placeholder="pelda@email.hu"></div>
          <div class="fg"><label>Telefonsz√°m</label><input type="tel" id="ab-ph" placeholder="+36 30 123 4567"></div>
          <div class="fg"><label>Megjegyz√©s</label><textarea id="ab-nt"></textarea></div>
          <div id="ab-sum" style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);padding:1rem;font-size:0.8rem;color:var(--td);">V√°lasszon szob√°t √©s d√°tumot</div>
        </div>
        <br><button class="btn bg" onclick="submitAdminBk()">‚úì Foglal√°s r√∂gz√≠t√©se</button>
      </div>
    </div>

    <!-- Rooms -->
    <div id="at-rm" style="display:none;">
      <div style="margin-bottom:1.4rem;"><button class="btn bo bsm" onclick="openModal('m-addroom')">+ √öj szoba</button></div>
      <div class="rg" id="a-rg"></div>
    </div>

    <!-- Reviews -->
    <div id="at-rv" style="display:none;">
      <div class="card"><div class="tw"><table>
        <thead><tr><th>Vend√©g</th><th>Szoba</th><th>√ârt√©kel√©s</th><th>Sz√∂veg</th><th>D√°tum</th><th></th></tr></thead>
        <tbody id="a-rv-tb"></tbody>
      </table></div></div>
    </div>
  </div>
</div>

<!-- TOASTS -->
<div id="toasts"></div>

<!-- MODAL: Room detail -->
<div class="mo" id="m-room"><div class="mod" style="max-width:560px;"><button class="mc" onclick="closeModal('m-room')">‚úï</button><div id="m-room-c"></div></div></div>

<!-- MODAL: Add room -->
<div class="mo" id="m-addroom">
  <div class="mod">
    <button class="mc" onclick="closeModal('m-addroom')">‚úï</button>
    <div class="mt" id="addroom-title">√öj szoba</div><div class="msub">Szoba adatainak megad√°sa</div>
    <div style="display:flex;flex-direction:column;gap:0.9rem;">
      <div class="fg"><label>Szoba neve *</label><input type="text" id="nr-name" placeholder="pl. Deluxe Suite"></div>
      <div class="fg"><label>Le√≠r√°s</label><textarea id="nr-desc"></textarea></div>
      <div class="fr">
        <div class="fg"><label>√År / √©jszaka (Ft) *</label><input type="number" id="nr-price" placeholder="35000"></div>
        <div class="fg"><label>Max. vend√©g</label><input type="number" id="nr-cap" value="2"></div>
      </div>
      <div class="fr">
        <div class="fg"><label>Emoji ikon</label><input type="text" id="nr-emoji" value="üõèÔ∏è"></div>
        <div class="fg"><label>Szoba k√≥d</label><input type="text" id="nr-code" placeholder="101"></div>
      </div>
      <div class="fg"><label>Kiemelt?</label><select id="nr-feat"><option value="0">Nem</option><option value="1">Igen</option></select></div>
      <div class="fg"><label>Felszerelts√©g (vessz≈ëvel)</label><input type="text" id="nr-am" placeholder="WiFi, TV, Kl√≠ma"></div>
    </div>
    <br><button class="btn bg blk" id="saveroom-btn" onclick="saveRoom()">Szoba ment√©se</button>
    <input type="hidden" id="nr-edit-id">
  </div>
</div>

<!-- MODAL: Booking detail -->
<div class="mo" id="m-bkdet">
  <div class="mod" style="max-width:560px;">
    <button class="mc" onclick="closeModal('m-bkdet')">‚úï</button>
    <div id="m-bkdet-c"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EJS = 'marciibelhotels', EJT = 'foglalas_budapest', EJK = 'AbatrWN5NbbsWfMsM';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let CU = null, isAdmin = false;
let rooms = [], allBk = [];
let calY = new Date().getFullYear(), calM = new Date().getMonth();
let wStep = 1, rvRating = 0;
let bkChart = null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('firebaseReady', async () => {
  emailjs.init(EJK);
  const { auth, onAuthStateChanged } = window._fb;

  window.addEventListener('scroll', () => document.getElementById('mnav').classList.toggle('scrolled', scrollY > 20));

  onAuthStateChanged(auth, async user => {
    CU = user;
    if (user) {
      const { db, doc, getDoc } = window._fb;
      const snap = await getDoc(doc(db, 'users', user.uid));
      isAdmin = snap.exists() && snap.data().role === 'admin';

      ['n-my','n-prof'].forEach(id => { const e=document.getElementById(id); if(e) e.style.display=''; });
      ['d-my','d-prof'].forEach(id => { const e=document.getElementById(id); if(e) e.style.display=''; });
      const na=document.getElementById('n-adm'), da=document.getElementById('d-adm');
      if(na) na.style.display = isAdmin?'':'none';
      if(da) da.style.display = isAdmin?'':'none';

      document.getElementById('n-auth').style.display='none';
      document.getElementById('n-user').style.display='flex';
      document.getElementById('n-av').textContent = user.email[0].toUpperCase();
      document.getElementById('n-em').textContent = user.email;
      document.getElementById('d-auth').style.display='none';
      document.getElementById('d-out').style.display='';
      const dui=document.getElementById('d-uinfo'); if(dui){dui.style.display='';dui.textContent=user.email;}

      if (document.getElementById('page-auth').classList.contains('active')) go('rooms');
    } else {
      isAdmin=false;
      ['n-my','n-prof','n-adm','n-user'].forEach(id=>{const e=document.getElementById(id);if(e)e.style.display='none';});
      ['d-my','d-prof','d-adm','d-out'].forEach(id=>{const e=document.getElementById(id);if(e)e.style.display='none';});
      document.getElementById('n-auth').style.display='';
      document.getElementById('d-auth').style.display='';
      const dui=document.getElementById('d-uinfo'); if(dui) dui.style.display='none';
    }
  });

  await fetchRooms();
  initRvStars();
  go('home');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDrawer() {
  const d=document.getElementById('drw'),o=document.getElementById('dov'),h=document.getElementById('hbg');
  const op=d.classList.toggle('open'); o.classList.toggle('open',op); h.classList.toggle('open',op);
}

function go(name) {
  document.querySelectorAll('.page,.pflex').forEach(p=>{p.classList.remove('active');p.style.display='none';});
  const pg=document.getElementById('page-'+name);
  if(!pg) return;
  pg.style.display = pg.classList.contains('pflex')?'flex':'block';
  pg.classList.add('active');
  window.scrollTo(0,0);
  if(name==='rooms') renderRooms();
  if(name==='calendar') renderCal();
  if(name==='mybookings') loadMyBk();
  if(name==='booking') initBookForm();
  if(name==='reviews') loadReviews();
  if(name==='admin') { loadAdminBk(); loadAdminRooms(); loadAdminRv(); }
  if(name==='profile') loadProfile();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ROOMS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fetchRooms() {
  const {db,collection,getDocs}=window._fb;
  const snap=await getDocs(collection(db,'rooms'));
  rooms=snap.docs.map(d=>({id:d.id,...d.data()}));
  if(!rooms.length){await seedRooms();const s2=await getDocs(collection(db,'rooms'));rooms=s2.docs.map(d=>({id:d.id,...d.data()}));}
}

async function seedRooms() {
  const {db,collection,addDoc}=window._fb;
  const defs=[
    {name:'Standard Szoba',desc:'K√©nyelmes standard szoba r√∂vid tart√≥zkod√°sra. K√∂zvetlen utcai kil√°t√°s.',price:18000,capacity:2,emoji:'üõèÔ∏è',code:'101',featured:false,amenities:['WiFi','TV','Kl√≠ma','F√ºrd≈ëszoba']},
    {name:'Deluxe Szoba',desc:'T√°gas pr√©mium szoba panor√°m√°s ablakkal √©s pr√©mium felszerelts√©ggel.',price:28000,capacity:2,emoji:'üåÖ',code:'201',featured:true,amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Safe']},
    {name:'Junior Suite',desc:'K√ºl√∂n√°ll√≥ nappalival √©s h√°l√≥szob√°val rendelkez≈ë suite, jakuzzival.',price:45000,capacity:3,emoji:'üè°',code:'301',featured:true,amenities:['WiFi','Smart TV','Kl√≠ma','Minibar','Jakuzzi','Nappali']},
    {name:'Penthouse Suite',desc:'Tet≈ëterasz szoba leny≈±g√∂z≈ë panor√°m√°val. Butler, bar, jacuzzi.',price:75000,capacity:4,emoji:'‚ú®',code:'401',featured:true,amenities:['WiFi','4K TV','Kl√≠ma','Priv√°t b√°r','Jakuzzi','Butler','Terasz']},
  ];
  for(const r of defs) await addDoc(collection(db,'rooms'),r);
}

function filterRooms(){renderRooms();}

function renderRooms() {
  const q=(document.getElementById('r-search')?.value||'').toLowerCase();
  const sort=document.getElementById('r-sort')?.value||'';
  const cap=document.getElementById('r-cap')?.value||'';
  let list=[...rooms].filter(r=>{
    const mq=!q||r.name.toLowerCase().includes(q)||r.desc.toLowerCase().includes(q)||(r.amenities||[]).some(a=>a.toLowerCase().includes(q));
    const mc=!cap||(cap==='s'?(r.capacity||2)<=2:(r.capacity||2)>=3);
    return mq&&mc;
  });
  if(sort==='pa') list.sort((a,b)=>a.price-b.price);
  else if(sort==='pd') list.sort((a,b)=>b.price-a.price);
  else if(sort==='cap') list.sort((a,b)=>b.capacity-a.capacity);
  const g=document.getElementById('rooms-grid');
  if(!g) return;
  if(!list.length){g.innerHTML='<div style="text-align:center;padding:3rem;color:var(--tm);">üîç Nincs tal√°lat.</div>';return;}
  const emos=['üõèÔ∏è','üõÅ','üåá','‚òï'];
  g.innerHTML=list.map(r=>{
    const slides=emos.map((e,i)=>`<div class="rg-slide${i?' hidden':''}" id="sl-${r.id}-${i}">${e}</div>`).join('');
    const dots=emos.map((_,i)=>`<div class="gdot${i?' ':' active'}" onclick="event.stopPropagation();slideG('${r.id}',${i})"></div>`).join('');
    return`<div class="rc" onclick="openRoomModal('${r.id}')">
      <div class="rg-wrap">${slides}
        <div class="rbw"><span class="rb rba">El√©rhet≈ë</span>${r.featured?'<span class="rb rbf">Kiemelt</span>':''}</div>
        <div class="gdots">${dots}</div>
      </div>
      <div class="rb-body">
        <div class="rn">${r.name}${r.code?`<span class="rc-code">#${r.code}</span>`:''}</div>
        <div class="rd">${r.desc}</div>
        <div class="ams">${(r.amenities||[]).map(a=>`<span class="am">‚úì ${a}</span>`).join('')}</div>
        <div class="rf">
          <div><div class="rp">${(r.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div><div style="font-size:0.68rem;color:var(--tm);margin-top:0.2rem;">üë• Max. ${r.capacity||2} f≈ë</div></div>
          <button class="btn bo bsm" onclick="event.stopPropagation();openRoomModal('${r.id}')">R√©szletek</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function slideG(rid,idx){
  [0,1,2,3].forEach(i=>{const el=document.getElementById(`sl-${rid}-${i}`);if(el)el.classList.toggle('hidden',i!==idx);});
  document.querySelectorAll(`[onclick*="openRoomModal('${rid}')"] .gdot`).forEach((d,i)=>d.classList.toggle('active',i===idx));
}

function openRoomModal(id){
  const r=rooms.find(x=>x.id===id); if(!r) return;
  const emos=['üõèÔ∏è','üõÅ','üåá','‚òï'];
  document.getElementById('m-room-c').innerHTML=`
    <div style="font-size:3.5rem;text-align:center;margin-bottom:1rem;transition:all 0.3s;" id="med">${emos[0]}</div>
    <div style="display:flex;justify-content:center;gap:0.45rem;margin-bottom:1.2rem;">
      ${emos.map((e,i)=>`<div class="gdot${i?'':' active'}" onclick="document.getElementById('med').textContent='${e}';this.parentNode.querySelectorAll('.gdot').forEach((d,j)=>d.classList.toggle('active',j===${i}))"></div>`).join('')}
    </div>
    <div class="mt">${r.name}${r.code?` <span style="font-size:0.75rem;color:var(--tm);font-family:'Jost',sans-serif;font-weight:300;">#${r.code}</span>`:''}</div>
    <div class="msub">${r.desc}</div>
    <div class="ams" style="margin-bottom:0.9rem;">${(r.amenities||[]).map(a=>`<span class="am">‚úì ${a}</span>`).join('')}</div>
    <p style="font-size:0.7rem;color:var(--tm);margin-bottom:1.2rem;">üë• Max. ${r.capacity||2} vend√©g</p>
    <div style="display:flex;align-items:center;justify-content:space-between;padding-top:1.2rem;border-top:1px solid var(--border);">
      <div style="font-family:'Playfair Display',serif;font-size:1.25rem;color:var(--gold);">${(r.price||0).toLocaleString('hu-HU')} Ft <small style="font-size:0.62rem;color:var(--tm);font-family:'Jost',sans-serif;font-weight:300;">/ √©jszaka</small></div>
      <button class="btn bg" onclick="selectRoom('${r.id}')">Foglal√°s ‚Üí</button>
    </div>`;
  openModal('m-room');
}

function selectRoom(id){
  closeModal('m-room');
  if(!CU){toast('K√©rj√ºk, jelentkezzen be!','inf');go('auth');return;}
  go('booking');
  setTimeout(()=>{const s=document.getElementById('b-room');if(s){s.value=id;updateSum();}},60);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOKING WIZARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initBookForm(){
  const sel=document.getElementById('b-room'); if(!sel) return;
  sel.innerHTML=rooms.map(r=>`<option value="${r.id}">${r.name} ‚Äì ${(r.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  if(CU) document.getElementById('b-em').value=CU.email;
  const today=new Date().toISOString().split('T')[0];
  const tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('b-ci'),co=document.getElementById('b-co');
  ci.min=today;co.min=tom;if(!ci.value)ci.value=today;if(!co.value)co.value=tom;
  document.getElementById('adm-src-field').style.display=isAdmin?'':'none';
  setWStep(1);updateSum();
}

function setWStep(n){
  wStep=n;
  document.querySelectorAll('.ws').forEach((s,i)=>{s.classList.toggle('active',i+1===n);s.classList.toggle('done',i+1<n);});
  document.querySelectorAll('.wp').forEach((p,i)=>p.classList.toggle('active',i+1===n));
  if(n===3) buildS3();
}
function wNext(s){
  if(s===1){
    const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
    if(!ci||!co){toast('Adja meg a d√°tumokat!','err');return;}
    if(new Date(ci)>=new Date(co)){toast('A t√°voz√°s kor√°bbi az √©rkez√©sn√©l!','err');return;}
  }
  if(s===2){
    if(!document.getElementById('b-fn').value.trim()||!document.getElementById('b-ln').value.trim()||!document.getElementById('b-em').value.trim()){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','err');return;}
  }
  setWStep(s+1);
}
function wPrev(s){setWStep(s-1);}

function updateSum(){
  const r=rooms.find(x=>x.id===document.getElementById('b-room')?.value);
  const ci=document.getElementById('b-ci')?.value,co=document.getElementById('b-co')?.value;
  const sc=document.getElementById('sum-content'); if(!sc) return;
  if(!r||!ci||!co){sc.innerHTML='<p style="color:var(--tm);font-size:0.78rem;font-style:italic;">V√°lasszon szob√°t √©s d√°tumot</p>';return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(r.price||0);
  sc.innerHTML=`
    <div class="sr"><span>Szoba</span><span>${r.name}</span></div>
    <div class="sr"><span>√ârkez√©s</span><span>${ci}</span></div>
    <div class="sr"><span>T√°voz√°s</span><span>${co}</span></div>
    <div class="sr"><span>√âjszak√°k</span><span>${n}</span></div>
    <div class="sr"><span>√År/√©j</span><span>${(r.price||0).toLocaleString('hu-HU')} Ft</span></div>
    <div class="sr tot"><span>V√©g√∂sszeg</span><span>${tot.toLocaleString('hu-HU')} Ft</span></div>
    <div class="sum-note">üí° Fizet√©s √©rkez√©skor, helysz√≠nen. Online el≈ëleg nem sz√ºks√©ges.</div>`;
}

function buildS3(){
  const r=rooms.find(x=>x.id===document.getElementById('b-room').value);
  const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
  const fn=document.getElementById('b-fn').value,ln=document.getElementById('b-ln').value;
  const em=document.getElementById('b-em').value,ph=document.getElementById('b-ph').value;
  const ad=document.getElementById('b-ad').value,ch=document.getElementById('b-ch').value;
  const nt=document.getElementById('b-nt').value;
  if(!r) return;
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(r.price||0);
  document.getElementById('s3-sum').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.7rem;font-size:0.8rem;margin-bottom:1rem;">
      ${[['Szoba',r.name],['Vend√©g',`${fn} ${ln}`],['√ârkez√©s',ci],['T√°voz√°s',co],['Email',em],['Telefon',ph||'‚Äì'],['Vend√©gek',`${ad} feln≈ëtt${+ch>0?', '+ch+' gyerek':''}`],['√âjszak√°k',n+' √©j']].map(([l,v])=>`<div><div style="font-size:0.62rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--tm);">${l}</div><div style="margin-top:0.2rem;">${v}</div></div>`).join('')}
    </div>
    ${nt?`<div style="font-size:0.76rem;color:var(--td);padding:0.7rem;background:var(--surface2);border-radius:var(--r);margin-bottom:0.8rem;">üí¨ ${nt}</div>`:''}
    <div style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--gg);border:1px solid var(--gd);border-radius:var(--r);">
      <span style="font-size:0.68rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--td);">V√©g√∂sszeg</span>
      <span style="font-family:'Playfair Display',serif;font-size:1.25rem;color:var(--gold);">${tot.toLocaleString('hu-HU')} Ft</span>
    </div>`;
}

async function submitBooking(){
  if(!CU){toast('K√©rj√ºk, jelentkezzen be!','err');return;}
  const rid=document.getElementById('b-room').value;
  const r=rooms.find(x=>x.id===rid);
  const ci=document.getElementById('b-ci').value,co=document.getElementById('b-co').value;
  const fn=document.getElementById('b-fn').value.trim(),ln=document.getElementById('b-ln').value.trim();
  const em=document.getElementById('b-em').value.trim(),ph=document.getElementById('b-ph').value.trim();
  const ad=document.getElementById('b-ad').value,ch=document.getElementById('b-ch').value;
  const nt=document.getElementById('b-nt').value.trim();
  const src=isAdmin?(document.getElementById('b-src')?.value||'admin'):'online';
  if(!r||!ci||!co||!fn||!ln||!em){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','err');return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(r.price||0);
  const {db,collection,addDoc,serverTimestamp}=window._fb;
  try{
    const ref=await addDoc(collection(db,'bookings'),{
      userId:CU.uid,userEmail:CU.email,roomId:rid,roomName:r.name,roomCode:r.code||'',
      checkin:ci,checkout:co,firstname:fn,lastname:ln,email:em,phone:ph,
      adults:+ad,children:+ch,notes:nt,nights:n,total:tot,
      status:'pending',source:src,checkedIn:false,checkedOut:false,
      createdAt:serverTimestamp()
    });
    try{await emailjs.send(EJS,EJT,{to_name:`${fn} ${ln}`,to_email:em,room_name:r.name,checkin:ci,checkout:co,nights:n.toString(),total:tot.toLocaleString('hu-HU')+' Ft',booking_id:ref.id,adults:ad.toString(),children:ch.toString(),phone:ph||'‚Äì',notes:nt||'‚Äì'});}
    catch(e){console.warn('EmailJS:',e);}
    toast('Foglal√°s sikeresen elk√ºldve! Email √©rtes√≠t≈ët k√ºldt√ºnk.','ok');
    go('mybookings');
  }catch(e){toast('Hiba: '+e.message,'err');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MY BOOKINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadMyBk(){
  if(!CU) return;
  const {db,collection,getDocs,query,where}=window._fb;
  const tb=document.getElementById('my-tb');
  try{
    const q=query(collection(db,'bookings'),where('userId','==',CU.uid));
    const snap=await getDocs(q);
    const items=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
    if(!items.length){tb.innerHTML=`<tr><td colspan="7" style="text-align:center;padding:3rem;color:var(--tm);">M√©g nincs foglal√°sa. <button class="btn bo bsm" onclick="go('rooms')" style="margin-left:0.5rem;">Szob√°k</button></td></tr>`;return;}
    tb.innerHTML=items.map(b=>`<tr>
      <td><strong>${b.roomName}</strong>${b.roomCode?` <span style="color:var(--tm);font-size:0.68rem;">#${b.roomCode}</span>`:''}</td>
      <td>${b.checkin}</td><td>${b.checkout}</td>
      <td>${b.adults} feln≈ëtt${(b.children||0)>0?', '+b.children+' gyerek':''}</td>
      <td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td>
      <td style="color:var(--gold);font-family:'Playfair Display',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
      <td style="display:flex;gap:0.4rem;flex-wrap:wrap;">
        <button class="btn bgh bsm" onclick="openBkDetail(${JSON.stringify(b).replace(/"/g,'&quot;')})">R√©szletek</button>
        ${b.status==='pending'?`<button class="btn bd bsm" onclick="cancelMyBk('${b.id}')">Lemond√°s</button>`:''}
      </td>
    </tr>`).join('');
  }catch(e){tb.innerHTML=`<tr><td colspan="7" style="color:var(--danger);padding:1rem;">Hiba: ${e.message}</td></tr>`;}
}

async function cancelMyBk(id){
  if(!confirm('Biztosan lemondja?'))return;
  const {db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'cancelled'});
  toast('Foglal√°s lemondva.','inf');loadMyBk();
}

function openBkDetail(b){
  const nights=Math.max(1,Math.round((new Date(b.checkout)-new Date(b.checkin))/86400000));
  document.getElementById('m-bkdet-c').innerHTML=`
    <div class="mt">${b.roomName}</div>
    <div class="msub">Foglal√°s r√©szletei</div>
    ${[['Foglal√°s ID',b.id.slice(0,8)+'...'],['Vend√©g',`${b.firstname} ${b.lastname}`],['Email',b.email||'‚Äì'],['Telefon',b.phone||'‚Äì'],['√ârkez√©s',b.checkin],['T√°voz√°s',b.checkout],['√âjszak√°k',nights+' √©j'],['Feln≈ëttek',b.adults||0],['Gyerekek',b.children||0],['St√°tusz',bLbl(b.status)],['Forr√°s',srcLbl(b.source)],['Check-in',b.checkedIn?'‚úì Meg√©rkezett':'Nem √©rkezett meg'],['Check-out',b.checkedOut?'‚úì Elutazott':'M√©g bent van'],['√ñsszeg',(b.total||0).toLocaleString('hu-HU')+' Ft']].map(([l,v])=>`<div class="bd-row"><div class="bd-label">${l}</div><div class="bd-val">${v}</div></div>`).join('')}
    ${b.notes?`<div style="margin-top:1rem;padding:0.8rem;background:var(--surface2);border-radius:var(--r);font-size:0.78rem;color:var(--td);">üí¨ ${b.notes}</div>`:''}`;
  openModal('m-bkdet');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadProfile(){
  if(!CU){go('auth');return;}
  const {db,collection,getDocs,query,where,getDoc,doc}=window._fb;
  const snap=await getDoc(doc(db,'users',CU.uid));
  const ud=snap.exists()?snap.data():{};
  const fn=ud.firstname||'';const ln=ud.lastname||'';
  const name=fn||ln?`${fn} ${ln}`.trim():CU.email.split('@')[0];
  document.getElementById('p-av').textContent=CU.email[0].toUpperCase();
  document.getElementById('p-name').textContent=name;
  document.getElementById('p-email').textContent=CU.email;

  const bkq=query(collection(db,'bookings'),where('userId','==',CU.uid));
  const bksnap=await getDocs(bkq);
  const bks=bksnap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  document.getElementById('p-bcount').textContent=bks.length;

  const rvq=query(collection(db,'reviews'),where('userId','==',CU.uid));
  const rvsnap=await getDocs(rvq);
  document.getElementById('p-rcount').textContent=rvsnap.size;

  const ptb=document.getElementById('p-tb');
  if(!bks.length){ptb.innerHTML='<tr><td colspan="5" style="text-align:center;padding:2rem;color:var(--tm);">M√©g nincs foglal√°sa.</td></tr>';return;}
  ptb.innerHTML=bks.map(b=>`<tr>
    <td><strong>${b.roomName}</strong></td>
    <td>${b.checkin}</td><td>${b.checkout}</td>
    <td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td>
    <td style="color:var(--gold);font-family:'Playfair Display',serif;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
  </tr>`).join('');
}

async function changePassword(){
  if(!CU){return;}
  const cur=document.getElementById('p-cur-pw').value;
  const np=document.getElementById('p-new-pw').value;
  const np2=document.getElementById('p-new-pw2').value;
  if(!cur||!np||!np2){toast('T√∂ltse ki az √∂sszes mez≈ët!','err');return;}
  if(np!==np2){toast('Az √∫j jelszavak nem egyeznek!','err');return;}
  if(np.length<6){toast('A jelsz√≥nak legal√°bb 6 karakter kell!','err');return;}
  const {auth,EmailAuthProvider,reauthenticateWithCredential,updatePassword}=window._fb;
  try{
    const cred=EmailAuthProvider.credential(CU.email,cur);
    await reauthenticateWithCredential(CU,cred);
    await updatePassword(CU,np);
    toast('Jelsz√≥ sikeresen m√≥dos√≠tva!','ok');
    document.getElementById('p-cur-pw').value='';
    document.getElementById('p-new-pw').value='';
    document.getElementById('p-new-pw2').value='';
  }catch(e){toast('Hiba: '+(e.code==='auth/wrong-password'?'Hib√°s jelenlegi jelsz√≥':e.message),'err');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN BOOKINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAdminBk(){
  if(!isAdmin) return;
  const {db,collection,getDocs,query,where}=window._fb;
  const tb=document.getElementById('a-tb'); if(!tb) return;
  tb.innerHTML='<tr><td colspan="10" style="text-align:center;padding:3rem;color:var(--tm);">Bet√∂lt√©s...</td></tr>';
  try{
    const flt=document.getElementById('a-filter')?.value||'';
    const q=flt?query(collection(db,'bookings'),where('status','==',flt)):collection(db,'bookings');
    const snap=await getDocs(q);
    allBk=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));

    document.getElementById('st-tot').textContent=allBk.length;
    document.getElementById('st-pen').textContent=allBk.filter(b=>b.status==='pending').length;
    document.getElementById('st-con').textContent=allBk.filter(b=>b.status==='confirmed').length;
    const tod=new Date().toISOString().split('T')[0];
    document.getElementById('st-ci').textContent=allBk.filter(b=>b.checkin===tod&&b.status==='confirmed').length;
    document.getElementById('st-rev').textContent=allBk.filter(b=>b.status==='confirmed').reduce((s,b)=>s+(b.total||0),0).toLocaleString('hu-HU')+' Ft';

    renderChart(allBk);

    if(!allBk.length){tb.innerHTML='<tr><td colspan="10" style="text-align:center;padding:3rem;color:var(--tm);">Nincs foglal√°s.</td></tr>';return;}
    tb.innerHTML=allBk.map(b=>`<tr>
      <td><strong>${b.firstname||''} ${b.lastname||''}</strong><br><span style="font-size:0.7rem;color:var(--tm);">${b.userEmail}</span>${b.phone?`<br><span style="font-size:0.7rem;color:var(--tm);">${b.phone}</span>`:''}</td>
      <td>${b.roomName}${b.roomCode?` <span style="color:var(--tm);font-size:0.68rem;">#${b.roomCode}</span>`:''}</td>
      <td>${b.checkin}</td><td>${b.checkout}</td>
      <td>${b.adults||0} fel.${(b.children||0)>0?'<br>'+b.children+' gy.':''}</td>
      <td><span style="font-size:0.68rem;color:var(--tm);">${srcLbl(b.source)}</span></td>
      <td>
        <div class="ci-status">
          <span class="badge ${b.checkedIn?'bco':'bp'}" style="cursor:pointer;" onclick="toggleCI('${b.id}','in',${!b.checkedIn})">${b.checkedIn?'‚úì Be':'Be ‚Üí'}</span>
          <span class="badge ${b.checkedOut?'bco':'bp'}" style="cursor:pointer;" onclick="toggleCI('${b.id}','out',${!b.checkedOut})">${b.checkedOut?'‚úì Ki':'Ki ‚Üí'}</span>
        </div>
      </td>
      <td><span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span></td>
      <td style="color:var(--gold);font-family:'Playfair Display',serif;white-space:nowrap;">${(b.total||0).toLocaleString('hu-HU')} Ft</td>
      <td style="display:flex;gap:0.35rem;flex-wrap:wrap;">
        <button class="btn bgh bsm" onclick="openBkDetail(${JSON.stringify(b).replace(/"/g,'&quot;')})">üëÅ</button>
        ${b.status==='pending'?`<button class="btn bs bsm" onclick="confirmBk('${b.id}')">‚úì</button>`:''}
        ${b.status!=='cancelled'?`<button class="btn bd bsm" onclick="adminCancelBk('${b.id}')">‚úï</button>`:''}
      </td>
    </tr>`).join('');
  }catch(e){if(tb)tb.innerHTML=`<tr><td colspan="10" style="color:var(--danger);padding:1rem;">Hiba: ${e.message}</td></tr>`;}
}

async function toggleCI(id,type,val){
  const {db,doc,updateDoc}=window._fb;
  const field=type==='in'?'checkedIn':'checkedOut';
  await updateDoc(doc(db,'bookings',id),{[field]:val});
  toast(val?(type==='in'?'Check-in jel√∂lve!':'Check-out jel√∂lve!'):(type==='in'?'Check-in visszavonva':'Check-out visszavonva'),'inf');
  loadAdminBk();
}

async function confirmBk(id){
  const {db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'confirmed'});
  toast('Foglal√°s visszaigazolva!','ok');loadAdminBk();
}
async function adminCancelBk(id){
  if(!confirm('T√∂rli a foglal√°st?'))return;
  const {db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'bookings',id),{status:'cancelled'});
  toast('Foglal√°s t√∂r√∂lve.','inf');loadAdminBk();
}

function renderChart(bks){
  const c=document.getElementById('bk-chart'); if(!c) return;
  const labels=[],data=[];
  for(let i=6;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    labels.push(d.toLocaleDateString('hu-HU',{month:'short',day:'numeric'}));
    data.push(bks.filter(b=>b.createdAt?.seconds&&new Date(b.createdAt.seconds*1000).toISOString().split('T')[0]===ds).length);
  }
  if(bkChart) bkChart.destroy();
  bkChart=new Chart(c,{type:'bar',data:{labels,datasets:[{label:'Foglal√°sok',data,backgroundColor:'rgba(201,168,76,0.22)',borderColor:'rgba(201,168,76,0.75)',borderWidth:1.5,borderRadius:3}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#4a4540',font:{size:11,family:'Jost'}}},y:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#4a4540',font:{size:11,family:'Jost'},stepSize:1},beginAtZero:true}}}});
}

// ADMIN BOOKING FORM
function initAbForm(){
  const s=document.getElementById('ab-rm'); if(!s) return;
  s.innerHTML=rooms.map(r=>`<option value="${r.id}">${r.name} ‚Äì ${(r.price||0).toLocaleString('hu-HU')} Ft/√©j</option>`).join('');
  const today=new Date().toISOString().split('T')[0];
  const tom=new Date(Date.now()+86400000).toISOString().split('T')[0];
  const ci=document.getElementById('ab-ci'),co=document.getElementById('ab-co');
  if(ci){ci.min=today;if(!ci.value)ci.value=today;}
  if(co){co.min=tom;if(!co.value)co.value=tom;}
  updateAbSum();
}
function updateAbSum(){
  const r=rooms.find(x=>x.id===document.getElementById('ab-rm')?.value);
  const ci=document.getElementById('ab-ci')?.value,co=document.getElementById('ab-co')?.value;
  const box=document.getElementById('ab-sum'); if(!box||!r||!ci||!co) return;
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  box.innerHTML=`<span style="color:var(--td);">Szoba:</span> <strong>${r.name}</strong> &nbsp;|&nbsp; <span style="color:var(--td);">${n} √©j</span> &nbsp;|&nbsp; <span style="color:var(--gold);font-family:'Playfair Display',serif;font-size:1rem;">${(n*(r.price||0)).toLocaleString('hu-HU')} Ft</span>`;
}
async function submitAdminBk(){
  if(!isAdmin){toast('Nincs jogosults√°g!','err');return;}
  const rid=document.getElementById('ab-rm').value,r=rooms.find(x=>x.id===rid);
  const ci=document.getElementById('ab-ci').value,co=document.getElementById('ab-co').value;
  const fn=document.getElementById('ab-fn').value.trim(),ln=document.getElementById('ab-ln').value.trim();
  const em=document.getElementById('ab-em').value.trim(),ph=document.getElementById('ab-ph').value.trim();
  const ad=document.getElementById('ab-ad').value,ch=document.getElementById('ab-ch').value;
  const nt=document.getElementById('ab-nt').value.trim(),src=document.getElementById('ab-src').value;
  if(!r||!ci||!co||!fn||!ln||!em){toast('T√∂ltse ki a k√∂telez≈ë mez≈ëket!','err');return;}
  if(new Date(ci)>=new Date(co)){toast('Hib√°s d√°tum!','err');return;}
  const n=Math.max(1,Math.round((new Date(co)-new Date(ci))/86400000));
  const tot=n*(r.price||0);
  const {db,collection,addDoc,serverTimestamp}=window._fb;
  try{
    const ref=await addDoc(collection(db,'bookings'),{userId:CU.uid,userEmail:CU.email,roomId:rid,roomName:r.name,roomCode:r.code||'',checkin:ci,checkout:co,firstname:fn,lastname:ln,email:em,phone:ph,adults:+ad,children:+ch,notes:nt,nights:n,total:tot,status:'confirmed',source:src,checkedIn:false,checkedOut:false,adminBooking:true,createdAt:serverTimestamp()});
    try{await emailjs.send(EJS,EJT,{to_name:`${fn} ${ln}`,to_email:em,room_name:r.name,checkin:ci,checkout:co,nights:n.toString(),total:tot.toLocaleString('hu-HU')+' Ft',booking_id:ref.id,adults:ad.toString(),children:ch.toString(),phone:ph||'‚Äì',notes:nt||'‚Äì'});}
    catch(e){console.warn(e);}
    toast('Admin foglal√°s r√∂gz√≠tve!','ok');loadAdminBk();aTab('bk');
  }catch(e){toast('Hiba: '+e.message,'err');}
}

// ADMIN ROOMS
async function loadAdminRooms(){
  if(!isAdmin)return;
  const g=document.getElementById('a-rg'); if(!g) return;
  g.innerHTML=rooms.map(r=>`<div class="rc" style="cursor:default;">
    <div class="rg-wrap"><div class="rg-slide">${r.emoji||'üõèÔ∏è'}</div></div>
    <div class="rb-body">
      <div class="rn">${r.name}${r.code?`<span class="rc-code">#${r.code}</span>`:''}</div>
      <div class="rd">${r.desc}</div>
      <div class="ams">${(r.amenities||[]).map(a=>`<span class="am">${a}</span>`).join('')}</div>
      <div class="rf">
        <div class="rp">${(r.price||0).toLocaleString('hu-HU')} Ft <small>/ √©jszaka</small></div>
        <div style="display:flex;gap:0.4rem;">
          <button class="btn bo bsm" onclick="openEditRoom('${r.id}')">Szerkeszt√©s</button>
          <button class="btn bd bsm" onclick="deleteRoom('${r.id}')">T√∂rl√©s</button>
        </div>
      </div>
    </div>
  </div>`).join('');
}

function openEditRoom(id){
  const r=rooms.find(x=>x.id===id); if(!r) return;
  document.getElementById('addroom-title').textContent='Szoba szerkeszt√©se';
  document.getElementById('nr-name').value=r.name||'';
  document.getElementById('nr-desc').value=r.desc||'';
  document.getElementById('nr-price').value=r.price||'';
  document.getElementById('nr-cap').value=r.capacity||2;
  document.getElementById('nr-emoji').value=r.emoji||'üõèÔ∏è';
  document.getElementById('nr-code').value=r.code||'';
  document.getElementById('nr-feat').value=r.featured?'1':'0';
  document.getElementById('nr-am').value=(r.amenities||[]).join(', ');
  document.getElementById('nr-edit-id').value=id;
  document.getElementById('saveroom-btn').textContent='Szoba ment√©se';
  openModal('m-addroom');
}

function openAddRoom(){
  document.getElementById('addroom-title').textContent='√öj szoba';
  ['nr-name','nr-desc','nr-price','nr-code','nr-am'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('nr-cap').value=2;
  document.getElementById('nr-emoji').value='üõèÔ∏è';
  document.getElementById('nr-feat').value='0';
  document.getElementById('nr-edit-id').value='';
  openModal('m-addroom');
}

async function saveRoom(){
  const name=document.getElementById('nr-name').value.trim();
  const price=+document.getElementById('nr-price').value;
  if(!name||!price){toast('N√©v √©s √°r k√∂telez≈ë!','err');return;}
  const data={name,desc:document.getElementById('nr-desc').value.trim(),price,capacity:+document.getElementById('nr-cap').value||2,emoji:document.getElementById('nr-emoji').value.trim()||'üõèÔ∏è',code:document.getElementById('nr-code').value.trim(),featured:document.getElementById('nr-feat').value==='1',amenities:document.getElementById('nr-am').value.split(',').map(s=>s.trim()).filter(Boolean)};
  const editId=document.getElementById('nr-edit-id').value;
  const {db,collection,addDoc,doc,updateDoc}=window._fb;
  if(editId){
    await updateDoc(doc(db,'rooms',editId),data);
    toast('Szoba friss√≠tve!','ok');
  } else {
    await addDoc(collection(db,'rooms'),data);
    toast('Szoba hozz√°adva!','ok');
  }
  closeModal('m-addroom');
  await fetchRooms();
  loadAdminRooms();renderRooms();
}

async function deleteRoom(id){
  if(!confirm('Biztosan t√∂rli a szob√°t?'))return;
  const {db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'rooms',id));
  rooms=rooms.filter(r=>r.id!==id);
  toast('Szoba t√∂r√∂lve.','inf');
  loadAdminRooms();renderRooms();
}

function aTab(t){
  ['bk','abk','rm','rv'].forEach(x=>{const el=document.getElementById('at-'+x);if(el)el.style.display=t===x?'':'none';});
  document.querySelectorAll('#page-admin .tb').forEach((b,i)=>b.classList.toggle('active',['bk','abk','rm','rv'][i]===t));
  if(t==='abk') initAbForm();
  if(t==='rv') loadAdminRv();
}

// ADMIN REVIEWS
async function loadAdminRv(){
  if(!isAdmin)return;
  const {db,collection,getDocs}=window._fb;
  const tb=document.getElementById('a-rv-tb'); if(!tb) return;
  const snap=await getDocs(collection(db,'reviews'));
  const rvs=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  if(!rvs.length){tb.innerHTML='<tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--tm);">M√©g nincs v√©lem√©ny.</td></tr>';return;}
  tb.innerHTML=rvs.map(r=>`<tr>
    <td>${r.name||'‚Äì'}<br><span style="font-size:0.7rem;color:var(--tm);">${r.userEmail}</span></td>
    <td>${r.roomName||'‚Äì'}</td>
    <td><span style="color:var(--gold);">${'‚òÖ'.repeat(r.rating||0)}</span></td>
    <td style="max-width:180px;font-style:italic;font-size:0.76rem;color:var(--td);">${r.text}</td>
    <td style="font-size:0.72rem;color:var(--tm);">${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</td>
    <td><button class="btn bd bsm" onclick="deleteRv('${r.id}')">T√∂rl√©s</button></td>
  </tr>`).join('');
}
async function deleteRv(id){
  if(!confirm('T√∂rli?'))return;
  const {db,doc,deleteDoc}=window._fb;
  await deleteDoc(doc(db,'reviews',id));
  toast('V√©lem√©ny t√∂r√∂lve.','inf');
  loadAdminRv();loadReviews();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initRvStars(){
  const el=document.getElementById('rv-stars'); if(!el) return;
  el.querySelectorAll('.star').forEach(s=>{
    s.addEventListener('click',()=>{
      rvRating=+s.dataset.v;
      el.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('on',i<rvRating));
    });
    s.addEventListener('mouseover',()=>el.querySelectorAll('.star').forEach((st,i)=>st.classList.toggle('hov',i<+s.dataset.v)));
    s.addEventListener('mouseout',()=>el.querySelectorAll('.star').forEach(st=>st.classList.remove('hov')));
  });
}

async function loadReviews(){
  const {db,collection,getDocs}=window._fb;
  const rvSel=document.getElementById('rv-room');
  if(rvSel) rvSel.innerHTML=rooms.map(r=>`<option value="${r.id}">${r.name}</option>`).join('');

  const fw=document.getElementById('rv-form-wrap');
  if(!CU&&fw){
    fw.innerHTML='<p style="color:var(--tm);font-size:0.8rem;font-style:italic;padding:1rem 0;">V√©lem√©ny √≠r√°s√°hoz k√©rj√ºk, <button class="btn bo bsm" onclick="go(\'auth\')" style="margin-left:0.4rem;">jelentkezzen be</button></p>';
  }

  const snap=await getDocs(collection(db,'reviews'));
  const rvs=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  const g=document.getElementById('rv-grid');
  const avgEl=document.getElementById('avg-r'),cntEl=document.getElementById('rv-cnt'),asEl=document.getElementById('avg-stars');
  if(rvs.length&&avgEl){
    const avg=(rvs.reduce((s,r)=>s+(r.rating||0),0)/rvs.length).toFixed(1);
    avgEl.textContent=avg;if(cntEl)cntEl.textContent=`${rvs.length} v√©lem√©ny`;
    if(asEl)asEl.innerHTML=Array(5).fill(0).map((_,i)=>`<span class="star${i<Math.round(+avg)?' on':''}">‚òÖ</span>`).join('');
  } else if(avgEl){avgEl.textContent='‚Äì';}
  if(!g) return;
  if(!rvs.length){g.innerHTML='<div style="text-align:center;padding:3rem;color:var(--tm);">M√©g nincs v√©lem√©ny.</div>';return;}
  g.innerHTML=rvs.map(r=>`<div class="rvc">
    <div class="rvh">
      <div class="rvav">${(r.name||'?')[0].toUpperCase()}</div>
      <div>
        <div style="font-size:0.82rem;font-weight:500;">${r.name||'N√©vtelen'}</div>
        <div style="font-size:0.68rem;color:var(--tm);">${r.roomName||''} ¬∑ ${r.createdAt?.seconds?new Date(r.createdAt.seconds*1000).toLocaleDateString('hu-HU'):''}</div>
      </div>
      <div class="stars" style="margin-left:auto;">${Array(5).fill(0).map((_,i)=>`<span class="star${i<(r.rating||0)?' on':''}">‚òÖ</span>`).join('')}</div>
    </div>
    <div class="rvtxt">${r.text}</div>
  </div>`).join('');
}

async function submitReview(){
  if(!CU){toast('Bejelentkez√©s sz√ºks√©ges!','inf');return;}
  const rid=document.getElementById('rv-room')?.value;
  const r=rooms.find(x=>x.id===rid);
  const txt=document.getElementById('rv-txt')?.value.trim();
  if(!txt){toast('√çrja meg a v√©lem√©ny√©t!','err');return;}
  if(!rvRating){toast('Adjon √©rt√©kel√©st (csillagok)!','err');return;}
  const {db,collection,addDoc,serverTimestamp}=window._fb;
  await addDoc(collection(db,'reviews'),{
    userId:CU.uid,name:CU.email.split('@')[0],userEmail:CU.email,
    roomId:rid||'',roomName:r?.name||'',rating:rvRating,text:txt,
    createdAt:serverTimestamp()
  });
  toast('K√∂sz√∂nj√ºk v√©lem√©ny√©t!','ok');
  document.getElementById('rv-txt').value='';
  rvRating=0;
  document.querySelectorAll('#rv-stars .star').forEach(s=>s.classList.remove('on'));
  loadReviews();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALENDAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function renderCal(){
  const {db,collection,getDocs}=window._fb;
  const snap=await getDocs(collection(db,'bookings'));
  const allB=snap.docs.map(d=>d.data()).filter(b=>b.status!=='cancelled');
  const months=['Janu√°r','Febru√°r','M√°rcius','√Åprilis','M√°jus','J√∫nius','J√∫lius','Augusztus','Szeptember','Okt√≥ber','November','December'];
  document.getElementById('cal-lbl').textContent=`${months[calM]} ${calY}`;
  const g=document.getElementById('cal-grid');
  g.innerHTML=['H','K','Sze','Cs','P','Szo','V'].map(d=>`<div class="cdn">${d}</div>`).join('');
  const off=(new Date(calY,calM,1).getDay()+6)%7;
  const tot=new Date(calY,calM+1,0).getDate();
  const td=new Date();
  for(let i=0;i<off;i++) g.innerHTML+=`<div class="cd empty"></div>`;
  for(let d=1;d<=tot;d++){
    const ds=`${calY}-${String(calM+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const past=new Date(ds)<new Date(td.toDateString());
    const today=d===td.getDate()&&calM===td.getMonth()&&calY===td.getFullYear();
    const dayB=allB.filter(b=>b.checkin<=ds&&b.checkout>ds);
    const cls=['cd',past?'past':'',today?'today':'',dayB.length>=rooms.length&&rooms.length>0?'full-b':dayB.length>0?'has-b':''].filter(Boolean).join(' ');
    g.innerHTML+=`<div class="${cls}" onclick="showCalDay('${ds}',${JSON.stringify(dayB).replace(/"/g,'&quot;')})">${d}</div>`;
  }
  document.getElementById('cal-p').onclick=()=>{calM--;if(calM<0){calM=11;calY--;}renderCal();};
  document.getElementById('cal-n').onclick=()=>{calM++;if(calM>11){calM=0;calY++;}renderCal();};
}

function showCalDay(ds,dayB){
  const el=document.getElementById('cal-det');
  if(!dayB.length){el.innerHTML=`<div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:0.5rem;">üìÖ ${ds}</div><p style="color:var(--tm);font-size:0.8rem;font-style:italic;">Ezen a napon nincs foglal√°s.</p>`;return;}
  el.innerHTML=`<div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1.2rem;">üìÖ ${ds} ‚Äì ${dayB.length} foglal√°s</div>`+
    dayB.map(b=>`<div style="border:1px solid var(--bl);border-radius:var(--r);padding:0.9rem;margin-bottom:0.55rem;">
      <div style="font-weight:500;font-size:0.82rem;margin-bottom:0.25rem;">${b.roomName}</div>
      <div style="font-size:0.72rem;color:var(--tm);">${b.firstname||''} ${b.lastname||''}</div>
      <div style="font-size:0.72rem;color:var(--tm);">${b.checkin} ‚Üí ${b.checkout}</div>
      <div style="margin-top:0.4rem;display:flex;gap:0.4rem;flex-wrap:wrap;">
        <span class="badge ${bCls(b.status)}">${bLbl(b.status)}</span>
        ${b.checkedIn?'<span class="badge bco">‚úì Check-in</span>':''}
        ${b.checkedOut?'<span class="badge bi">‚úì Check-out</span>':''}
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function authTab(t){
  document.getElementById('auth-li').style.display=t==='login'?'':'none';
  document.getElementById('auth-reg').style.display=t==='register'?'':'none';
  document.querySelectorAll('#page-auth .tb').forEach((b,i)=>b.classList.toggle('active',(i===0&&t==='login')||(i===1&&t==='register')));
}
async function doLogin(){
  const {auth,signInWithEmailAndPassword}=window._fb;
  try{await signInWithEmailAndPassword(auth,document.getElementById('l-em').value,document.getElementById('l-pw').value);toast('Sikeres bejelentkez√©s!','ok');}
  catch(e){toast('Hib√°s email vagy jelsz√≥.','err');}
}
async function doRegister(){
  const {auth,db,createUserWithEmailAndPassword,doc,setDoc}=window._fb;
  const em=document.getElementById('r-em').value,pw=document.getElementById('r-pw').value;
  try{
    const cred=await createUserWithEmailAndPassword(auth,em,pw);
    await setDoc(doc(db,'users',cred.user.uid),{email:em,role:'user',firstname:document.getElementById('r-fn').value,lastname:document.getElementById('r-ln').value,createdAt:new Date().toISOString()});
    toast('Sikeres regisztr√°ci√≥!','ok');
  }catch(e){toast('Hiba: '+e.message,'err');}
}
async function logout(){
  const {auth,signOut}=window._fb;
  await signOut(auth);toast('Kijelentkezett.','inf');go('home');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function bCls(s){return{pending:'bp',confirmed:'bc',cancelled:'bx'}[s]||'bp';}
function bLbl(s){return{pending:'F√ºgg≈ëben',confirmed:'Visszaigazolt',cancelled:'Lemondva'}[s]||s;}
function srcLbl(s){return{online:'Online',phone:'Telefon',walkin:'Szem√©lyes',email_src:'Email',admin:'Admin',other:'Egy√©b'}[s]||'Online';}
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
window.addEventListener('click',e=>{if(e.target.classList.contains('mo'))document.querySelectorAll('.mo.open').forEach(m=>m.classList.remove('open'));});
function toast(msg,type='inf'){
  const ic={ok:'‚úì',err:'‚úï',inf:'‚Ñπ'};
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span>${ic[type]||'‚Ñπ'}</span><span>${msg}</span>`;
  document.getElementById('toasts').appendChild(el);
  setTimeout(()=>el.remove(),4500);
}
</script>
</body>
</html>
